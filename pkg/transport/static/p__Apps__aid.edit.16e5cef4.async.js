(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[532],{50317:function(Ye){Ye.exports={SearchInput:"SearchInput___PEFkt",ProxyUrlInput:"ProxyUrlInput___3liOo"}},55356:function(Ye,Pe,e){"use strict";e.r(Pe),e.d(Pe,{default:function(){return jr}});var L=e(2824),j=e(39428),u=e(11849),ur=e(34792),w=e(48086),z=e(3182),v=e(67294),Ee=e(21010),be=e(44728),ee=e(93400),Xe=e(90949),Le=e(91220),ke=e(2844),G=e(14300),qe=e(88293),se=e(69610),le=e(54941),_e=e(56188),Ie=function(){function E(){(0,se.Z)(this,E),this.generator=void 0,this.generator=new _e.C(0,1,{workerIdBits:5,datacenterIdBits:5,sequenceBits:12})}return(0,le.Z)(E,null,[{key:"generate",value:function(){return this.getInstance().generator.nextId().toString()}},{key:"getInstance",value:function(){return this.instance?this.instance:(this.instance=new E,this.instance)}}]),E}();Ie.instance=void 0;var Se=function(){return Ie.generate()},ie=e(62448),ue=e(5966),er=e(24739),y=e(90672),Re=e(64317),rr=e(61674),Ve=e(7717),or=e(57663),Q=e(71577),re=e(86582),R=e(66456),oe=e(78587),de=e(47673),he=e(28166),De=e(43358),ye=e(66074),ce=e(77883),C=e(49747),ge=e(32059),ve=e(93224),H=e(9715),te=e(63202),me=e(80454),Ce=e(96486),Be=e.n(Ce),Me=e(64140),Ne=e(42762),tr=e(82061),Ke=e(51042),$e=e(63434),ar=e(31649),nr=e(50317),Fe=e.n(nr),r=e(85893),We=["title","editable","children","dataIndex","record","handleSave","options","inputType"],sr=["className","style"],we=(0,Me.W6)(function(){return(0,r.jsx)(Ne.Z,{style:{cursor:"grab",color:"#999"}})}),xe=v.createContext(null),ze=(0,Me.W8)(function(E){var a=te.Z.useForm(),t=(0,L.Z)(a,1),o=t[0];return(0,r.jsx)(te.Z,{form:o,component:!1,children:(0,r.jsx)(xe.Provider,{value:o,children:(0,r.jsx)("tr",(0,u.Z)({className:"editable-row"},E))})})}),Ge=(0,Me.JN)(function(E){return(0,r.jsx)("tbody",(0,u.Z)({},E))}),He=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"].map(function(E){return{value:E,label:E}}),pe=function E(a){if((0,Ce.isArray)(a)){var t=(0,Le.Z)(a),o;try{for(t.s();!(o=t.n()).done;){var m=o.value;if(!E(m))return!1}}catch(s){t.e(s)}finally{t.f()}return!0}else if((0,Ce.isString)(a))return!Boolean(a.trim());return!Boolean(a)},M=function(a){var t=a.title,o=a.editable,m=a.children,s=a.dataIndex,g=a.record,l=a.handleSave,K=a.options,B=a.inputType,I=(0,ve.Z)(a,We),U=(0,v.useState)(!1),T=(0,L.Z)(U,2),b=T[0],f=T[1],Z=(0,v.useRef)(null),$=(0,v.useContext)(xe);(0,v.useEffect)(function(){b&&Z.current.focus()},[b]);var J=function(){f(!b),$.setFieldsValue((0,ge.Z)({},s,g[s]))},O=function(){var F=(0,z.Z)((0,j.Z)().mark(function c(){var N;return(0,j.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,$.validateFields();case 3:N=W.sent,J(),l((0,u.Z)((0,u.Z)({},g),N)),W.next=11;break;case 8:W.prev=8,W.t0=W.catch(0),console.error("Save failed:",W.t0);case 11:case"end":return W.stop()}},c,null,[[0,8]])}));return function(){return F.apply(this,arguments)}}(),A=function(){switch(B){case"number":return(0,r.jsx)(C.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O});case"select":return(0,r.jsx)(ye.Z,{ref:Z,size:"small",onBlur:O,options:K});default:return(0,r.jsx)(he.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O})}}(),Y=m;return o&&(Y=b?(0,r.jsx)(te.Z.Item,{className:Fe().ProxyUrlInput,style:{margin:0},name:s,rules:[{required:!0,message:""}],children:A}):(0,r.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:J,children:pe(m)?(0,r.jsx)(r.Fragment,{children:"\xA0"}):m})),(0,r.jsx)("td",(0,u.Z)((0,u.Z)({},I),{},{children:Y}))},Te=function(a){var t=a.parentIntl,o=a.dataSource,m=a.setDataSource,s=(0,v.useState)(240),g=(0,L.Z)(s,2),l=g[0],K=g[1],B=o.domain,I=o.urls,U=o.upstream,T=o.insecureSkipVerify,b=o.transparentServerName,f=(0,v.useState)(0),Z=(0,L.Z)(f,2),$=Z[0],J=Z[1],O=(0,v.useState)(),A=(0,L.Z)(O,2),Y=A[0],F=A[1],c=(0,v.useMemo)(function(){return new ee.f("proxy",t)},[t]);(0,v.useEffect)(function(){var p=function(){window.innerHeight>890?K(window.innerHeight-690):K(200)};p(),window.addEventListener("resize",p)},[]),(0,v.useEffect)(function(){var p="",d=(0,Le.Z)(I),i;try{for(d.s();!(i=d.n()).done;){var n=i.value;(!n.name||!n.name.trim())&&(p=c.t("name.required","name cannot be empty!")),(!n.method||!n.method.trim())&&(p=c.t("method.required","method cannot be empty!")),(!n.url||!n.url.trim())&&(p=c.t("url.required","URL cannot be empty!"))}}catch(S){d.e(S)}finally{d.f()}F(p)},[c,I]);var N=function(d){var i=d.oldIndex,n=d.newIndex;if(i!==n){var S=(0,me.q)(I.slice(),i,n).filter(function(x){return!!x});m((0,u.Z)((0,u.Z)({},o),{},{urls:S}))}},h=function(d){return(0,r.jsx)(Ge,(0,u.Z)({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:N},d))},W=function(d){var i=d.className,n=d.style,S=(0,ve.Z)(d,sr),x=I.findIndex(function(D){return D.id===S["data-row-key"]});return(0,r.jsx)(ze,(0,u.Z)({index:x},S))},Qe=function(d){m(function(i){var n,S=(n=i==null?void 0:i.urls.map(function(x){return x.id===d.id?d:x}))!==null&&n!==void 0?n:[];return(0,u.Z)((0,u.Z)({},i),{},{urls:S})})},Ze=[{dataIndex:"sort",width:30,className:"drag-visible",render:function(){return(0,r.jsx)(we,{})}},{width:150,title:c.t("name.title","Name"),dataIndex:"name",inputType:"text",editable:!0},{title:c.t("method.title","Method"),dataIndex:"method",inputType:"select",width:100,options:He,editable:!0},{title:c.t("url.title","URL"),dataIndex:"url",inputType:"text",editable:!0},{width:30,render:function(d,i){return[(0,r.jsx)("a",{onClick:(0,z.Z)((0,j.Z)().mark(function n(){return(0,j.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:m(function(D){return(0,u.Z)((0,u.Z)({},D),{},{urls:D.urls.filter(function(X){return X.id!==i.id})})});case 1:case"end":return x.stop()}},n)})),children:(0,r.jsx)(tr.Z,{})},"delete")]}}],Oe=Ze.map(function(p){return p.editable?(0,u.Z)((0,u.Z)({},p),{},{onCell:function(i){return{record:i,editable:p.editable,dataIndex:p.dataIndex,inputType:p.inputType,options:p.options,title:p.title,handleSave:Qe}}}):p});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ue.Z,{name:["proxy","domain"],label:c.t("domain.label","Domain"),colProps:{span:12},initialValue:B,rules:[{required:!0,message:c.t("domain.required","domain cannot be empty!")}]}),(0,r.jsx)(ue.Z,{name:["proxy","upstream"],label:c.t("upstream.label","Upstream"),colProps:{span:12},initialValue:U,tooltip:(0,r.jsxs)(r.Fragment,{children:[c.t("upstream.example","Example"),":",(0,r.jsx)("br",{}),(0,r.jsx)("li",{children:"abc.com"}),(0,r.jsx)("li",{children:"http://abc.com:80"}),(0,r.jsx)("li",{children:"http://1.2.3.4"}),(0,r.jsx)("li",{children:"https://abc.com"})]}),rules:[{required:!0,message:c.t("upstream.required","upstream cannot be empty!")}]}),(0,r.jsx)($e.Z,{name:["proxy","insecureSkipVerify"],label:c.t("insecureSkipVerify.label","Skip TLS Verify"),colProps:{span:12},initialValue:T,tooltip:c.t("insecureSkipVerify.describe","When requesting back-end servers, the certificate verification is ignored (insecure).")}),(0,r.jsx)($e.Z,{name:["proxy","transparentServerName"],label:c.t("transparentServerName.label","Transparent Server Name"),colProps:{span:12},initialValue:b,tooltip:c.t("transparentServerName.describe","When requesting the backend, the domain name requested by the client will be transparently transmitted.")}),(0,r.jsxs)(ar.Z,{colProps:{span:24},label:c.t("url.label","URL"),children:[(0,r.jsx)(oe.Z,{pagination:!1,dataSource:I,columns:Oe,scroll:{y:l},rowKey:"id",size:"small",components:{body:{wrapper:h,row:W,cell:M}}}),(0,r.jsx)(Q.Z,{onClick:function(){m((0,u.Z)((0,u.Z)({},o),{},{urls:[].concat((0,re.Z)(I),[{name:"",id:Se(),method:"*",url:""}])})),J($+1)},type:"dashed",block:!0,children:(0,r.jsx)(Ke.Z,{})}),(0,r.jsx)("div",{style:{color:"red"},children:Y})]})]})},ae=Te,lr=e(18106),je=e(58500),ir=e(49111),Je=e(19650),vr=e(77576),V=e(12028),dr=e(13062),mr=e(71230),Cr=e(63185),cr=e(9676),pr=e(86504),fr=function(a){var t=a.role,o=a.setRole,m=a.activeKey,s=a.setActiveKey,g=(0,v.useRef)(null),l=(0,v.useState)(!1),K=(0,L.Z)(l,2),B=K[0],I=K[1];return(0,v.useEffect)(function(){if(m===t.id&&!t.name&&I(!0),m===t.id&&B){var U;(U=g.current)===null||U===void 0||U.focus({cursor:"all"})}},[B,m,t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(he.Z,{hidden:!(B&&t.id===m),style:{width:80,padding:0},ref:g,onKeyDown:function(T){T.key=="Enter"&&(o({id:t.id,name:T.currentTarget.value}),I(!1))},onBlur:function(T){o({id:t.id,name:T.target.value}),I(!1)},autoFocus:!0,defaultValue:t.name?t.name:"New Role"}),(0,r.jsxs)("div",{hidden:B&&t.id===m,style:{width:80,overflow:"hidden",textShadow:"0 0 0 aliceblue"},title:t.name,onDoubleClick:function(){s(t.id),I(!0)},children:[(0,r.jsx)(pr.Z,{style:{color:"orange"},hidden:!t.isDefault}),t.name]})]})},hr=function(a){var t=a.urls,o=t===void 0?[]:t,m=a.value,s=m===void 0?[]:m,g=a.onChange,l=(0,v.useState)(),K=(0,L.Z)(l,2),B=K[0],I=K[1],U={add:function(){var f="new-role-".concat(Se());I(f),g==null||g([].concat((0,re.Z)(s),[{name:"",id:f}]))},remove:function(f){Be().isString(f)?g==null||g(s.filter(function(Z){return Z.id!=f})):w.default.warning("system error: ".concat(f," is not string"))}},T=function(){var b=(0,z.Z)((0,j.Z)().mark(function f(Z){return(0,j.Z)().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,g==null?void 0:g(s.map(function(O){return Z.id==O.id?(0,u.Z)((0,u.Z)({},O),Z):O}));case 2:case"end":return J.stop()}},f)}));return function(Z){return b.apply(this,arguments)}}();return(0,r.jsx)(je.Z,{type:"editable-card",tabPosition:"top",style:{height:350},activeKey:B,onChange:I,onEdit:function(f,Z){U[Z](f)},children:s.map(function(b){return(0,r.jsx)(je.Z.TabPane,{tab:(0,r.jsx)(fr,{role:b,setRole:T,activeKey:B,setActiveKey:I}),tabKey:b.id,children:(0,r.jsxs)(Je.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{style:{display:o.length===0?"none":"unset"},children:[(0,r.jsx)("div",{style:{paddingBottom:7},children:"Permission"}),(0,r.jsx)(cr.Z.Group,{onChange:function(Z){T((0,u.Z)((0,u.Z)({},b),{},{urls:Z}))},defaultValue:b.urls,children:o.map(function(f){return(0,r.jsx)(mr.Z,{children:(0,r.jsx)(cr.Z,{value:f.id,children:f.name})},f.id)})})]}),(0,r.jsxs)("div",{style:{padding:10},children:["\u9ED8\u8BA4:",(0,r.jsx)(V.Z,{checked:b.isDefault,onChange:function(Z){g==null||g(s.map(function($){return b.id==$.id?(0,u.Z)((0,u.Z)({},$),{},{isDefault:Z}):Z?(0,u.Z)((0,u.Z)({},$),{},{isDefault:!Z}):$}))}})]})]})},b.id)})})},yr=function(a){var t=a.values,o=a.onSubmit,m=a.parentIntl,s=a.loading,g=a.disabled,l=new ee.f("form",m),K=(0,v.useState)([]),B=(0,L.Z)(K,2),I=B[0],U=B[1],T=(0,v.useRef)(),b=(0,v.useState)([]),f=(0,L.Z)(b,2),Z=f[0],$=f[1],J=(0,v.useState)([]),O=(0,L.Z)(J,2),A=O[0],Y=O[1],F=(0,v.useState)({domain:"",upstream:"",urls:[{id:Se(),method:"*",name:"default",url:"/"}],insecureSkipVerify:!1,transparentServerName:!0}),c=(0,L.Z)(F,2),N=c[0],h=c[1],W=(0,v.useState)(0),Qe=(0,L.Z)(W,2),Ze=Qe[0],Oe=Qe[1];(0,v.useEffect)(function(){var d,i,n,S,x,D,X;Oe(0),Y((d=t==null||(i=t.roles)===null||i===void 0?void 0:i.map(function(k){var ne;return{id:k.id,urls:(ne=k.urls)!==null&&ne!==void 0?ne:[],name:k.name,isDefault:k.isDefault}}))!==null&&d!==void 0?d:[]),$((n=t==null?void 0:t.users)!==null&&n!==void 0?n:[]),h((0,u.Z)((0,u.Z)({domain:"",upstream:"",transparentServerName:!0,insecureSkipVerify:!1},(S=t==null?void 0:t.proxy)!==null&&S!==void 0?S:{}),{},{urls:(x=t==null||(D=t.proxy)===null||D===void 0?void 0:D.urls)!==null&&x!==void 0?x:[{id:Se(),method:"*",name:"default",url:"/"}]})),U((X=t==null?void 0:t.grantType)!==null&&X!==void 0?X:[])},[t]);var p=function(i){return(i??[]).includes(G.qJ.proxy)};return(0,r.jsxs)(ie.L,{stepsProps:{size:"small"},formProps:{preserve:!1,disabled:g,loading:s},onCurrentChange:function(){var d=(0,z.Z)((0,j.Z)().mark(function i(n){var S;return(0,j.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:n==1&&!p((S=T.current)===null||S===void 0?void 0:S.getFieldValue("grantType"))?Oe(n+(Ze===0?1:-1)):Oe(n);case 1:case"end":return D.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),current:Ze,onFinish:function(){var d=(0,z.Z)((0,j.Z)().mark(function i(n){var S,x,D,X,k,ne,Ue,fe,Ae,q;return(0,j.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return console.log(n),S=G.FQ.manual,x=n.grantMode,D=n.grantType,X=n.status,k=N.domain,ne=N.upstream,Ue=N.urls,fe=N.transparentServerName,Ae=N.insecureSkipVerify,q=Ue.map(function(_){var Er=_.id,br=_.method,Ir=_.name,Dr=_.url;return{id:Er,method:br,name:Ir,url:Dr}}),P.abrupt("return",o((0,u.Z)((0,u.Z)({},n),{},{users:Z.map(function(_){return{id:_.id,roleId:_.roleId}}),status:X!==G.w$.unknown?X:G.w$.normal,roles:A.map(function(_){return p(D)?_:(0,u.Z)((0,u.Z)({},_),{},{urls:void 0})}),grantMode:x??S,grantType:D??[G.qJ.none],proxy:p(D)?{domain:k,upstream:ne,urls:q,insecureSkipVerify:Ae,transparentServerName:fe}:void 0})));case 6:case"end":return P.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),children:[(0,r.jsxs)(ie.L.StepForm,{initialValues:t,formRef:T,layout:"vertical",style:{maxWidth:650},grid:!0,title:l.t("basicConfig.title","Basic"),onFinish:(0,z.Z)((0,j.Z)().mark(function d(){return(0,j.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t&&!t.id)){n.next=3;break}return w.default.error(l.t("app-id.empty","System error, application ID is empty")),n.abrupt("return",!1);case 3:return n.abrupt("return",!0);case 4:case"end":return n.stop()}},d)})),children:[(0,r.jsx)(ue.Z,{hidden:!0,name:"id"}),(0,r.jsx)(ke.HZ,{colProps:{span:8,sm:8,xs:14},label:l.t("avatar.label","Avatar"),name:"avatar"}),(0,r.jsxs)(er.UW,{grid:!0,colProps:{span:16,xs:14},children:[(0,r.jsx)(ue.Z,{name:"name",label:l.t("name.label","Name"),width:"md",rules:[{required:!0,message:l.t("name.required","Please input app name!")},{pattern:/^[-_A-Za-z0-9]+$/,message:l.t("name.invalid","App name format error!")}],disabled:!!(t!=null&&t.name)}),(0,r.jsx)(ue.Z,{name:"displayName",label:l.t("displayName.label","Display Name"),width:"md"})]}),(0,r.jsx)(y.Z,{colProps:{span:24,sm:24,xs:14},name:"description",label:l.t("description.label","Description")}),(0,r.jsx)(ue.Z,{name:"url",colProps:{span:24,sm:24,xs:14},label:l.t("url.label","URL")}),(0,r.jsx)(Re.Z,{colProps:{span:12,sm:12,xs:14},name:"grantType",label:l.t("grantType.label","Grant Type"),width:"md",mode:"tags",options:(0,qe.MM)(G.qJ,m,"grantType.value"),fieldProps:{onChange:U}}),(0,r.jsx)(Re.Z,{colProps:{span:12,sm:12,xs:14},name:"grantMode",label:l.t("grantMode.label","Grant Mode"),width:"md",tooltip:l.t("grantMode.tooltip","Automatic authorization is only supported when using OAuth2.0 and RADIUS protocols, otherwise manual authorization is only possible."),options:(0,qe.MM)(G.FQ,m,"grantMode.value"),rules:[{required:!0,message:l.t("grantMode.required","Please select Grant Mode!")}]})]}),(0,r.jsx)(ie.L.StepForm,{initialValues:{},layout:"vertical",grid:!0,title:l.t("proxy.title","Proxy"),onFinish:function(){var d=(0,z.Z)((0,j.Z)().mark(function i(n){var S,x,D,X,k,ne,Ue,fe,Ae,q;return(0,j.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:x=(S=n.proxy)!==null&&S!==void 0?S:{},D=x.domain,X=x.upstream,k=x.transparentServerName,ne=x.insecureSkipVerify,h((0,u.Z)((0,u.Z)({},N),{},{domain:D,upstream:X,transparentServerName:k,insecureSkipVerify:ne})),Ue=N.urls,fe=(0,Le.Z)(Ue),P.prev=4,fe.s();case 6:if((Ae=fe.n()).done){P.next=19;break}if(q=Ae.value,!(!q.name||!q.name.trim())){P.next=11;break}return w.default.error(l.t("name.required","name cannot be empty!")),P.abrupt("return",!1);case 11:if(!(!q.method||!q.method.trim())){P.next=14;break}return w.default.error(l.t("proxy.method.required","method cannot be empty!")),P.abrupt("return",!1);case 14:if(!(!q.url||!q.url.trim())){P.next=17;break}return w.default.error(l.t("proxy.url.required","URL cannot be empty!")),P.abrupt("return",!1);case 17:P.next=6;break;case 19:P.next=24;break;case 21:P.prev=21,P.t0=P.catch(4),fe.e(P.t0);case 24:return P.prev=24,fe.f(),P.finish(24);case 27:return P.abrupt("return",!0);case 28:case"end":return P.stop()}},i,null,[[4,21,24,27]])}));return function(i){return d.apply(this,arguments)}}(),children:Ze===1&&(0,r.jsx)(ae,{dataSource:N,setDataSource:h,parentIntl:l})}),(0,r.jsx)(ie.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("role.title","Role"),children:Ze===2&&(0,r.jsx)(rr.Z,{name:"rules",rules:[{validator:function(){if(A.length>0){if(A.filter(function(n){return n.isDefault}).length!=1)return Promise.reject(new Error("No default role specified!"));var i=A.map(function(n){return n.name});if(i.some(function(n,S){return i.includes(n,S+1)}))return Promise.reject(new Error("Contains duplicate role names!"));if(i.some(function(n){return!Boolean(n)}))return Promise.reject(new Error("Contains empty role names!"))}return Promise.resolve()}}],children:(0,r.jsx)(hr,{value:A,urls:p(I)?N.urls:[],onChange:Y})})}),(0,r.jsx)(ie.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("user.title","User"),children:Ze===3&&(0,r.jsx)("div",{style:{height:"calc( 100vh - 400px )"},children:(0,r.jsx)(Ve.ZP,{users:Z,roles:A,onChange:$,granting:!0,parentIntl:m})})})]})},gr=yr,Zr=function(){var E=(0,z.Z)((0,j.Z)().mark(function a(t){var o;return(0,j.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=w.default.loading("Adding ..."),s.prev=1,s.next=4,(0,be.ri)((0,u.Z)({},t));case 4:return o(),w.default.success("Added successfully"),s.abrupt("return",!0);case 9:return s.prev=9,s.t0=s.catch(1),o(),w.default.error("Adding failed, please try again!"),s.abrupt("return",!1);case 14:case"end":return s.stop()}},a,null,[[1,9]])}));return function(t){return E.apply(this,arguments)}}(),Sr=function(){var E=(0,z.Z)((0,j.Z)().mark(function a(t){var o;return(0,j.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(o=w.default.loading("Configuring"),s.prev=1,!t.id){s.next=10;break}return s.next=5,(0,be.KT)({id:t.id},{id:t.id,name:t.name,status:t.status,description:t.description,grantType:t.grantType,grantMode:t.grantMode,avatar:t.avatar,roles:t.roles,users:t.users,proxy:t.proxy,url:t.url,displayName:t.displayName});case 5:return o(),w.default.success("update is successful"),s.abrupt("return",!0);case 10:return w.default.success("update failed, system error"),s.abrupt("return",!1);case 12:s.next=19;break;case 14:return s.prev=14,s.t0=s.catch(1),o(),w.default.error("Configuration failed, please try again!"),s.abrupt("return",!1);case 19:case"end":return s.stop()}},a,null,[[1,14]])}));return function(t){return E.apply(this,arguments)}}(),xr=function(a){var t=a.match.params.aid,o=a.history,m=new ee.f("pages.apps",(0,Ee.YB)()),s=(0,v.useState)(),g=(0,L.Z)(s,2),l=g[0],K=g[1],B=(0,v.useState)(!1),I=(0,L.Z)(B,2),U=I[0],T=I[1],b=(0,v.useState)(!1),f=(0,L.Z)(b,2),Z=f[0],$=f[1],J=function(){var O=(0,z.Z)((0,j.Z)().mark(function A(Y){var F,c;return(0,j.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,T(!0),h.next=4,(0,be.BN)({id:Y});case 4:return F=h.sent,F.data&&(c=F.data,K(c)),T(!1),h.abrupt("return",F);case 10:return h.prev=10,h.t0=h.catch(0),$(!0),h.t0.handled||console.error("failed to get app info: ".concat(h.t0)),h.abrupt("return",{success:!1});case 15:case"end":return h.stop()}},A,null,[[0,10]])}));return function(Y){return O.apply(this,arguments)}}();return(0,v.useEffect)(function(){t?J(t):K({})},[t]),(0,r.jsx)(Xe.ZP,{children:l?(0,r.jsx)(gr,{onSubmit:function(){var O=(0,z.Z)((0,j.Z)().mark(function A(Y){var F,c;return(0,j.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(l!=null&&l.id?Sr:Zr)(Y);case 2:return F=h.sent,F&&o.push("/apps/".concat((c=l==null?void 0:l.id)!==null&&c!==void 0?c:"")),h.abrupt("return",F);case 5:case"end":return h.stop()}},A)}));return function(A){return O.apply(this,arguments)}}(),values:l!=null&&l.id?l:void 0,parentIntl:m,loading:U,disabled:Z}):null})},jr=xr},7717:function(Ye,Pe,e){"use strict";e.d(Pe,{DV:function(){return Ve}});var L=e(48736),j=e(27049),u=e(71748),ur=e(90860),w=e(47673),z=e(28166),v=e(39428),Ee=e(86582),be=e(3182),ee=e(2824),Xe=e(93224),Le=e(43358),ke=e(66074),G=e(11849),qe=e(54421),se=e(38272),le=e(67294),_e=e(58533),Ie=e(2844),Se=e(10861),ie=e(93400),ue=e(50317),er=e.n(ue),y=e(85893),Re=["type","loading"],rr=function(Q){var re=Q.users,R=Q.onChange,oe=Q.roles,de=Q.loading,he=Q.granting,De=Q.parentIntl,ye=new ie.f("users",De);return(0,y.jsx)(se.ZP,{dataSource:re,size:"small",loading:de,renderItem:function(C){var ge,ve;return(0,y.jsxs)(se.ZP.Item,{actions:R&&he?[(0,y.jsx)("a",{onClick:function(){R(re.filter(function(te){return te.id!=C.id}))},children:ye.t("userList.delete","Delete")},"grant")]:[],children:[(0,y.jsx)(se.ZP.Item.Meta,{avatar:(0,y.jsx)(Ie.ZP,{src:"".concat(C.avatar)}),title:C.fullName?C.fullName:C.username,description:C.email}),R&&he&&oe.length>0?(0,y.jsx)(ke.Z,{onSelect:function(te){R(re.map(function(me){return me.id==C.id?(0,G.Z)((0,G.Z)({},me),{},{roleId:te}):me}))},defaultValue:C&&C.roleId?C.roleId:(ge=oe.find(function(H){return H.isDefault}))===null||ge===void 0?void 0:ge.id,options:oe.map(function(H){return{key:H.id,value:H.id,label:H.name}})}):(0,y.jsx)("div",{children:C&&C.role?C.role:(ve=oe.find(function(H){return H.isDefault}))===null||ve===void 0?void 0:ve.name})]},C.id)}})},Ve=function(Q){var re=Q.type,R=re===void 0?"vertical":re,oe=Q.loading,de=(0,Xe.Z)(Q,Re),he=de.roles,De=de.onChange,ye=de.users,ce=de.granting,C=de.parentIntl,ge=new ie.f("grant",C),ve=(0,le.useState)(!0),H=(0,ee.Z)(ve,2),te=H[0],me=H[1],Ce=(0,le.useState)(0),Be=(0,ee.Z)(Ce,2),Me=Be[0],Ne=Be[1],tr=(0,le.useState)(),Ke=(0,ee.Z)(tr,2),$e=Ke[0],ar=Ke[1],nr=(0,le.useState)([]),Fe=(0,ee.Z)(nr,2),r=Fe[0],We=Fe[1],sr=(0,le.useState)(!1),we=(0,ee.Z)(sr,2),xe=we[0],ze=we[1],Ge=function(){var pe=(0,be.Z)((0,v.Z)().mark(function M(Te){var ae,lr,je,ir,Je;return(0,v.Z)().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.prev=0,ze(!0),V.next=4,(0,Se.Rf)((0,G.Z)({current:Me+1,pageSize:20,keywords:$e},Te));case 4:ae=V.sent,ae&&ae.data?(lr=ae.data,je=ae.current,ir=ae.pageSize,Je=ae.total,We(function(dr){return[].concat((0,Ee.Z)(dr),(0,Ee.Z)(lr))}),Ne(je),Je<je*ir&&me(!1)):me(!1),V.next=11;break;case 8:V.prev=8,V.t0=V.catch(0),V.t0.handled||console.error("failed to get user list: ".concat(V.t0));case 11:return V.prev=11,ze(!1),V.finish(11);case 14:case"end":return V.stop()}},M,null,[[0,8,11,14]])}));return function(Te){return pe.apply(this,arguments)}}(),He=function(M){We([]),ar(M),Ne(1),Ge({keywords:M,current:1})};return(0,le.useEffect)(function(){He()},[]),(0,y.jsxs)("div",{style:{height:"100%",width:"100%"},children:[ce&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{style:{height:R==="vertical"?"calc(100% / 2)":"100%",display:ce?"block":"none",width:R==="vertical"?"100%":"calc((100% - 32px) / 2)",float:R==="horizontal"?"left":"unset"},children:[(0,y.jsx)(z.Z.Search,{className:er().SearchInput,onSearch:function(M){xe||He(M)},loading:xe}),(0,y.jsx)("div",{id:"scrollableDiv",style:{height:"calc( 100% - 32px )",overflow:"auto",padding:"0 16px",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,y.jsx)(_e.Z,{dataLength:r.length,next:Ge,hasMore:te,loader:(0,y.jsx)(ur.Z,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:(0,y.jsx)(j.Z,{plain:!0,children:"End"}),scrollableTarget:"scrollableDiv",children:(0,y.jsx)(se.ZP,{dataSource:r.filter(function(pe){return!ye.map(function(M){return M.id}).includes(pe.id)}),size:"small",loading:xe,renderItem:function(M){return(0,y.jsx)(se.ZP.Item,{actions:[(0,y.jsx)("a",{onClick:function(){De([].concat((0,Ee.Z)(ye),[(0,G.Z)((0,G.Z)({},M),{},{role:""})]))},children:ge.t("userList.grant","Grant")},"grant")],children:(0,y.jsx)(se.ZP.Item.Meta,{avatar:(0,y.jsx)(Ie.ZP,{src:"".concat(M.avatar)}),title:M.fullName?M.fullName:M.username,description:M.email})},M.id)}})})})]}),(0,y.jsx)(j.Z,{type:R==="vertical"?"horizontal":"vertical",style:{height:R==="vertical"?"unset":"100%",margin:R==="vertical"?"10px 0":"0 10px",float:R==="horizontal"?"left":"unset",display:ce?"":"none"}})]}),(0,y.jsx)("div",{id:"scrollableDiv",style:{height:R!=="vertical"||!ce?"100%":"calc((100% - 42px) / 2)",width:R==="horizontal"&&ce?"calc((100% - 32px) / 2)":"100%",overflow:"auto",padding:"0 16px",float:R==="horizontal"?"left":"unset",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,y.jsx)(rr,{parentIntl:C,users:ye,granting:ce,roles:he,loading:oe,onChange:De})})]})};Pe.ZP=Ve}}]);
