(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[244],{16894:function(ne,b,e){"use strict";var x=e(4582);b.ZP=x.Z},44887:function(){},24275:function(ne,b,e){"use strict";e.r(b),e.d(b,{default:function(){return xe}});var x=e(57338),ae=e(273),pe=e(54421),z=e(38272),se=e(71194),F=e(34883),Fe=e(57663),le=e(71577),Ke=e(62350),me=e(24565),Be=e(48736),ve=e(27049),g=e(11849),w=e(2824),l=e(39428),Ye=e(34792),P=e(48086),y=e(3182),he=e(30381),Ze=e.n(he),C=e(67294),ge=e(21010),ie=e(93224),I=e(72709),ye=["id"],Ce=null;function Se(d,n){return G.apply(this,arguments)}function G(){return G=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"GET",params:(0,g.Z)({},n)},s||{})));case 1:case"end":return r.stop()}},d)})),G.apply(this,arguments)}function Re(d,n){return N.apply(this,arguments)}function N(){return N=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:n},s||{})));case 1:case"end":return r.stop()}},d)})),N.apply(this,arguments)}function je(d,n){return J.apply(this,arguments)}function J(){return J=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"DELETE",headers:{"Content-Type":"application/json"},data:n},s||{})));case 1:case"end":return r.stop()}},d)})),J.apply(this,arguments)}function we(d,n,s){return Q.apply(this,arguments)}function Q(){return Q=(0,y.Z)((0,l.Z)().mark(function d(n,s,u){var r,t;return(0,l.Z)().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return r=n.id,t=(0,ie.Z)(n,ye),E.abrupt("return",(0,I.WY)("/api/v1/roles/".concat(r),(0,g.Z)({method:"PUT",headers:{"Content-Type":"application/json"},params:(0,g.Z)({},t),data:s},u||{})));case 2:case"end":return E.stop()}},d)})),Q.apply(this,arguments)}function He(d,n){return X.apply(this,arguments)}function X(){return X=_asyncToGenerator(_regeneratorRuntime().mark(function d(n,s){var u,r;return _regeneratorRuntime().wrap(function(S){for(;;)switch(S.prev=S.next){case 0:return u=n.id,r=_objectWithoutProperties(n,Ce),S.abrupt("return",request("/api/v1/roles/".concat(u),_objectSpread({method:"DELETE",params:_objectSpread({},r)},s||{})));case 2:case"end":return S.stop()}},d)})),X.apply(this,arguments)}var ue=e(93400),Pe=e(51042),oe=e(57119),Ee=e(55997),Te=e(43037),De=e(85224),Oe=e(16894),Ve=e(32157),be=e(17);function Ie(d,n){return q.apply(this,arguments)}function q(){return q=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/permissions",(0,g.Z)({method:"GET",params:(0,g.Z)({},n)},s||{})));case 1:case"end":return r.stop()}},d)})),q.apply(this,arguments)}var _=e(62448),ee=e(5966),a=e(85893),Ae=["parentIntl"],Le=function(n){var s=n.parentIntl,u=(0,ie.Z)(n,Ae),r=new ue.f("form",s),t=(0,C.useState)(!1),S=(0,w.Z)(t,2),E=S[0],K=S[1],p=u.values,A=u.modalVisible,B=u.onSubmit,R=u.onCancel,O=(0,C.useState)([]),Y=(0,w.Z)(O,2),H=Y[0],T=Y[1],V=(0,C.useState)([]),k=(0,w.Z)(V,2),L=k[0],M=k[1],te=(0,C.useState)(500),m=(0,w.Z)(te,2),re=m[0],U=m[1],Z=(0,C.useState)(0),v=(0,w.Z)(Z,2),o=v[0],c=v[1];(0,C.useEffect)(function(){var i=function(){window.innerHeight>640?U(window.innerHeight-440):U(200)};i(),window.addEventListener("resize",i)},[]),(0,C.useEffect)(function(){A&&(c(0),M(p!=null&&p.permission?p.permission.map(function(i){return i.id}):[]),K(!0),Ie({pageSize:3e3}).then(function(i){i.success&&i.data&&T(i.data)}).finally(function(){K(!1)}))},[p,A]);var j=function i(f,W){if(f===void 0)return[];var $=[],h=f;return h.forEach(function(ce,D){if(ce.parentId===W){var fe=i(h,ce.id);fe.length>0?$.push({key:h[D].id,title:h[D].description?h[D].description:h[D].name,children:fe}):$.push({key:h[D].id,title:h[D].description?h[D].description:h[D].name})}}),$};return(0,a.jsxs)(_.L,{stepsProps:{size:"small"},current:o,onCurrentChange:c,formProps:{preserve:!1},stepsFormRender:function(f,W){return(0,a.jsx)(F.Z,{width:640,confirmLoading:E,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:r.t(p?"title.roleUpdate":"title.roleCreate",p?"Modify role":"Add role"),style:{maxHeight:"calc(100vh - 200px)"},open:A,footer:W,onCancel:function(){F.Z.confirm({title:r.t("cancel?","Cancel editing?"),icon:(0,a.jsx)(oe.Z,{}),onOk:function(){R()},maskClosable:!0})},children:f})},onFinish:function(){var i=(0,y.Z)((0,l.Z)().mark(function f(W){return(0,l.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.abrupt("return",B((0,g.Z)((0,g.Z)({},W),{},{permission:L})));case 1:case"end":return h.stop()}},f)}));return function(f){return i.apply(this,arguments)}}(),children:[(0,a.jsxs)(_.L.StepForm,{initialValues:p,labelCol:{span:8},wrapperCol:{span:14},layout:"horizontal",title:r.t("basicConfig","Basic information"),children:[(0,a.jsx)(ee.Z,{hidden:!0,name:"id"}),(0,a.jsx)(ee.Z,{name:"name",label:r.t("name.label","Name"),width:"md",rules:[{required:!0,message:r.t("name.required","Please input role name!")}]}),(0,a.jsx)(ee.Z,{name:"description",label:r.t("description.label","Description"),width:"md"})]}),(0,a.jsx)(_.L.StepForm,{initialValues:{},title:r.t("permission.title","Permission"),children:(0,a.jsx)(be.Z,{checkable:!0,height:re,defaultExpandAll:!0,checkedKeys:L,onCheck:function(f){M(f)},treeData:j(H,"")})})]})},Me=Le,Ue=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return u=P.default.loading("Adding ..."),t.prev=1,delete s.id,t.next=5,Re(s);case 5:return u(),P.default.success("Added successfully"),t.abrupt("return",!0);case 10:return t.prev=10,t.t0=t.catch(1),u(),P.default.error("Adding failed, please try again!"),t.abrupt("return",!1);case 15:case"end":return t.stop()}},n,null,[[1,10]])}));return function(s){return d.apply(this,arguments)}}(),We=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=P.default.loading("Configuring"),t.prev=1,!s.id){t.next=10;break}return t.next=5,we({id:s.id},s);case 5:return u(),P.default.success("update is successful"),t.abrupt("return",!0);case 10:return P.default.success("update failed, system error"),t.abrupt("return",!1);case 12:t.next=19;break;case 14:return t.prev=14,t.t0=t.catch(1),u(),P.default.error("Configuration failed, please try again!"),t.abrupt("return",!1);case 19:case"end":return t.stop()}},n,null,[[1,14]])}));return function(s){return d.apply(this,arguments)}}(),de=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=P.default.loading("Deleting ..."),s){t.next=3;break}return t.abrupt("return",!0);case 3:return t.prev=3,t.next=6,je(s.map(function(S){return{id:S.id}}));case 6:return u(),P.default.success("Deleted successfully and will refresh soon"),t.abrupt("return",!0);case 11:return t.prev=11,t.t0=t.catch(3),u(),P.default.error("Delete failed, please try again: ".concat(t.t0)),t.abrupt("return",!1);case 16:case"end":return t.stop()}},n,null,[[3,11]])}));return function(s){return d.apply(this,arguments)}}(),$e=function(){var n=(0,C.useState)(!1),s=(0,w.Z)(n,2),u=s[0],r=s[1],t=(0,C.useState)(!1),S=(0,w.Z)(t,2),E=S[0],K=S[1],p=(0,C.useRef)(),A=(0,C.useState)(),B=(0,w.Z)(A,2),R=B[0],O=B[1],Y=(0,C.useState)([]),H=(0,w.Z)(Y,2),T=H[0],V=H[1],k=(0,C.useState)(),L=(0,w.Z)(k,2),M=L[0],te=L[1],m=new ue.f("pages.roles",(0,ge.YB)()),re=function(){var Z=(0,y.Z)((0,l.Z)().mark(function v(o){var c;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=(0,g.Z)({},o),M&&(c=(0,g.Z)({keywords:M},c)),i.abrupt("return",Se(c));case 3:case"end":return i.stop()}},v)}));return function(o){return Z.apply(this,arguments)}}(),U=[{title:m.t("title.name","Role Name"),dataIndex:"name"},{title:m.t("title.describe","Describe"),dataIndex:"describe"},{title:m.t("title.createTime","Create Time"),dataIndex:"create_time",render:function(v,o){return Ze()(o.createTime).locale(m.locale).format("YYYY-MM-DD HH:mm:ss")}},{title:m.t("title.operate","Operate"),dataIndex:"option",valueType:"option",render:function(v,o){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{onClick:function(){r(!0),O(o)},children:m.t("button.change","Change")},"change"),(0,a.jsx)(ve.Z,{type:"vertical"}),(0,a.jsx)(me.Z,{title:m.t("delete.popconfirm","Are you sure you want to delete the role named: {name}?",void 0,{name:o.name}),onConfirm:(0,y.Z)((0,l.Z)().mark(function c(){var j;return(0,l.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,de([o]);case 2:if(!f.sent){f.next=4;break}(j=p.current)===null||j===void 0||j.reload();case 4:case"end":return f.stop()}},c)})),children:(0,a.jsx)("a",{children:m.t("button.delete","Delete")})},"delete")]})}}];return(0,a.jsxs)(Te.Oc,{children:[(0,a.jsx)(Oe.ZP,{actionRef:p,rowKey:"id",search:!1,toolbar:{search:!0,onSearch:function(v){if(te(v),p.current){var o,c;(o=(c=p.current).setPageInfo)===null||o===void 0||o.call(c,(0,g.Z)((0,g.Z)({},p.current.pageInfo),{},{current:1})),p.current.reload()}},actions:[(0,a.jsxs)(le.Z,{type:"primary",onClick:function(){r(!0)},children:[(0,a.jsx)(Pe.Z,{}),m.t("button.create","Create")]},"create")]},request:re,columns:U,tableAlertRender:!1,rowSelection:{onChange:function(v,o){V(o)}}}),(T==null?void 0:T.length)>0&&(0,a.jsx)(De.Z,{extra:(0,a.jsxs)("div",{children:[m.t("chosen","Chosen")," ",(0,a.jsx)("a",{style:{fontWeight:600},children:T.length})," ",m.t("item","Items")]}),children:(0,a.jsx)(le.Z,{danger:!0,onClick:function(){F.Z.confirm({title:m.t("delete.confirm","Are you sure you want to delete the following roles?            "),icon:(0,a.jsx)(oe.Z,{}),onOk:function(){return(0,y.Z)((0,l.Z)().mark(function o(){var c,j;return(0,l.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,de(T);case 2:V([]),(c=p.current)===null||c===void 0||(j=c.reloadAndRest)===null||j===void 0||j.call(c);case 4:case"end":return f.stop()}},o)}))()},content:(0,a.jsx)(z.ZP,{dataSource:T,rowKey:"id",renderItem:function(o){return(0,a.jsx)(z.ZP.Item,{children:o.name})}})})},children:m.t("button.batchDeletion","Batch deletion")})}),(0,a.jsx)(Me,{onSubmit:function(){var Z=(0,y.Z)((0,l.Z)().mark(function v(o){var c;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(R?We:Ue)(o);case 2:return c=i.sent,c&&(r(!1),O(void 0),p.current&&p.current.reload()),i.abrupt("return",c);case 5:case"end":return i.stop()}},v)}));return function(v){return Z.apply(this,arguments)}}(),onCancel:function(){r(!1),E||O(void 0)},modalVisible:u,values:R,parentIntl:m}),(0,a.jsx)(ae.Z,{width:600,open:E,onClose:function(){O(void 0),K(!1)},closable:!1,children:E&&(R==null?void 0:R.id)&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Ee.ZP,{column:2,title:m.t("detail.title","Role Details"),request:(0,y.Z)((0,l.Z)().mark(function Z(){return(0,l.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",{data:R||{}});case 1:case"end":return o.stop()}},Z)})),params:{id:R==null?void 0:R.id},columns:U})})})]})},xe=$e},62350:function(ne,b,e){"use strict";var x=e(38663),ae=e.n(x),pe=e(57663),z=e(20136),se=e(44887),F=e.n(se)}}]);
