(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[532],{50317:function(ke){ke.exports={SearchInput:"SearchInput___PEFkt",ProxyUrlInput:"ProxyUrlInput___3liOo"}},55356:function(ke,xe,e){"use strict";e.r(xe),e.d(xe,{default:function(){return xr}});var A=e(2824),x=e(39428),u=e(11849),ir=e(34792),W=e(48086),z=e(3182),v=e(67294),Pe=e(21010),Ee=e(44728),k=e(93400),qe=e(90949),ur=e(75362),be=e(91220),me=e(2844),te=e(14300),q=e(88293),ae=e(69610),_e=e(54941),Re=e(56188),Be=function(){function E(){(0,ae.Z)(this,E),this.generator=void 0,this.generator=new Re.C(0,1,{workerIdBits:5,datacenterIdBits:5,sequenceBits:12})}return(0,_e.Z)(E,null,[{key:"generate",value:function(){return this.getInstance().generator.nextId().toString()}},{key:"getInstance",value:function(){return this.instance?this.instance:(this.instance=new E,this.instance)}}]),E}();Be.instance=void 0;var fe=function(){return Be.generate()},pe=e(62448),ne=e(5966),y=e(90672),Ve=e(64317),er=e(61674),Ne=e(7717),or=e(57663),J=e(71577),_=e(86582),R=e(66456),se=e(78587),le=e(47673),he=e(28166),Ie=e(43358),ye=e(66074),ie=e(77883),D=e(49747),ge=e(32059),ue=e(93224),G=e(9715),ee=e(63202),oe=e(80454),Ce=e(96486),Ke=e.n(Ce),De=e(64140),$e=e(42762),rr=e(82061),we=e(51042),Fe=e(63434),tr=e(31649),ar=e(50317),We=e.n(ar),r=e(85893),ze=["title","editable","children","dataIndex","record","handleSave","options","inputType"],nr=["className","style"],Ge=(0,De.W6)(function(){return(0,r.jsx)($e.Z,{style:{cursor:"grab",color:"#999"}})}),Se=v.createContext(null),He=(0,De.W8)(function(E){var a=ee.Z.useForm(),t=(0,A.Z)(a,1),o=t[0];return(0,r.jsx)(ee.Z,{form:o,component:!1,children:(0,r.jsx)(Se.Provider,{value:o,children:(0,r.jsx)("tr",(0,u.Z)({className:"editable-row"},E))})})}),Je=(0,De.JN)(function(E){return(0,r.jsx)("tbody",(0,u.Z)({},E))}),Qe=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"].map(function(E){return{value:E,label:E}}),de=function E(a){if((0,Ce.isArray)(a)){var t=(0,be.Z)(a),o;try{for(t.s();!(o=t.n()).done;){var m=o.value;if(!E(m))return!1}}catch(s){t.e(s)}finally{t.f()}return!0}else if((0,Ce.isString)(a))return!Boolean(a.trim());return!Boolean(a)},M=function(a){var t=a.title,o=a.editable,m=a.children,s=a.dataIndex,g=a.record,l=a.handleSave,K=a.options,V=a.inputType,C=(0,ue.Z)(a,ze),U=(0,v.useState)(!1),T=(0,A.Z)(U,2),b=T[0],p=T[1],Z=(0,v.useRef)(null),$=(0,v.useContext)(Se);(0,v.useEffect)(function(){b&&Z.current.focus()},[b]);var H=function(){p(!b),$.setFieldsValue((0,ge.Z)({},s,g[s]))},O=function(){var w=(0,z.Z)((0,x.Z)().mark(function c(){var N;return(0,x.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:return F.prev=0,F.next=3,$.validateFields();case 3:N=F.sent,H(),l((0,u.Z)((0,u.Z)({},g),N)),F.next=11;break;case 8:F.prev=8,F.t0=F.catch(0),console.error("Save failed:",F.t0);case 11:case"end":return F.stop()}},c,null,[[0,8]])}));return function(){return w.apply(this,arguments)}}(),L=function(){switch(V){case"number":return(0,r.jsx)(D.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O});case"select":return(0,r.jsx)(ye.Z,{ref:Z,size:"small",onBlur:O,options:K});default:return(0,r.jsx)(he.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O})}}(),Q=m;return o&&(Q=b?(0,r.jsx)(ee.Z.Item,{className:We().ProxyUrlInput,style:{margin:0},name:s,rules:[{required:!0,message:""}],children:L}):(0,r.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:H,children:de(m)?(0,r.jsx)(r.Fragment,{children:"\xA0"}):m})),(0,r.jsx)("td",(0,u.Z)((0,u.Z)({},C),{},{children:Q}))},Me=function(a){var t=a.parentIntl,o=a.dataSource,m=a.setDataSource,s=(0,v.useState)(240),g=(0,A.Z)(s,2),l=g[0],K=g[1],V=o.domain,C=o.urls,U=o.upstream,T=o.insecureSkipVerify,b=o.transparentServerName,p=(0,v.useState)(0),Z=(0,A.Z)(p,2),$=Z[0],H=Z[1],O=(0,v.useState)(),L=(0,A.Z)(O,2),Q=L[0],w=L[1],c=(0,v.useMemo)(function(){return new k.f("proxy",t)},[t]);(0,v.useEffect)(function(){var f=function(){window.innerHeight>890?K(window.innerHeight-690):K(200)};f(),window.addEventListener("resize",f)},[]),(0,v.useEffect)(function(){var f="",d=(0,be.Z)(C),i;try{for(d.s();!(i=d.n()).done;){var n=i.value;(!n.name||!n.name.trim())&&(f=c.t("name.required","name cannot be empty!")),(!n.method||!n.method.trim())&&(f=c.t("method.required","method cannot be empty!")),(!n.url||!n.url.trim())&&(f=c.t("url.required","URL cannot be empty!"))}}catch(S){d.e(S)}finally{d.f()}w(f)},[c,C]);var N=function(d){var i=d.oldIndex,n=d.newIndex;if(i!==n){var S=(0,oe.q)(C.slice(),i,n).filter(function(j){return!!j});m((0,u.Z)((0,u.Z)({},o),{},{urls:S}))}},h=function(d){return(0,r.jsx)(Je,(0,u.Z)({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:N},d))},F=function(d){var i=d.className,n=d.style,S=(0,ue.Z)(d,nr),j=C.findIndex(function(I){return I.id===S["data-row-key"]});return(0,r.jsx)(He,(0,u.Z)({index:j},S))},Xe=function(d){m(function(i){var n,S=(n=i==null?void 0:i.urls.map(function(j){return j.id===d.id?d:j}))!==null&&n!==void 0?n:[];return(0,u.Z)((0,u.Z)({},i),{},{urls:S})})},Ze=[{dataIndex:"sort",width:30,className:"drag-visible",render:function(){return(0,r.jsx)(Ge,{})}},{width:150,title:c.t("name.title","Name"),dataIndex:"name",inputType:"text",editable:!0},{title:c.t("method.title","Method"),dataIndex:"method",inputType:"select",width:100,options:Qe,editable:!0},{title:c.t("url.title","URL"),dataIndex:"url",inputType:"text",editable:!0},{width:30,render:function(d,i){return[(0,r.jsx)("a",{onClick:(0,z.Z)((0,x.Z)().mark(function n(){return(0,x.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:m(function(I){return(0,u.Z)((0,u.Z)({},I),{},{urls:I.urls.filter(function(ce){return ce.id!==i.id})})});case 1:case"end":return j.stop()}},n)})),children:(0,r.jsx)(rr.Z,{})},"delete")]}}],Te=Ze.map(function(f){return f.editable?(0,u.Z)((0,u.Z)({},f),{},{onCell:function(i){return{record:i,editable:f.editable,dataIndex:f.dataIndex,inputType:f.inputType,options:f.options,title:f.title,handleSave:Xe}}}):f});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ne.Z,{name:["proxy","domain"],label:c.t("domain.label","Domain"),colProps:{span:12},initialValue:V,rules:[{required:!0,message:c.t("domain.required","domain cannot be empty!")}]}),(0,r.jsx)(ne.Z,{name:["proxy","upstream"],label:c.t("upstream.label","Upstream"),colProps:{span:12},initialValue:U,tooltip:(0,r.jsxs)(r.Fragment,{children:[c.t("upstream.example","Example"),":",(0,r.jsx)("br",{}),(0,r.jsx)("li",{children:"abc.com"}),(0,r.jsx)("li",{children:"http://abc.com:80"}),(0,r.jsx)("li",{children:"http://1.2.3.4"}),(0,r.jsx)("li",{children:"https://abc.com"})]}),rules:[{required:!0,message:c.t("upstream.required","upstream cannot be empty!")}]}),(0,r.jsx)(Fe.Z,{name:["proxy","insecureSkipVerify"],label:c.t("insecureSkipVerify.label","Skip TLS Verify"),colProps:{span:12},initialValue:T,tooltip:c.t("insecureSkipVerify.describe","When requesting back-end servers, the certificate verification is ignored (insecure).")}),(0,r.jsx)(Fe.Z,{name:["proxy","transparentServerName"],label:c.t("transparentServerName.label","Transparent Server Name"),colProps:{span:12},initialValue:b,tooltip:c.t("transparentServerName.describe","When requesting the backend, the domain name requested by the client will be transparently transmitted.")}),(0,r.jsxs)(tr.Z,{colProps:{span:24},label:c.t("url.label","URL"),children:[(0,r.jsx)(se.Z,{pagination:!1,dataSource:C,columns:Te,scroll:{y:l},rowKey:"id",size:"small",components:{body:{wrapper:h,row:F,cell:M}}}),(0,r.jsx)(J.Z,{onClick:function(){m((0,u.Z)((0,u.Z)({},o),{},{urls:[].concat((0,_.Z)(C),[{name:"",id:fe(),method:"*",url:""}])})),H($+1)},type:"dashed",block:!0,children:(0,r.jsx)(we.Z,{})}),(0,r.jsx)("div",{style:{color:"red"},children:Q})]})]})},re=Me,sr=e(18106),je=e(58500),lr=e(49111),Ye=e(19650),vr=e(77576),B=e(12028),dr=e(13062),mr=e(71230),Dr=e(63185),cr=e(9676),fr=e(86504),pr=function(a){var t=a.role,o=a.setRole,m=a.activeKey,s=a.setActiveKey,g=(0,v.useRef)(null),l=(0,v.useState)(!1),K=(0,A.Z)(l,2),V=K[0],C=K[1];return(0,v.useEffect)(function(){if(m===t.id&&!t.name&&C(!0),m===t.id&&V){var U;(U=g.current)===null||U===void 0||U.focus({cursor:"all"})}},[V,m,t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(he.Z,{hidden:!(V&&t.id===m),style:{width:80,padding:0},ref:g,onKeyDown:function(T){T.key=="Enter"&&(o({id:t.id,name:T.currentTarget.value}),C(!1))},onBlur:function(T){o({id:t.id,name:T.target.value}),C(!1)},autoFocus:!0,defaultValue:t.name?t.name:"New Role"}),(0,r.jsxs)("div",{hidden:V&&t.id===m,style:{width:80,overflow:"hidden",textShadow:"0 0 0 aliceblue"},title:t.name,onDoubleClick:function(){s(t.id),C(!0)},children:[(0,r.jsx)(fr.Z,{style:{color:"orange"},hidden:!t.isDefault}),t.name]})]})},hr=function(a){var t=a.urls,o=t===void 0?[]:t,m=a.value,s=m===void 0?[]:m,g=a.onChange,l=(0,v.useState)(),K=(0,A.Z)(l,2),V=K[0],C=K[1],U={add:function(){var p="new-role-".concat(fe());C(p),g==null||g([].concat((0,_.Z)(s),[{name:"",id:p}]))},remove:function(p){Ke().isString(p)?g==null||g(s.filter(function(Z){return Z.id!=p})):W.default.warning("system error: ".concat(p," is not string"))}},T=function(){var b=(0,z.Z)((0,x.Z)().mark(function p(Z){return(0,x.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.next=2,g==null?void 0:g(s.map(function(O){return Z.id==O.id?(0,u.Z)((0,u.Z)({},O),Z):O}));case 2:case"end":return H.stop()}},p)}));return function(Z){return b.apply(this,arguments)}}();return(0,r.jsx)(je.Z,{type:"editable-card",tabPosition:"top",style:{height:350},activeKey:V,onChange:C,onEdit:function(p,Z){U[Z](p)},children:s.map(function(b){return(0,r.jsx)(je.Z.TabPane,{tab:(0,r.jsx)(pr,{role:b,setRole:T,activeKey:V,setActiveKey:C}),tabKey:b.id,children:(0,r.jsxs)(Ye.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{style:{display:o.length===0?"none":"unset"},children:[(0,r.jsx)("div",{style:{paddingBottom:7},children:"Permission"}),(0,r.jsx)(cr.Z.Group,{onChange:function(Z){T((0,u.Z)((0,u.Z)({},b),{},{urls:Z}))},defaultValue:b.urls,children:o.map(function(p){return(0,r.jsx)(mr.Z,{children:(0,r.jsx)(cr.Z,{value:p.id,children:p.name})},p.id)})})]}),(0,r.jsxs)("div",{style:{padding:10},children:["\u9ED8\u8BA4:",(0,r.jsx)(B.Z,{checked:b.isDefault,onChange:function(Z){g==null||g(s.map(function($){return b.id==$.id?(0,u.Z)((0,u.Z)({},$),{},{isDefault:Z}):Z?(0,u.Z)((0,u.Z)({},$),{},{isDefault:!Z}):$}))}})]})]})},b.id)})})},yr=function(a){var t=a.values,o=a.onSubmit,m=a.parentIntl,s=a.loading,g=a.disabled,l=new k.f("form",m),K=(0,v.useState)([]),V=(0,A.Z)(K,2),C=V[0],U=V[1],T=(0,v.useRef)(),b=(0,v.useState)([]),p=(0,A.Z)(b,2),Z=p[0],$=p[1],H=(0,v.useState)([]),O=(0,A.Z)(H,2),L=O[0],Q=O[1],w=(0,v.useState)({domain:"",upstream:"",urls:[{id:fe(),method:"*",name:"default",url:"/"}],insecureSkipVerify:!1,transparentServerName:!0}),c=(0,A.Z)(w,2),N=c[0],h=c[1],F=(0,v.useState)(0),Xe=(0,A.Z)(F,2),Ze=Xe[0],Te=Xe[1];(0,v.useEffect)(function(){var d,i,n,S,j;Te(0),Q((d=t==null||(i=t.roles)===null||i===void 0?void 0:i.map(function(I){return{id:I.id,urls:I.urls,name:I.name,isDefault:I.isDefault}}))!==null&&d!==void 0?d:[]),$((n=t==null?void 0:t.users)!==null&&n!==void 0?n:[]),h((0,u.Z)({domain:"",upstream:"",transparentServerName:!0,insecureSkipVerify:!1,urls:[{id:fe(),method:"*",name:"default",url:"/"}]},(S=t==null?void 0:t.proxy)!==null&&S!==void 0?S:{})),U((j=t==null?void 0:t.grantType)!==null&&j!==void 0?j:[])},[t]);var f=function(i){return(i??[]).includes(te.qJ.proxy)};return(0,r.jsxs)(pe.L,{stepsProps:{size:"small"},formProps:{preserve:!1,disabled:g,loading:s},onCurrentChange:function(){var d=(0,z.Z)((0,x.Z)().mark(function i(n){var S;return(0,x.Z)().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:n==1&&!f((S=T.current)===null||S===void 0?void 0:S.getFieldValue("grantType"))?Te(n+(Ze===0?1:-1)):Te(n);case 1:case"end":return I.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),current:Ze,onFinish:function(){var d=(0,z.Z)((0,x.Z)().mark(function i(n){var S,j,I,ce,Oe,Ue,Le,ve,Ae,Y;return(0,x.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return S=te.FQ.manual,j=n.grantMode,I=n.grantType,ce=n.status,Oe=N.domain,Ue=N.upstream,Le=N.urls,ve=N.transparentServerName,Ae=N.insecureSkipVerify,Y=Le.map(function(X){var Er=X.id,br=X.method,Ir=X.name,Cr=X.url;return{id:Er,method:br,name:Ir,url:Cr}}),P.abrupt("return",o((0,u.Z)((0,u.Z)({},n),{},{users:Z.map(function(X){return{id:X.id,roleId:X.roleId}}),status:ce!==te.w$.unknown?ce:te.w$.normal,roles:L.map(function(X){return f(I)?X:(0,u.Z)((0,u.Z)({},X),{},{urls:void 0})}),grantMode:j??S,grantType:I??[te.qJ.none],proxy:f(I)?{domain:Oe,upstream:Ue,urls:Y,insecureSkipVerify:Ae,transparentServerName:ve}:void 0})));case 5:case"end":return P.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),children:[(0,r.jsxs)(pe.L.StepForm,{initialValues:t,labelCol:{span:8},formRef:T,wrapperCol:{span:14},layout:"vertical",title:l.t("basicConfig.title","Basic"),onFinish:(0,z.Z)((0,x.Z)().mark(function d(){return(0,x.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t&&!t.id)){n.next=3;break}return W.default.error(l.t("app-id.empty","System error, application ID is empty")),n.abrupt("return",!1);case 3:return n.abrupt("return",!0);case 4:case"end":return n.stop()}},d)})),children:[(0,r.jsx)(me.HZ,{label:l.t("avatar.label","Avatar"),name:"avatar"}),(0,r.jsx)(ne.Z,{hidden:!0,name:"id"}),(0,r.jsx)(ne.Z,{name:"name",label:l.t("name.label","Name"),width:"md",rules:[{required:!0,message:l.t("name.required","Please input app name!")},{pattern:/^[-_A-Za-z0-9]+$/,message:l.t("name.invalid","App name format error!")}],disabled:!!(t!=null&&t.name)}),(0,r.jsx)(ne.Z,{name:"displayName",label:l.t("displayName.label","Display Name"),width:"md"}),(0,r.jsx)(y.Z,{name:"description",label:l.t("description.label","Description"),width:"md"}),(0,r.jsx)(ne.Z,{name:"url",label:l.t("url.label","URL"),width:"md",rules:[{required:!0,message:l.t("url.required","Please input url!")}]}),(0,r.jsx)(Ve.Z,{name:"grantType",label:l.t("grantType.label","Grant Type"),width:"md",mode:"tags",options:(0,q.MM)(te.qJ,m,"grantType.value"),rules:[{required:!0,message:l.t("grantType.required","Please select Grant Type!")}],fieldProps:{onChange:U}}),(0,r.jsx)(Ve.Z,{name:"grantMode",label:l.t("grantMode.label","Grant Mode"),width:"md",options:(0,q.MM)(te.FQ,m,"grantMode.value"),rules:[{required:!0,message:l.t("grantMode.required","Please select Grant Mode!")}]})]}),(0,r.jsx)(pe.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("proxy.title","Proxy"),grid:!0,onFinish:function(){var d=(0,z.Z)((0,x.Z)().mark(function i(n){var S,j,I,ce,Oe,Ue,Le,ve,Ae,Y;return(0,x.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:j=(S=n.proxy)!==null&&S!==void 0?S:{},I=j.domain,ce=j.upstream,Oe=j.transparentServerName,Ue=j.insecureSkipVerify,h((0,u.Z)((0,u.Z)({},N),{},{domain:I,upstream:ce,transparentServerName:Oe,insecureSkipVerify:Ue})),Le=N.urls,ve=(0,be.Z)(Le),P.prev=4,ve.s();case 6:if((Ae=ve.n()).done){P.next=19;break}if(Y=Ae.value,!(!Y.name||!Y.name.trim())){P.next=11;break}return W.default.error(l.t("name.required","name cannot be empty!")),P.abrupt("return",!1);case 11:if(!(!Y.method||!Y.method.trim())){P.next=14;break}return W.default.error(l.t("proxy.method.required","method cannot be empty!")),P.abrupt("return",!1);case 14:if(!(!Y.url||!Y.url.trim())){P.next=17;break}return W.default.error(l.t("proxy.url.required","URL cannot be empty!")),P.abrupt("return",!1);case 17:P.next=6;break;case 19:P.next=24;break;case 21:P.prev=21,P.t0=P.catch(4),ve.e(P.t0);case 24:return P.prev=24,ve.f(),P.finish(24);case 27:return P.abrupt("return",!0);case 28:case"end":return P.stop()}},i,null,[[4,21,24,27]])}));return function(i){return d.apply(this,arguments)}}(),children:Ze===1&&(0,r.jsx)(re,{dataSource:N,setDataSource:h,parentIntl:l})}),(0,r.jsx)(pe.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("role.title","Role"),children:Ze===2&&(0,r.jsx)(er.Z,{name:"rules",rules:[{validator:function(){if(L.length>0){if(L.filter(function(n){return n.isDefault}).length!=1)return Promise.reject(new Error("No default role specified!"));var i=L.map(function(n){return n.name});if(i.some(function(n,S){return i.includes(n,S+1)}))return Promise.reject(new Error("Contains duplicate role names!"));if(i.some(function(n){return!Boolean(n)}))return Promise.reject(new Error("Contains empty role names!"))}return Promise.resolve()}}],children:(0,r.jsx)(hr,{value:L,urls:f(C)?N.urls:[],onChange:Q})})}),(0,r.jsx)(pe.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("user.title","User"),children:Ze===3&&(0,r.jsx)("div",{style:{height:"calc( 100vh - 400px )"},children:(0,r.jsx)(Ne.ZP,{users:Z,roles:L,onChange:$,granting:!0,parentIntl:m})})})]})},gr=yr,Zr=function(){var E=(0,z.Z)((0,x.Z)().mark(function a(t){var o;return(0,x.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=W.default.loading("Adding ..."),s.prev=1,s.next=4,(0,Ee.ri)((0,u.Z)({},t));case 4:return o(),W.default.success("Added successfully"),s.abrupt("return",!0);case 9:return s.prev=9,s.t0=s.catch(1),o(),W.default.error("Adding failed, please try again!"),s.abrupt("return",!1);case 14:case"end":return s.stop()}},a,null,[[1,9]])}));return function(t){return E.apply(this,arguments)}}(),Sr=function(){var E=(0,z.Z)((0,x.Z)().mark(function a(t){var o;return(0,x.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(o=W.default.loading("Configuring"),s.prev=1,!t.id){s.next=10;break}return s.next=5,(0,Ee.KT)({id:t.id},{id:t.id,name:t.name,status:t.status,description:t.description,grantType:t.grantType,grantMode:t.grantMode,avatar:t.avatar,roles:t.roles,users:t.users,proxy:t.proxy,url:t.url,displayName:t.displayName});case 5:return o(),W.default.success("update is successful"),s.abrupt("return",!0);case 10:return W.default.success("update failed, system error"),s.abrupt("return",!1);case 12:s.next=19;break;case 14:return s.prev=14,s.t0=s.catch(1),o(),W.default.error("Configuration failed, please try again!"),s.abrupt("return",!1);case 19:case"end":return s.stop()}},a,null,[[1,14]])}));return function(t){return E.apply(this,arguments)}}(),jr=function(a){var t=a.match.params.aid,o=a.history,m=new k.f("pages.apps",(0,Pe.YB)()),s=(0,v.useState)(),g=(0,A.Z)(s,2),l=g[0],K=g[1],V=(0,v.useState)(!1),C=(0,A.Z)(V,2),U=C[0],T=C[1],b=(0,v.useState)(!1),p=(0,A.Z)(b,2),Z=p[0],$=p[1],H=function(){var O=(0,z.Z)((0,x.Z)().mark(function L(Q){var w,c;return(0,x.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.prev=0,T(!0),h.next=4,(0,Ee.BN)({id:Q});case 4:return w=h.sent,w.data&&(c=w.data,K(c)),T(!1),h.abrupt("return",w);case 10:return h.prev=10,h.t0=h.catch(0),$(!0),h.t0.handled||console.error("failed to get app info: ".concat(h.t0)),h.abrupt("return",{success:!1});case 15:case"end":return h.stop()}},L,null,[[0,10]])}));return function(Q){return O.apply(this,arguments)}}();return(0,v.useEffect)(function(){t?H(t):K({})},[t]),(0,r.jsx)(ur.ZP,{title:t?l==null?void 0:l.name:!1,children:(0,r.jsx)(qe.ZP,{children:l?(0,r.jsx)(gr,{onSubmit:function(){var O=(0,z.Z)((0,x.Z)().mark(function L(Q){var w,c;return(0,x.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:return h.next=2,(l!=null&&l.id?Sr:Zr)(Q);case 2:return w=h.sent,w&&o.push("/apps/".concat((c=l==null?void 0:l.id)!==null&&c!==void 0?c:"")),h.abrupt("return",w);case 5:case"end":return h.stop()}},L)}));return function(L){return O.apply(this,arguments)}}(),values:l!=null&&l.id?l:void 0,parentIntl:m,loading:U,disabled:Z}):null})})},xr=jr},7717:function(ke,xe,e){"use strict";e.d(xe,{DV:function(){return Ne}});var A=e(48736),x=e(27049),u=e(71748),ir=e(90860),W=e(47673),z=e(28166),v=e(39428),Pe=e(86582),Ee=e(3182),k=e(2824),qe=e(93224),ur=e(43358),be=e(66074),me=e(11849),te=e(54421),q=e(38272),ae=e(67294),_e=e(58533),Re=e(2844),Be=e(10861),fe=e(93400),pe=e(50317),ne=e.n(pe),y=e(85893),Ve=["type","loading"],er=function(J){var _=J.users,R=J.onChange,se=J.roles,le=J.loading,he=J.granting,Ie=J.parentIntl,ye=new fe.f("users",Ie);return(0,y.jsx)(q.ZP,{dataSource:_,size:"small",loading:le,renderItem:function(D){var ge,ue;return(0,y.jsxs)(q.ZP.Item,{actions:R&&he?[(0,y.jsx)("a",{onClick:function(){R(_.filter(function(ee){return ee.id!=D.id}))},children:ye.t("userList.delete","Delete")},"grant")]:[],children:[(0,y.jsx)(q.ZP.Item.Meta,{avatar:(0,y.jsx)(Re.ZP,{src:"".concat(D.avatar)}),title:D.fullName?D.fullName:D.username,description:D.email}),R&&he&&se.length>0?(0,y.jsx)(be.Z,{onSelect:function(ee){R(_.map(function(oe){return oe.id==D.id?(0,me.Z)((0,me.Z)({},oe),{},{roleId:ee}):oe}))},defaultValue:D&&D.roleId?D.roleId:(ge=se.find(function(G){return G.isDefault}))===null||ge===void 0?void 0:ge.id,options:se.map(function(G){return{key:G.id,value:G.id,label:G.name}})}):(0,y.jsx)("div",{children:D&&D.role?D.role:(ue=se.find(function(G){return G.isDefault}))===null||ue===void 0?void 0:ue.name})]},D.id)}})},Ne=function(J){var _=J.type,R=_===void 0?"vertical":_,se=J.loading,le=(0,qe.Z)(J,Ve),he=le.roles,Ie=le.onChange,ye=le.users,ie=le.granting,D=le.parentIntl,ge=new fe.f("grant",D),ue=(0,ae.useState)(!0),G=(0,k.Z)(ue,2),ee=G[0],oe=G[1],Ce=(0,ae.useState)(0),Ke=(0,k.Z)(Ce,2),De=Ke[0],$e=Ke[1],rr=(0,ae.useState)(),we=(0,k.Z)(rr,2),Fe=we[0],tr=we[1],ar=(0,ae.useState)([]),We=(0,k.Z)(ar,2),r=We[0],ze=We[1],nr=(0,ae.useState)(!1),Ge=(0,k.Z)(nr,2),Se=Ge[0],He=Ge[1],Je=function(){var de=(0,Ee.Z)((0,v.Z)().mark(function M(Me){var re,sr,je,lr,Ye;return(0,v.Z)().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.prev=0,He(!0),B.next=4,(0,Be.Rf)((0,me.Z)({current:De+1,pageSize:20,keywords:Fe},Me));case 4:re=B.sent,re&&re.data?(sr=re.data,je=re.current,lr=re.pageSize,Ye=re.total,ze(function(dr){return[].concat((0,Pe.Z)(dr),(0,Pe.Z)(sr))}),$e(je),Ye<je*lr&&oe(!1)):oe(!1),B.next=11;break;case 8:B.prev=8,B.t0=B.catch(0),B.t0.handled||console.error("failed to get user list: ".concat(B.t0));case 11:return B.prev=11,He(!1),B.finish(11);case 14:case"end":return B.stop()}},M,null,[[0,8,11,14]])}));return function(Me){return de.apply(this,arguments)}}(),Qe=function(M){ze([]),tr(M),$e(1),Je({keywords:M,current:1})};return(0,ae.useEffect)(function(){Qe()},[]),(0,y.jsxs)("div",{style:{height:"100%",width:"100%"},children:[ie&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{style:{height:R==="vertical"?"calc(100% / 2)":"100%",display:ie?"block":"none",width:R==="vertical"?"100%":"calc((100% - 32px) / 2)",float:R==="horizontal"?"left":"unset"},children:[(0,y.jsx)(z.Z.Search,{className:ne().SearchInput,onSearch:function(M){Se||Qe(M)},loading:Se}),(0,y.jsx)("div",{id:"scrollableDiv",style:{height:"calc( 100% - 32px )",overflow:"auto",padding:"0 16px",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,y.jsx)(_e.Z,{dataLength:r.length,next:Je,hasMore:ee,loader:(0,y.jsx)(ir.Z,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:(0,y.jsx)(x.Z,{plain:!0,children:"End"}),scrollableTarget:"scrollableDiv",children:(0,y.jsx)(q.ZP,{dataSource:r.filter(function(de){return!ye.map(function(M){return M.id}).includes(de.id)}),size:"small",loading:Se,renderItem:function(M){return(0,y.jsx)(q.ZP.Item,{actions:[(0,y.jsx)("a",{onClick:function(){Ie([].concat((0,Pe.Z)(ye),[(0,me.Z)((0,me.Z)({},M),{},{role:""})]))},children:ge.t("userList.grant","Grant")},"grant")],children:(0,y.jsx)(q.ZP.Item.Meta,{avatar:(0,y.jsx)(Re.ZP,{src:"".concat(M.avatar)}),title:M.fullName?M.fullName:M.username,description:M.email})},M.id)}})})})]}),(0,y.jsx)(x.Z,{type:R==="vertical"?"horizontal":"vertical",style:{height:R==="vertical"?"unset":"100%",margin:R==="vertical"?"10px 0":"0 10px",float:R==="horizontal"?"left":"unset",display:ie?"":"none"}})]}),(0,y.jsx)("div",{id:"scrollableDiv",style:{height:R!=="vertical"||!ie?"100%":"calc((100% - 42px) / 2)",width:R==="horizontal"&&ie?"calc((100% - 32px) / 2)":"100%",overflow:"auto",padding:"0 16px",float:R==="horizontal"?"left":"unset",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,y.jsx)(er,{parentIntl:D,users:ye,granting:ie,roles:he,loading:se,onChange:Ie})})]})};xe.ZP=Ne}}]);
