(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[258],{33055:function(G){G.exports={container:"container___37JKF",loginTypeTabs:"loginTypeTabs___18ST8",lang:"lang___ODW_o",content:"content___3akJJ",oauthIcon:"oauthIcon___1nA12",oauthButton:"oauthButton___1yw-w",oauthIconButton:"oauthIconButton___3nCaL"}},68836:function(G,O,t){"use strict";t.r(O),t.d(O,{default:function(){return Fe}});var U=t(18106),H=t(58500),k=t(49111),z=t(19650),h=t(48736),S=t(27049),I=t(34792),g=t(48086),j=t(91896),s=t(39428),d=t(3182),m=t(2824),e=t(11849),Se=t(86582),Me=t(93224),cn=t(17462),F=t(76772),dn=t(34442),Ie=t(50963),we=t(94184),Ce=t.n(we),Ne=t(96486),b=t(67294),E=t(21010),Be=t(73727),ye=t(45953),ze=t(29791),L=t(14300),ae=t(89652),ue=t(88293),se=t(93400),re=t(72709),Le=t(89366),ce=t(2603),$e=t(64302),Ee=t(29985),De=t(56401),D=t(5966),Re=t(16434),Ve=t(63434),fn=t(57663),Je=t(71577),mn=t(13254),We=t(14277),Oe=t(84059),Ue=t(79090),He=t(21349),n=t(85893),Ke=function(X){var Z=X.parentIntl,B=Z===void 0?new se.f("user.settings.security",(0,E.YB)()):Z,x=X.token,C=new se.f("mfa",B),R=(0,b.useState)(),V=(0,m.Z)(R,2),f=V[0],K=V[1],ie=(0,b.useState)(!1),A=(0,m.Z)(ie,2),T=A[0],Q=A[1],_=function(){var P=(0,d.Z)((0,s.Z)().mark(function u(J){return(0,s.Z)().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:K(void 0),Q(!0),(0,ae.HN)({token:J}).then(function(ee){K(ee.data)}).finally(function(){Q(!1)});case 3:case"end":return Y.stop()}},u)}));return function(J){return P.apply(this,arguments)}}();return(0,b.useEffect)(function(){x&&_(x)},[x]),(0,n.jsxs)(He.Z,{children:[(0,n.jsx)("span",{children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:C.t("code-description","Please obtain two consecutive one-time passwords after scanning and adding MFA and enter them into the input box below."),type:"info",showIcon:!0})}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{width:220,height:140},children:f!=null&&f.secret?(0,n.jsx)(Oe.Qd,{style:{marginLeft:"40px"},value:f==null?void 0:f.secret}):(0,n.jsx)(We.Z,{description:"",style:{width:200,height:128},image:T?(0,n.jsx)(Ue.Z,{}):void 0})}),(0,n.jsx)("div",{style:{display:"grid",width:"100%"},children:(0,n.jsx)(Je.Z,{onClick:function(){x&&_(x)},type:"link",children:C.t("refresh","Refresh")})})]}),(0,n.jsxs)("div",{style:{marginLeft:"50px"},children:[(0,n.jsx)(D.Z,{hidden:!0,width:"sm",name:"token",fieldProps:{value:f==null?void 0:f.token}}),(0,n.jsx)(D.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"firstCode",label:C.t("first-code","First code")}),(0,n.jsx)(D.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"secondCode",label:C.t("second-code","Second code")})]})]})]})},Qe=t(33055),M=t.n(Qe),Ye=["children","allows","loginType","hidden"],q=function(Z){var B=Z.content,x=Z.hidden;return x?null:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:B,type:"error",showIcon:!0})},w=function(Z){var B=Z.children,x=Z.allows,C=Z.loginType,R=Z.hidden,V=(0,Me.Z)(Z,Ye),f=new Set([].concat((0,Se.Z)(x),[x.map(function(K){return L.Bz[K]})]));return f.has(C)?(0,n.jsx)("span",(0,e.Z)((0,e.Z)({hidden:R},V),{},{children:B})):(0,n.jsx)(n.Fragment,{})},ke=function(Z){var B,x,C,R,V=Z.location.query,f=V.redirect_uri,K=V.redirect,ie=(0,b.useState)({success:!0}),A=(0,m.Z)(ie,2),T=A[0],Q=A[1],_=(0,b.useState)("normal"),P=(0,m.Z)(_,2),u=P[0],J=P[1],de=(0,b.useState)(),Y=(0,m.Z)(de,2),ee=Y[0],fe=Y[1],me=(0,E.tT)("@@initialState"),W=me.initialState,Xe=me.setInitialState,r=new se.f("pages.login",(0,E.YB)()),Ae=(0,Ie.cI)(),Te=(0,m.Z)(Ae,1),y=Te[0],ve=["normal","email","sms"],Pe=["mfa_totp","mfa_email","mfa_sms"],Ge=(0,b.useState)(ve.map(function(o){return L.Bz[o]})),he=(0,m.Z)(Ge,2),$=he[0],ge=he[1],qe=(0,b.useState)([]),pe=(0,m.Z)(qe,2),xe=pe[0],_e=pe[1],en=function(i){(0,Ne.isNumber)(i)?J(L.Bz[i]):J(i)},nn=function(){var o=(0,d.Z)((0,s.Z)().mark(function i(){var l,c;return(0,s.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,W==null||(l=W.fetchUserInfo)===null||l===void 0?void 0:l.call(W);case 2:if(c=a.sent,!c){a.next=6;break}return a.next=6,Xe(function(te){return(0,e.Z)((0,e.Z)({},te),{},{currentUser:c})});case 6:case"end":return a.stop()}},i)}));return function(){return o.apply(this,arguments)}}(),tn=(0,b.useState)(!1),je=(0,m.Z)(tn,2),an=je[0],Ze=je[1],sn=function(){var o=(0,d.Z)((0,s.Z)().mark(function i(l){var c,N,a,te,le;return(0,s.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return c=(0,j.Z)({},l),v.prev=1,v.next=4,(0,ae.n$)((0,e.Z)((0,e.Z)({},c),{},{type:u,token:ee}),{skipErrorHandler:!0});case 4:if(a=v.sent,!((N=a.data)!==null&&N!==void 0&&N.nextMethod&&a.data.nextMethod.length>0)){v.next=12;break}ge(a.data.nextMethod),en(a.data.nextMethod[0]),Ze(!0),fe(a.data.token),v.next=25;break;case 12:if(!a.success){v.next=24;break}return te=r.t("success","Login succeeded!"),g.default.success(te),v.next=17,nn();case 17:if(!f){v.next=20;break}return window.location.href=f,v.abrupt("return");case 20:return E.m8.push(K||"/"),v.abrupt("return");case 24:a.errorCode==="E0004"&&(g.default.warning(r.t("".concat((le=a.errorCode)!==null&&le!==void 0?le:"normal",".errorMessage"),a.errorMessage)),E.m8.push("/account/resetPassword?username=".concat(c.username)));case 25:Q(a),v.next=31;break;case 28:v.prev=28,v.t0=v.catch(1),Q({success:!1});case 31:case"end":return v.stop()}},i,null,[[1,28]])}));return function(l){return o.apply(this,arguments)}}(),ne=T.success,rn=T.errorMessage,oe=T.errorCode,on=(0,b.useState)((0,ue.MM)(L.Bz,r,"loginType",function(o){return ve.includes(o)})),be=(0,m.Z)(on,2),ln=be[0],un=be[1],p=(B=W==null?void 0:W.globalConfig)!==null&&B!==void 0?B:null;return(0,b.useEffect)(function(){if(p){for(var o=0;o<p.loginType.length;o++){var i=p.loginType[o];if(i.autoRedirect){var l=(0,re.cN)("/api/v1/user/oauth/".concat(i.id));f&&(l="".concat(l,"?redirect_uri=").concat(encodeURIComponent(f))),window.location.href=l;return}}ge(p.loginType.map(function(c){return c.type}).filter(function(c){return c!==L.Bz.oauth2&&c!==void 0})),_e(p.loginType.filter(function(c){return c.type===L.Bz.oauth2}))}},[p]),(0,b.useEffect)(function(){un((0,ue.MM)(L.Bz,r,"loginType",function(o,i){return $.includes(o)||$.includes(i)})),$.length>0?$.includes(u)||J(L.Bz[$[0]]):Ze(!0)},[$]),(0,n.jsxs)("div",{className:M().container,children:[(0,n.jsx)("div",{className:M().lang,"data-lang":!0,children:E.pD&&(0,n.jsx)(E.pD,{})}),(0,n.jsx)("div",{className:M().content,children:(0,n.jsx)("div",{className:"login-container",children:(0,n.jsxs)(De.U,{logo:(x=p==null?void 0:p.logo)!==null&&x!==void 0?x:(0,re.Ak)("logo.svg"),title:(C=p==null?void 0:p.title)!==null&&C!==void 0?C:"IDAS",subTitle:(R=p==null?void 0:p.subTitle)!==null&&R!==void 0?R:"Identity authentication service",initialValues:{autoLogin:!0},form:y,actions:xe.length>0?(0,n.jsxs)("div",{className:"ant-pro-form-login-page-other",children:[(0,n.jsx)("div",{children:(0,n.jsx)(S.Z,{plain:!0,children:r.t("loginWith","Login with")})},"loginWith"),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,n.jsx)(z.Z,{align:"center",size:24,children:xe.map(function(o){return(0,n.jsx)("div",{className:Ce()(M().oauthIconButton),title:r.t("signInWith","Sign in with {name}","",{name:o.name}),onClick:function(){var l=(0,re.cN)("/api/v1/user/oauth/".concat(o.id));f&&(l="".concat(l,"?redirect_uri=").concat(encodeURIComponent(f))),window.location.href=l},children:(0,n.jsx)("img",{src:o.icon,className:M().oauthIcon})},o.name)})},"loginMethod")})]}):void 0,submitter:$.length>0?void 0:!1,onFinish:function(){var o=(0,d.Z)((0,s.Z)().mark(function i(l){return(0,s.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,sn(l);case 2:case"end":return N.stop()}},i)}));return function(i){return o.apply(this,arguments)}}(),children:[(0,n.jsx)(H.Z,{activeKey:u,onChange:function(i){J(i),Q({success:!0})},className:M().loginTypeTabs,items:ln,centered:!0}),(0,n.jsxs)(w,{hidden:an,loginType:u,allows:["normal"].concat(Pe),children:[(0,n.jsx)(q,{hidden:ne,content:r.t("".concat(oe??"normal",".errorMessage"),rn)}),(0,n.jsx)(D.Z,{name:"username",fieldProps:{size:"large",prefix:(0,n.jsx)(Le.Z,{className:M().prefixIcon}),autoFocus:!0},placeholder:r.t("username.placeholder","Please enter a username"),rules:[{required:!0,message:r.t("username.required","Please enter a username!")}]}),(0,n.jsx)(D.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,n.jsx)(ce.Z,{className:M().prefixIcon})},placeholder:r.t("password.placeholder","Please input a password"),rules:[{required:!0,message:r.t("password.required","Please input a password!")}]})]}),(0,n.jsx)(w,{loginType:u,allows:["mfa_totp"],children:(0,n.jsx)(q,{hidden:ne,content:r.t("totp.errorMessage","verification code error")})}),(0,n.jsxs)(w,{loginType:u,allows:["email","mfa_email"],children:[(0,n.jsx)(q,{hidden:ne,content:r.t("email.errorMessage","Email verification code error")}),(0,n.jsx)(D.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)($e.Z,{className:M().prefixIcon})},name:"email",placeholder:r.t("email.placeholder","Please enter your email"),rules:[{required:!0,message:r.t("email.required","Please enter your email!")}]})]}),(0,n.jsxs)(w,{loginType:u,allows:["sms","mfa_sms"],children:[(0,n.jsx)(q,{hidden:ne,content:r.t("sms.errorMessage","SMS verification code error")}),(0,n.jsx)(D.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(Ee.Z,{className:M().prefixIcon})},name:"phone",placeholder:r.t("phoneNumber.placeholder","Please enter your phone number"),rules:[{required:!0,message:r.t("phoneNumber.required","Please enter your phone number!")},{pattern:/^1\d{10}$/,message:r.t("phoneNumber.invalid","Mobile phone number format error!")}]})]}),(0,n.jsx)(w,{loginType:u,allows:["sms","mfa_sms","mfa_email","email","mfa_totp"],children:(0,n.jsx)(Re.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(ce.Z,{className:M().prefixIcon})},captchaProps:{size:"large",hidden:u==="mfa_totp"},placeholder:r.t("captcha.placeholder","Please enter the verification code"),captchaTextRender:function(i,l){return i?"".concat(l," ").concat(r.t("getCaptchaSecondText","Get verification code")):r.t("phone.getVerificationCode","Get verification code")},name:"code",rules:[{required:!0,message:r.t("captcha.required","Please enter the verification code!")}],onGetCaptcha:(0,d.Z)((0,s.Z)().mark(function o(){var i,l,c;return(0,s.Z)().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:l={type:u},a.t0=u,a.next=a.t0==="mfa_email"?4:a.t0==="email"?6:a.t0==="mfa_sms"?9:a.t0==="sms"?11:13;break;case 4:y.validateFields(["username"]),l.username=y.getFieldValue("username");case 6:return y.validateFields(["email"]),l.email=y.getFieldValue("email"),a.abrupt("break",14);case 9:y.validateFields(["username"]),l.username=y.getFieldValue("username");case 11:y.validateFields(["phone"]),l.phone=y.getFieldValue("phone");case 13:return a.abrupt("break",14);case 14:return a.next=16,(0,ae.Do)(l,{intl:r});case 16:if(c=a.sent,c.success){a.next=19;break}return a.abrupt("return");case 19:fe((i=c.data)===null||i===void 0?void 0:i.token),g.default.success(r.t("captcha.sent","Verification code sent successfully."));case 21:case"end":return a.stop()}},o)}))})}),(0,n.jsx)(w,{loginType:u,allows:["enable_mfa_email","enable_mfa_sms","enable_mfa_totp"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("mfa.errorMessage","Because your user is set to enable multiple factor authentication (MFA), you need to enable at least one MFA authentication method."),type:"info",showIcon:!0})}),(0,n.jsx)(w,{loginType:u,allows:["enable_mfa_sms"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("enableMfa.smsMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(w,{loginType:u,allows:["enable_mfa_email"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("enableMfa.emailMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(w,{style:{width:550,display:"block",transform:"translate(-75px)"},loginType:u,allows:["enable_mfa_totp"],children:(0,n.jsx)(Ke,{token:ee})}),(0,n.jsxs)("div",{style:{marginBottom:10,display:$.length>0?"block":"none"},children:[(0,n.jsx)(Ve.Z,{noStyle:!0,name:"autoLogin",children:r.t("rememberMe","Automatic login")}),(0,n.jsx)(w,{loginType:u,allows:["normal"],children:(0,n.jsx)(Be.rU,{style:{float:"right"},to:ye.A,children:r.t("forgotPassword","Forgot password")})})]})]})})}),(0,n.jsx)(ze.Z,{})]})},Fe=ke},14300:function(G,O,t){"use strict";t.d(O,{FI:function(){return U},Bz:function(){return z},w$:function(){return S},qJ:function(){return I},FQ:function(){return g},J0:function(){return s}});var U;(function(e){e[e.unsafe=0]="unsafe",e[e.general=1]="general",e[e.safe=2]="safe",e[e.very_safe=3]="very_safe"})(U||(U={}));var H;(function(e){e[e.refresh_token=0]="refresh_token",e[e.authorization_code=1]="authorization_code",e[e.password=2]="password",e[e.client_credentials=3]="client_credentials"})(H||(H={}));var k;(function(e){e[e.default=0]="default",e[e.code=1]="code",e[e.token=2]="token"})(k||(k={}));var z;(function(e){e[e.mfa_totp=1]="mfa_totp",e[e.mfa_sms=3]="mfa_sms",e[e.enable_mfa_totp=10]="enable_mfa_totp",e[e.enable_mfa_email=11]="enable_mfa_email",e[e.enable_mfa_sms=12]="enable_mfa_sms",e[e.normal=0]="normal",e[e.mfa_email=2]="mfa_email",e[e.email=4]="email",e[e.sms=5]="sms",e[e.oauth2=6]="oauth2"})(z||(z={}));var h;(function(e){e[e.basic=0]="basic",e[e.signature=1]="signature",e[e.token=2]="token",e[e.token_signature=3]="token_signature"})(h||(h={}));var S;(function(e){e[e.normal=1]="normal",e[e.disable=2]="disable",e[e.unknown=0]="unknown"})(S||(S={}));var I;(function(e){e[e.radius=64]="radius",e[e.none=0]="none",e[e.authorization_code=1]="authorization_code",e[e.implicit=2]="implicit",e[e.password=4]="password",e[e.client_credentials=8]="client_credentials",e[e.proxy=16]="proxy",e[e.oidc=32]="oidc"})(I||(I={}));var g;(function(e){e[e.manual=0]="manual",e[e.full=1]="full"})(g||(g={}));var j;(function(e){e[e.user=0]="user",e[e.system=1]="system"})(j||(j={}));var s;(function(e){e[e.password_expired=4]="password_expired",e[e.normal=0]="normal",e[e.disabled=1]="disabled",e[e.user_inactive=2]="user_inactive"})(s||(s={}));var d;(function(e){e[e.text=0]="text",e[e.digit=3]="digit",e[e.radio=6]="radio",e[e.select=8]="select",e[e.dateRange=12]="dateRange",e[e.dateTime=13]="dateTime",e[e.checkbox=5]="checkbox",e[e.multiSelect=9]="multiSelect",e[e.digitRange=4]="digitRange",e[e.date=11]="date",e[e.textarea=2]="textarea",e[e.switch=7]="switch",e[e.timeRange=10]="timeRange",e[e.dateTimeRange=14]="dateTimeRange"})(d||(d={}));var m;(function(e){e[e.all=0]="all",e[e.disabled=1]="disabled",e[e.enabled=2]="enabled"})(m||(m={}))},88293:function(G,O,t){"use strict";t.d(O,{MM:function(){return U},fs:function(){return H},GG:function(){return k}});var U=function(h,S,I,g){var j=[];for(var s in h)if(Object.prototype.propertyIsEnumerable.call(h,s)&&isNaN(Number(s))){var d=h[s];if(g&&!g(s,d))continue;j.push({label:S.formatMessage({id:"".concat(I,".").concat(s),defaultMessage:s}),key:s,value:d})}return j},H=function(h,S,I,g){var j=new Map;for(var s in h)if(Object.prototype.hasOwnProperty.call(h,s)&&isNaN(Number(s))){var d=h[s];if(g&&!g(s,d))continue;j.set(d,S.formatMessage({id:"".concat(I,".").concat(s),defaultMessage:s}))}return j},k=function(h,S,I,g){var j={};for(var s in h)if(Object.prototype.hasOwnProperty.call(h,s)&&!isNaN(Number(s))){var d,m=h[s];j[s]={text:S.formatMessage({id:"".concat(I,".").concat(m),defaultMessage:m}),status:(d=g[m])!==null&&d!==void 0?d:"Default"}}return j}}}]);
