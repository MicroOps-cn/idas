(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[416],{85064:function(Ge,Ae,r){"use strict";r.d(Ae,{Z:function(){return Ze}});var de=r(28991),Ke=r(28481),cn=r(96156),He=r(81253),le=r(67294),jn=r(94184),se=r.n(jn),wn=(0,le.createContext)({}),he=wn,dn=r(90484),ge=r(86500),S=r(1350),E=2,f=.16,Tn=.05,D=.05,V=.15,Je=5,Pe=4,g=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function We(a){var i=a.r,d=a.g,o=a.b,w=(0,ge.py)(i,d,o);return{h:w.h*360,s:w.s,v:w.v}}function ee(a){var i=a.r,d=a.g,o=a.b;return"#".concat((0,ge.vq)(i,d,o,!1))}function Ye(a,i,d){var o=d/100,w={r:(i.r-a.r)*o+a.r,g:(i.g-a.g)*o+a.g,b:(i.b-a.b)*o+a.b};return w}function Qe(a,i,d){var o;return Math.round(a.h)>=60&&Math.round(a.h)<=240?o=d?Math.round(a.h)-E*i:Math.round(a.h)+E*i:o=d?Math.round(a.h)+E*i:Math.round(a.h)-E*i,o<0?o+=360:o>=360&&(o-=360),o}function Xe(a,i,d){if(a.h===0&&a.s===0)return a.s;var o;return d?o=a.s-f*i:i===Pe?o=a.s+f:o=a.s+Tn*i,o>1&&(o=1),d&&i===Je&&o>.1&&(o=.1),o<.06&&(o=.06),Number(o.toFixed(2))}function Re(a,i,d){var o;return d?o=a.v+D*i:o=a.v-V*i,o>1&&(o=1),Number(o.toFixed(2))}function De(a){for(var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},d=[],o=(0,S.uA)(a),w=Je;w>0;w-=1){var oe=We(o),ue=ee((0,S.uA)({h:Qe(oe,w,!0),s:Xe(oe,w,!0),v:Re(oe,w,!0)}));d.push(ue)}d.push(ee(o));for(var pe=1;pe<=Pe;pe+=1){var me=We(o),Ce=ee((0,S.uA)({h:Qe(me,pe),s:Xe(me,pe),v:Re(me,pe)}));d.push(Ce)}return i.theme==="dark"?g.map(function(ne){var Le=ne.index,$e=ne.opacity,Ie=ee(Ye((0,S.uA)(i.backgroundColor||"#141414"),(0,S.uA)(d[Le]),$e*100));return Ie}):d}var be={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1677FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},P={},Ve={};Object.keys(be).forEach(function(a){P[a]=De(be[a]),P[a].primary=P[a][5],Ve[a]=De(be[a],{theme:"dark",backgroundColor:"#141414"}),Ve[a].primary=Ve[a][5]});var Oe=P.red,An=P.volcano,Pn=P.gold,Rn=P.orange,ke=P.yellow,Fn=P.lime,Fe=P.green,k=P.cyan,qe=P.blue,Nn=P.geekblue,Ln=P.purple,fn=P.magenta,$n=P.grey,En=P.grey,vn=r(80334),pn=r(44958);function mn(a,i){(0,vn.ZP)(a,"[@ant-design/icons] ".concat(i))}function _e(a){return(0,dn.Z)(a)==="object"&&typeof a.name=="string"&&typeof a.theme=="string"&&((0,dn.Z)(a.icon)==="object"||typeof a.icon=="function")}function en(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return Object.keys(a).reduce(function(i,d){var o=a[d];switch(d){case"class":i.className=o,delete i.class;break;default:i[d]=o}return i},{})}function Me(a,i,d){return d?le.createElement(a.tag,(0,de.Z)((0,de.Z)({key:i},en(a.attrs)),d),(a.children||[]).map(function(o,w){return Me(o,"".concat(i,"-").concat(a.tag,"-").concat(w))})):le.createElement(a.tag,(0,de.Z)({key:i},en(a.attrs)),(a.children||[]).map(function(o,w){return Me(o,"".concat(i,"-").concat(a.tag,"-").concat(w))}))}function nn(a){return De(a)[0]}function an(a){return a?Array.isArray(a)?a:[a]:[]}var Dn={width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",focusable:"false"},hn=`
.anticon {
  display: inline-block;
  color: inherit;
  font-style: normal;
  line-height: 0;
  text-align: center;
  text-transform: none;
  vertical-align: -0.125em;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.anticon > * {
  line-height: 1;
}

.anticon svg {
  display: inline-block;
}

.anticon::before {
  display: none;
}

.anticon .anticon-icon {
  display: block;
}

.anticon[tabindex] {
  cursor: pointer;
}

.anticon-spin::before,
.anticon-spin {
  display: inline-block;
  -webkit-animation: loadingCircle 1s infinite linear;
  animation: loadingCircle 1s infinite linear;
}

@-webkit-keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}

@keyframes loadingCircle {
  100% {
    -webkit-transform: rotate(360deg);
    transform: rotate(360deg);
  }
}
`,n=function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:hn,d=(0,le.useContext)(he),o=d.csp,w=d.prefixCls,oe=i;w&&(oe=oe.replace(/anticon/g,w)),(0,le.useEffect)(function(){(0,pn.hq)(oe,"@ant-design-icons",{prepend:!0,csp:o})},[])},gn=["icon","className","onClick","style","primaryColor","secondaryColor"],xe={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};function yn(a){var i=a.primaryColor,d=a.secondaryColor;xe.primaryColor=i,xe.secondaryColor=d||nn(i),xe.calculated=!!d}function Zn(){return(0,de.Z)({},xe)}var Ne=function(i){var d=i.icon,o=i.className,w=i.onClick,oe=i.style,ue=i.primaryColor,pe=i.secondaryColor,me=(0,He.Z)(i,gn),Ce=xe;if(ue&&(Ce={primaryColor:ue,secondaryColor:pe||nn(ue)}),n(),mn(_e(d),"icon should be icon definiton, but got ".concat(d)),!_e(d))return null;var ne=d;return ne&&typeof ne.icon=="function"&&(ne=(0,de.Z)((0,de.Z)({},ne),{},{icon:ne.icon(Ce.primaryColor,Ce.secondaryColor)})),Me(ne.icon,"svg-".concat(ne.name),(0,de.Z)({className:o,onClick:w,style:oe,"data-icon":ne.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},me))};Ne.displayName="IconReact",Ne.getTwoToneColors=Zn,Ne.setTwoToneColors=yn;var ze=Ne;function rn(a){var i=an(a),d=(0,Ke.Z)(i,2),o=d[0],w=d[1];return ze.setTwoToneColors({primaryColor:o,secondaryColor:w})}function tn(){var a=ze.getTwoToneColors();return a.calculated?[a.primaryColor,a.secondaryColor]:a.primaryColor}var Be=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];rn("#1890ff");var ye=le.forwardRef(function(a,i){var d,o=a.className,w=a.icon,oe=a.spin,ue=a.rotate,pe=a.tabIndex,me=a.onClick,Ce=a.twoToneColor,ne=(0,He.Z)(a,Be),Le=le.useContext(he),$e=Le.prefixCls,Ie=$e===void 0?"anticon":$e,Cn=Le.rootClassName,Sn=se()(Cn,Ie,(d={},(0,cn.Z)(d,"".concat(Ie,"-").concat(w.name),!!w.name),(0,cn.Z)(d,"".concat(Ie,"-spin"),!!oe||w.name==="loading"),d),o),Ue=pe;Ue===void 0&&me&&(Ue=-1);var bn=ue?{msTransform:"rotate(".concat(ue,"deg)"),transform:"rotate(".concat(ue,"deg)")}:void 0,ln=an(Ce),sn=(0,Ke.Z)(ln,2),xn=sn[0],In=sn[1];return le.createElement("span",(0,de.Z)((0,de.Z)({role:"img","aria-label":w.name},ne),{},{ref:i,tabIndex:Ue,onClick:me,className:Sn}),le.createElement(ze,{icon:w,primaryColor:xn,secondaryColor:In,style:bn}))});ye.displayName="AntdIcon",ye.getTwoToneColor=tn,ye.setTwoToneColor=rn;var Ze=ye},16894:function(Ge,Ae,r){"use strict";var de=r(4582);Ae.ZP=de.Z},23528:function(Ge){Ge.exports={SearchInput:"SearchInput___1BqFd"}},39295:function(Ge,Ae,r){"use strict";r.r(Ae),r.d(Ae,{default:function(){return Qn}});var de=r(57338),Ke=r(273),cn=r(18106),He=r(58500),le=r(93224),jn=r(54421),se=r(38272),wn=r(71194),he=r(34883),dn=r(57663),ge=r(71577),S=r(11849),E=r(2824),f=r(39428),Tn=r(34792),D=r(48086),V=r(3182),Je=r(30381),Pe=r.n(Je),g=r(67294),We=r(21010),ee=r(14300),Ye=r(72709),Qe=["id"];function Xe(m,t){return Re.apply(this,arguments)}function Re(){return Re=(0,V.Z)((0,f.Z)().mark(function m(t,u){return(0,f.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",(0,Ye.WY)("/api/v1/sessions",(0,S.Z)({method:"GET",params:(0,S.Z)({},t)},u||{})));case 1:case"end":return v.stop()}},m)})),Re.apply(this,arguments)}function De(m,t){return be.apply(this,arguments)}function be(){return be=(0,V.Z)((0,f.Z)().mark(function m(t,u){var s,v;return(0,f.Z)().wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return s=t.id,v=(0,le.Z)(t,Qe),j.abrupt("return",(0,Ye.WY)("/api/v1/sessions/".concat(s),(0,S.Z)({method:"DELETE",params:(0,S.Z)({},v)},u||{})));case 2:case"end":return j.stop()}},m)})),be.apply(this,arguments)}var P=r(10861),Ve=r(88293),Oe=r(93400),An=r(55035),Pn=r(79508),Rn=r(51042),ke=r(57119),Fn=r(81253),Fe=r(96156),k=r(28991),qe=r(28481),Nn=r(95985),Ln=r(85064),fn=function(t,u){return g.createElement(Ln.Z,(0,k.Z)((0,k.Z)({},t),{},{ref:u,icon:Nn.Z}))};fn.displayName="FilterOutlined";var $n=g.forwardRef(fn),En=r(17503),vn=r(93035),pn=r(92124),mn=r(88182),_e=r(94184),en=r.n(_e),Me=r(97435),nn=r(42489),an=r(27350),Dn=function(t){return(0,Fe.Z)({},t.componentCls,{lineHeight:"30px","&::before":{display:"block",height:0,visibility:"hidden",content:"'.'"},"&-small":{lineHeight:t.lineHeight},"&-container":{display:"flex",flexWrap:"wrap",gap:8},"&-item":(0,Fe.Z)({whiteSpace:"nowrap"},"".concat(t.antCls,"-form-item"),{marginBlock:0}),"&-line":{minWidth:"198px"},"&-line:not(:first-child)":{marginBlockStart:"16px",marginBlockEnd:8},"&-collapse-icon":{width:t.controlHeight,height:t.controlHeight,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},"&-effective":(0,Fe.Z)({},"".concat(t.componentCls,"-collapse-icon"),{backgroundColor:t.colorBgTextHover})})};function hn(m){return(0,an.Xj)("LightFilter",function(t){var u=(0,k.Z)((0,k.Z)({},t),{},{componentCls:".".concat(m)});return[Dn(u)]})}var n=r(85893),gn=["size","collapse","collapseLabel","initialValues","onValuesChange","form","placement","formRef","bordered","ignoreRules","footerRender"],xe=function(t){var u=t.items,s=t.prefixCls,v=t.size,e=v===void 0?"middle":v,j=t.collapse,M=t.collapseLabel,B=t.onValuesChange,c=t.bordered,G=t.values,U=t.footerRender,z=t.placement,Q=(0,En.YB)(),R="".concat(s,"-light-filter"),L=hn(R),K=L.wrapSSR,y=L.hashId,W=(0,g.useState)(!1),x=(0,qe.Z)(W,2),Y=x[0],I=x[1],H=(0,g.useState)(function(){return(0,k.Z)({},G)}),J=(0,qe.Z)(H,2),X=J[0],O=J[1];(0,g.useEffect)(function(){O((0,k.Z)({},G))},[G]);var ie=(0,g.useMemo)(function(){var $=[],ae=[];return u.forEach(function(re){var T=re.props||{},C=T.secondary;C||j?$.push(re):ae.push(re)}),{collapseItems:$,outsideItems:ae}},[t.items]),ve=ie.collapseItems,je=ie.outsideItems,Se=function(){return M||(j?(0,n.jsx)($n,{className:"".concat(R,"-collapse-icon ").concat(y)}):(0,n.jsx)(vn.Q,{size:e,label:Q.getMessage("form.lightFilter.more","\u66F4\u591A\u7B5B\u9009"),expanded:Y}))};return K((0,n.jsx)("div",{className:en()(R,y,"".concat(R,"-").concat(e),(0,Fe.Z)({},"".concat(R,"-effective"),Object.keys(G).some(function($){return G[$]}))),children:(0,n.jsxs)("div",{className:"".concat(R,"-container ").concat(y),children:[je.map(function($,ae){var re=$.key,T=$.props.fieldProps,C=T!=null&&T.placement?T==null?void 0:T.placement:z;return(0,n.jsx)("div",{className:"".concat(R,"-item ").concat(y),children:g.cloneElement($,{fieldProps:(0,k.Z)((0,k.Z)({},$.props.fieldProps),{},{placement:C}),proFieldProps:{light:!0,label:$.props.label,bordered:c},bordered:c})},re||ae)}),ve.length?(0,n.jsx)("div",{className:"".concat(R,"-item ").concat(y),children:(0,n.jsx)(pn.M,{padding:24,open:Y,onOpenChange:function(ae){I(ae)},placement:z,label:Se(),footerRender:U,footer:{onConfirm:function(){B((0,k.Z)({},X)),I(!1)},onClear:function(){var ae={};ve.forEach(function(re){var T=re.props.name;ae[T]=void 0}),B(ae)}},children:ve.map(function($){var ae=$.key,re=$.props,T=re.name,C=re.fieldProps,ce=(0,k.Z)((0,k.Z)({},C),{},{onChange:function(fe){return O((0,k.Z)((0,k.Z)({},X),{},(0,Fe.Z)({},T,fe!=null&&fe.target?fe.target.value:fe))),!1}});X.hasOwnProperty(T)&&(ce[$.props.valuePropName||"value"]=X[T]);var te=C!=null&&C.placement?C==null?void 0:C.placement:z;return(0,n.jsx)("div",{className:"".concat(R,"-line ").concat(y),children:g.cloneElement($,{fieldProps:(0,k.Z)((0,k.Z)({},ce),{},{placement:te})})},ae)})})},"more"):null]})}))};function yn(m){var t=m.size,u=m.collapse,s=m.collapseLabel,v=m.initialValues,e=m.onValuesChange,j=m.form,M=m.placement,B=m.formRef,c=m.bordered,G=m.ignoreRules,U=m.footerRender,z=(0,Fn.Z)(m,gn),Q=(0,g.useContext)(mn.ZP.ConfigContext),R=Q.getPrefixCls,L=R("pro-form"),K=(0,g.useState)(function(){return(0,k.Z)({},v)}),y=(0,qe.Z)(K,2),W=y[0],x=y[1],Y=(0,g.useRef)();return(0,g.useImperativeHandle)(B,function(){return Y.current}),(0,n.jsx)(nn.I,(0,k.Z)((0,k.Z)({size:t,initialValues:v,form:j,contentRender:function(H){return(0,n.jsx)(xe,{prefixCls:L,items:H.flatMap(function(J){return(J==null?void 0:J.type.displayName)==="ProForm-Group"?J.props.children:J}),size:t,bordered:c,collapse:u,collapseLabel:s,placement:M,values:W||{},footerRender:U,onValuesChange:function(X){var O,ie,ve=(0,k.Z)((0,k.Z)({},W),X);x(ve),(O=Y.current)===null||O===void 0||O.setFieldsValue(ve),(ie=Y.current)===null||ie===void 0||ie.submit(),e&&e(X,ve)}})},formRef:Y,formItemProps:{colon:!1,labelAlign:"left"},fieldProps:{style:{width:void 0}}},(0,Me.Z)(z,["labelWidth"])),{},{onValuesChange:function(H,J){var X;x(J),e==null||e(H,J),(X=Y.current)===null||X===void 0||X.submit()}}))}var Zn=r(64317),Ne=r(55997),ze=r(43037),rn=r(85224),tn=r(16894),Be=r(2844),ye=r(62448),Ze=r(5966),a=r(48736),i=r(27049),d=r(71748),o=r(90860),w=r(47673),oe=r(28166),ue=r(86582),pe=r(43358),me=r(66074),Ce=r(402),ne=r(97272),Le=r(58533),$e=r(44728),Ie=r(23528),Cn=r.n(Ie),Sn=["type","loading"],Ue=function(t){var u=t.onChange,s=t.loading,v=t.granting,e=t.parentIntl,j=t.apps,M=new Oe.f("apps",e);return(0,n.jsx)(se.ZP,{dataSource:j,size:"small",loading:s,renderItem:function(c){var G,U,z,Q,R;return(0,n.jsxs)(se.ZP.Item,{actions:u&&v?[(0,n.jsx)("a",{onClick:function(){u(j.filter(function(K){return K.id!=c.id}))},children:M.t("appList.delete","Delete")},"grant")]:[],children:[(0,n.jsx)(se.ZP.Item.Meta,{avatar:(0,n.jsx)(Be.ZP,{src:"".concat(c.avatar)}),title:(G=c.displayName)!==null&&G!==void 0?G:c.name,description:(0,n.jsx)(ne.Z.Paragraph,{type:"secondary",ellipsis:{tooltip:c.description},children:(U=c.description)!==null&&U!==void 0?U:""})}),u&&v&&c.roles&&c.roles.length>0?(0,n.jsx)(me.Z,{onSelect:function(K){u(j.map(function(y){return y.id==c.id?(0,S.Z)((0,S.Z)({},y),{},{roleId:K}):y}))},defaultValue:c&&c.roleId?c.roleId:(z=c.roles.find(function(L){return L.isDefault}))===null||z===void 0?void 0:z.id,options:c.roles.map(function(L){return{key:L.id,value:L.id,label:L.name}})}):(0,n.jsx)("div",{children:c&&c.role?c.role:(Q=c.roles)===null||Q===void 0||(R=Q.find(function(L){return L.isDefault}))===null||R===void 0?void 0:R.name})]},c.id)}})},bn=function(t){var u=t.type,s=u===void 0?"vertical":u,v=t.loading,e=(0,le.Z)(t,Sn),j=e.onChange,M=e.apps,B=e.granting,c=e.parentIntl,G=new Oe.f("grant",c),U=(0,g.useState)(!0),z=(0,E.Z)(U,2),Q=z[0],R=z[1],L=(0,g.useState)(0),K=(0,E.Z)(L,2),y=K[0],W=K[1],x=(0,g.useState)(),Y=(0,E.Z)(x,2),I=Y[0],H=Y[1],J=(0,g.useState)([]),X=(0,E.Z)(J,2),O=X[0],ie=X[1],ve=(0,g.useState)(!1),je=(0,E.Z)(ve,2),Se=je[0],$=je[1],ae=function(){var T=(0,V.Z)((0,f.Z)().mark(function C(ce){var te,we,fe,p,on;return(0,f.Z)().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return q.prev=0,$(!0),q.next=4,(0,$e.C6)((0,S.Z)({current:y+1,pageSize:20,keywords:I},ce));case 4:te=q.sent,te&&te.data?(we=te.data,fe=te.current,p=te.pageSize,on=te.total,ie(function(un){return[].concat((0,ue.Z)(un),(0,ue.Z)(we))}),W(fe),on<fe*p&&R(!1)):R(!1),q.next=11;break;case 8:q.prev=8,q.t0=q.catch(0),q.t0.handled||console.error("failed to get app list: ".concat(q.t0));case 11:return q.prev=11,$(!1),q.finish(11);case 14:case"end":return q.stop()}},C,null,[[0,8,11,14]])}));return function(ce){return T.apply(this,arguments)}}(),re=function(C){ie([]),H(C),W(1),ae({keywords:C,current:1})};return(0,g.useEffect)(function(){re()},[]),(0,n.jsxs)("div",{style:{height:s==="vertical"?"calc((100vh - 300px))":"100%",width:"100%"},children:[B&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{height:s==="vertical"?"calc(100% / 2)":"100%",display:B?"block":"none",width:s==="vertical"?"100%":"calc((100% - 32px) / 2)",float:s==="horizontal"?"left":"unset"},children:[(0,n.jsx)(oe.Z.Search,{className:Cn().SearchInput,onSearch:function(C){Se||re(C)},loading:Se}),(0,n.jsx)("div",{id:"scrollableDiv",style:{height:"calc( 100% - 32px )",overflow:"auto",padding:"0 16px",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,n.jsx)(Le.Z,{dataLength:O.length,next:ae,hasMore:Q,loader:(0,n.jsx)(o.Z,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:(0,n.jsx)(i.Z,{plain:!0,children:"End"}),scrollableTarget:"scrollableDiv",children:(0,n.jsx)(se.ZP,{dataSource:O.filter(function(T){return!M.map(function(C){return C.id}).includes(T.id)}),size:"small",loading:Se,renderItem:function(C){var ce,te;return(0,n.jsx)(se.ZP.Item,{actions:[(0,n.jsx)("a",{onClick:function(){j([].concat((0,ue.Z)(M),[(0,S.Z)((0,S.Z)({},C),{},{roleId:""})]))},children:G.t("appList.grant","Grant")},"grant")],children:(0,n.jsx)(se.ZP.Item.Meta,{avatar:(0,n.jsx)(Be.ZP,{src:"".concat(C.avatar)}),title:(ce=C.displayName)!==null&&ce!==void 0?ce:C.name,description:(0,n.jsx)(ne.Z.Paragraph,{type:"secondary",ellipsis:{tooltip:C.description},children:(te=C.description)!==null&&te!==void 0?te:""})})},C.id)}})})})]}),(0,n.jsx)(i.Z,{type:s==="vertical"?"horizontal":"vertical",style:{height:s==="vertical"?"unset":"100%",margin:s==="vertical"?"10px 0":"0 10px",float:s==="horizontal"?"left":"unset",display:B?"":"none"}})]}),(0,n.jsx)("div",{id:"scrollableDiv",style:{height:s!=="vertical"||!B?"100%":"calc((100% - 42px) / 2)",width:s==="horizontal"&&B?"calc((100% - 32px) / 2)":"100%",overflow:"auto",padding:"0 16px",float:s==="horizontal"?"left":"unset",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,n.jsx)(Ue,{parentIntl:c,apps:M.map(function(T){var C;return(0,S.Z)((0,S.Z)({},(C=O.find(function(ce){return ce.id==T.id}))!==null&&C!==void 0?C:T),{},{roleId:T.roleId,role:T.role})}),granting:B,loading:v,onChange:j})})]})},ln=bn,sn=["parentIntl"],xn=function(t){var u=t.parentIntl,s=(0,le.Z)(t,sn),v=new Oe.f("form",u),e=(0,g.useState)(0),j=(0,E.Z)(e,2),M=j[0],B=j[1],c=s.values,G=s.title,U=s.modalVisible,z=s.onSubmit,Q=s.onCancel,R=(0,g.useState)([]),L=(0,E.Z)(R,2),K=L[0],y=L[1];return(0,g.useEffect)(function(){B(0),c!=null&&c.id&&U&&(0,P.bG)({id:c.id}).then(function(W){var x;W.success&&(x=W.data)!==null&&x!==void 0&&x.apps&&y(W.data.apps)})},[c,U]),(0,n.jsxs)(ye.L,{stepsProps:{size:"small"},formProps:{preserve:!1},current:M,onCurrentChange:B,stepsFormRender:function(x,Y){return(0,n.jsx)(he.Z,{width:640,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:G,open:U,footer:Y,onCancel:function(){he.Z.confirm({title:v.t("cancel?","Cancel editing?"),icon:(0,n.jsx)(ke.Z,{}),onOk:function(){Q()},maskClosable:!0})},children:x})},onFinish:function(){var W=(0,V.Z)((0,f.Z)().mark(function x(Y){return(0,f.Z)().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:return H.abrupt("return",z((0,S.Z)((0,S.Z)({},Y),{},{apps:K.map(function(J){return{id:J.id,roleId:J.roleId}}),status:c!=null&&c.status?c.status:ee.J0.normal,isDelete:c!=null&&c.isDelete?c==null?void 0:c.isDelete:!1})));case 1:case"end":return H.stop()}},x)}));return function(x){return W.apply(this,arguments)}}(),children:[(0,n.jsxs)(ye.L.StepForm,{initialValues:(0,S.Z)({},c),labelCol:{span:8},wrapperCol:{span:14},layout:"horizontal",title:v.t("title.basicConfig","Basic"),className:"basic-view",children:[(0,n.jsx)(Be.HZ,{label:v.t("avatar.label","Avatar"),name:"avatar"}),(0,n.jsx)(Ze.Z,{hidden:!0,name:"id"}),(0,n.jsx)(Ze.Z,{hidden:!0,name:"storage"}),(0,n.jsx)(Ze.Z,{name:"username",label:v.t("userName.label","Username"),width:"md",rules:[{required:!0,message:v.t("userName.required","Please input username!")},{pattern:/^[-_A-Za-z0-9]+$/,message:v.t("name.invalid","Username format error!")}]}),(0,n.jsx)(Ze.Z,{name:"fullName",label:v.t("fullName.label","FullName"),width:"md"}),(0,n.jsx)(Ze.Z,{name:"email",label:v.t("email.label","Email"),width:"md"}),(0,n.jsx)(Ze.Z,{name:"phoneNumber",label:v.t("phoneNumber.label","Telephone number"),width:"md"})]}),(0,n.jsx)(ye.L.StepForm,{className:"grant-view",initialValues:{},title:v.t("app.title","App"),children:(0,n.jsx)(ln,{granting:!0,parentIntl:v,apps:K,onChange:y})})]})},In=xn,kn=r(96486),Mn=["success","failed","onClick"],zn=function(t){var u=t.success,s=t.failed,v=t.onClick,e=(0,le.Z)(t,Mn),j=(0,g.useState)(!1),M=(0,E.Z)(j,2),B=M[0],c=M[1],G=(0,g.useState)(0),U=(0,E.Z)(G,2),z=U[0],Q=U[1];return(0,n.jsx)(ge.Z,(0,S.Z)((0,S.Z)({},e),{},{loading:B,onClick:function(){var R=(0,V.Z)((0,f.Z)().mark(function L(K){var y;return(0,f.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(!v){x.next=16;break}return x.prev=1,c(!0),x.next=5,v(K);case 5:y=x.sent,(0,kn.isBoolean)(y)&&!y?Q(2):Q(1),x.next=13;break;case 9:x.prev=9,x.t0=x.catch(1),D.default.error("".concat(x.t0),3),Q(2);case 13:return x.prev=13,c(!1),x.finish(13);case 16:case"end":return x.stop()}},L,null,[[1,9,13,16]])}));return function(L){return R.apply(this,arguments)}}(),children:z===1&&u?u:z===2&&s?s:e.children}))},Bn=zn,Un=["createTime","loginTime","extendedData","updateTime"],Gn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=D.default.loading("Adding ..."),e.prev=1,delete u.id,e.next=5,(0,P.r4)(u);case 5:return s(),D.default.success("Added successfully"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(1),s(),D.default.error("Adding failed, please try again!"),e.abrupt("return",!1);case 15:case"end":return e.stop()}},t,null,[[1,10]])}));return function(u){return m.apply(this,arguments)}}(),Vn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=D.default.loading("Configuring"),e.prev=1,!u.id){e.next=10;break}return e.next=5,(0,P.Nq)({id:u.id},u);case 5:return s(),D.default.success("update is successful"),e.abrupt("return",!0);case 10:return D.default.success("update failed, system error"),e.abrupt("return",!1);case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(1),s(),D.default.error("Configuration failed, please try again!"),e.abrupt("return",!1);case 19:case"end":return e.stop()}},t,null,[[1,14]])}));return function(u){return m.apply(this,arguments)}}(),Kn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=D.default.loading("enabling ..."),u){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,P.Q8)(u.map(function(j){return{id:j.id,status:ee.J0.normal}}));case 6:return s(),D.default.success("Enabled successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),s(),D.default.error("Enabled failed, please try again"),e.abrupt("return",!1);case 16:case"end":return e.stop()}},t,null,[[3,11]])}));return function(u){return m.apply(this,arguments)}}(),Hn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=D.default.loading("Disabling ..."),u){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,P.Q8)(u.map(function(j){return{id:j.id,status:ee.J0.disabled}}));case 6:return s(),D.default.success("Disabled successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),s(),D.default.error("Disable failed, please try again"),e.abrupt("return",!1);case 16:case"end":return e.stop()}},t,null,[[3,11]])}));return function(u){return m.apply(this,arguments)}}(),Jn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=D.default.loading("Deleting ..."),u){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,(0,P.Vt)(u.map(function(j){return{id:j.id}}));case 6:return s(),D.default.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),s(),D.default.error("Delete failed, please try again: ".concat(e.t0)),e.abrupt("return",!1);case 16:case"end":return e.stop()}},t,null,[[3,11]])}));return function(u){return m.apply(this,arguments)}}(),Wn=function(){var m=(0,V.Z)((0,f.Z)().mark(function t(u){var s;return(0,f.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u){e.next=2;break}return e.abrupt("return",!0);case 2:return s=D.default.loading("Deleting ..."),e.prev=3,e.next=6,De({id:u});case 6:return s(),D.default.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),s(),D.default.error("Delete failed, please try again"),e.abrupt("return",!1);case 16:case"end":return e.stop()}},t,null,[[3,11]])}));return function(u){return m.apply(this,arguments)}}(),Yn=function(){var t=(0,g.useState)(!1),u=(0,E.Z)(t,2),s=u[0],v=u[1],e=(0,g.useState)(!1),j=(0,E.Z)(e,2),M=j[0],B=j[1],c=(0,g.useState)(!1),G=(0,E.Z)(c,2),U=G[0],z=G[1],Q=(0,g.useState)("sessions"),R=(0,E.Z)(Q,2),L=R[0],K=R[1],y=(0,g.useRef)(),W=(0,g.useRef)(),x=(0,g.useState)(),Y=(0,E.Z)(x,2),I=Y[0],H=Y[1],J=(0,g.useState)([]),X=(0,E.Z)(J,2),O=X[0],ie=X[1],ve=(0,g.useState)("all"),je=(0,E.Z)(ve,2),Se=je[0],$=je[1],ae=(0,g.useState)(),re=(0,E.Z)(ae,2),T=re[0],C=re[1],ce=(0,g.useState)([]),te=(0,E.Z)(ce,2),we=te[0],fe=te[1],p=new Oe.f("pages.users",(0,We.YB)()),on=function(){var b=(0,V.Z)((0,f.Z)().mark(function h(l){var Z;return(0,f.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return Z=(0,S.Z)((0,S.Z)({},l),{},{status:Se!=="all"?Se:void 0}),T&&(Z=(0,S.Z)({keywords:T},Z)),N.abrupt("return",(0,P.Rf)(Z));case 3:case"end":return N.stop()}},h)}));return function(l){return b.apply(this,arguments)}}();(0,g.useEffect)(function(){M&&(K("sessions"),z(!1),I!=null&&I.id&&(0,P.bG)({id:I.id}).then(function(b){var h;b.success&&(h=b.data)!==null&&h!==void 0&&h.apps&&fe(b.data.apps)}))},[I,M]);var On=[{title:p.t("session.title.lastSeen","Last Seen"),dataIndex:"lastSeen",render:function(h,l){return Pe()(l.lastSeen).locale(p.locale).fromNow()}},{title:p.t("session.title.expiry","Expiry"),dataIndex:"expiry",render:function(h,l){return Pe()(l.expiry).locale(p.locale).fromNow()}},{title:p.t("session.title.loggedOn","Logged on"),dataIndex:"createTime",render:function(h,l){return Pe()(l.createTime).locale(p.locale).format("LLL")}},{render:function(h,l){return[(0,n.jsx)("a",{onClick:(0,V.Z)((0,f.Z)().mark(function Z(){var F;return(0,f.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Wn(l.id);case 2:if(!A.sent){A.next=4;break}(F=W.current)===null||F===void 0||F.reload();case 4:case"end":return A.stop()}},Z)})),children:(0,n.jsx)(An.Z,{})},"delete")]}}],q=(0,Ve.GG)(ee.J0,p,"status.value",{normal:"Success",disable:"Error",inactive:"Warning"}),un=[{title:p.t("updateForm.userName.nameLabel","User name"),hideInSearch:!0,dataIndex:"username",render:function(h,l){return(0,n.jsx)("a",{onClick:function(){H(l),B(!0)},children:h})}},{title:p.t("title.fullName","FullName"),dataIndex:"fullName",hideInSearch:!0},{title:p.t("title.phoneNumber","Telephone number"),dataIndex:"phoneNumber",hideInSearch:!0},{title:p.t("title.email","Email"),dataIndex:"email",hideInSearch:!0},{title:p.t("title.status","Status"),dataIndex:"status",hideInForm:!0,valueEnum:q},{title:p.t("title.updatedTime","Last update time"),dataIndex:"updateTime",valueType:"dateTime",hideInTable:!0,hideInSearch:!0,hideInForm:!0},{title:p.t("title.loginTime","Last login time"),dataIndex:"loginTime",valueType:"dateTime",hideInSearch:!0,hideInForm:!0},{title:p.t("title.createTime","Create time"),dataIndex:"createTime",valueType:"dateTime",hideInSearch:!0,hideInTable:!0,hideInForm:!0},{title:p.t("title.option","Operating"),dataIndex:"option",valueType:"option",render:function(h,l){var Z=[(0,n.jsx)("a",{style:{flex:"unset"},onClick:function(){v(!0),H(l)},children:p.t("button.edit","Edit")},"config"),(0,n.jsx)(Bn,{type:"link",style:{flex:"unset"},success:(0,n.jsx)(Pn.Z,{color:"green"}),onClick:(0,V.Z)((0,f.Z)().mark(function F(){var N;return(0,f.Z)().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(l.email){_.next=2;break}throw new Error(p.t("activate.no-email"," The user has no email."));case 2:return _.next=4,(0,P.Pw)({userId:l.id});case 4:if(N=_.sent,!N.success){_.next=9;break}D.default.success(p.t("activate.succcess","Email sent successfully.")),_.next=10;break;case 9:throw new Error("Email sent failed.");case 10:case"end":return _.stop()}},F)})),hidden:l.status!==ee.J0.user_inactive,children:p.t("button.activate","Activate")},"activate")];return Z}}];return(0,n.jsxs)(ze.Oc,{children:[(0,n.jsx)(tn.ZP,{actionRef:y,rowKey:"id",search:!1,toolbar:{search:{onSearch:function(h){if(C(h),y.current){var l,Z;(l=(Z=y.current).setPageInfo)===null||l===void 0||l.call(Z,(0,S.Z)((0,S.Z)({},y.current.pageInfo),{},{current:1})),y.current.reload()}}},filter:(0,n.jsx)(yn,{onFinish:function(){var b=(0,V.Z)((0,f.Z)().mark(function h(l){var Z,F,N,A,_;return(0,f.Z)().wrap(function(Te){for(;;)switch(Te.prev=Te.next){case 0:return F=l.status,$((Z=F.value)!==null&&Z!==void 0?Z:"all"),y.current&&((N=(A=y.current).setPageInfo)===null||N===void 0||N.call(A,(0,S.Z)((0,S.Z)({},y.current.pageInfo),{},{current:1})),(_=y.current)===null||_===void 0||_.reload()),Te.abrupt("return",!0);case 4:case"end":return Te.stop()}},h)}));return function(h){return b.apply(this,arguments)}}(),children:(0,n.jsx)(Zn.Z,{name:"status",label:p.t("title.status","Status"),initialValue:{value:"all",label:p.t("status.all","All")},fieldProps:{labelInValue:!0},valueEnum:(0,S.Z)({all:p.t("status.all","All")},q)})}),actions:[(0,n.jsxs)(ge.Z,{type:"primary",onClick:function(){v(!0)},children:[(0,n.jsx)(Rn.Z,{}),p.t("button.create","Create")]},"create")]},request:on,columns:un,rowSelection:{onChange:function(h,l){ie(l)}}}),(O==null?void 0:O.length)>0&&(0,n.jsxs)(rn.Z,{extra:(0,n.jsxs)("div",{children:[p.t("chosen","Chosen")," ",(0,n.jsx)("a",{style:{fontWeight:600},children:O.length})," ",p.t("item","Item(s)")]}),children:[(0,n.jsx)(ge.Z,{danger:!0,onClick:function(){he.Z.confirm({title:p.t("deleteConfirm","Are you sure you want to delete the following users?            "),icon:(0,n.jsx)(ke.Z,{}),onOk:function(){return(0,V.Z)((0,f.Z)().mark(function l(){var Z,F;return(0,f.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Jn(O);case 2:ie([]),(Z=y.current)===null||Z===void 0||(F=Z.reloadAndRest)===null||F===void 0||F.call(Z);case 4:case"end":return A.stop()}},l)}))()},content:(0,n.jsx)(se.ZP,{dataSource:O,rowKey:"id",renderItem:function(l){return(0,n.jsxs)(se.ZP.Item,{children:[l.username,l.fullName?"(".concat(l.fullName,")"):l.email?"(".concat(l.email,")"):""]})}})})},children:p.t("batchDeletion","Batch deletion")}),O.filter(function(b){return b.status!==ee.J0.disabled}).length>0&&(0,n.jsx)(ge.Z,{onClick:function(){he.Z.confirm({title:p.t("disableConfirm","Are you sure you want to disable the following users?"),icon:(0,n.jsx)(ke.Z,{}),onOk:function(){return(0,V.Z)((0,f.Z)().mark(function l(){var Z,F;return(0,f.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Hn(O.filter(function(_){return _.status!==ee.J0.disabled}));case 2:ie([]),(Z=y.current)===null||Z===void 0||(F=Z.reloadAndRest)===null||F===void 0||F.call(Z);case 4:case"end":return A.stop()}},l)}))()},content:(0,n.jsx)(se.ZP,{dataSource:O.filter(function(h){return h.status!==ee.J0.disabled}),rowKey:"id",renderItem:function(l){return(0,n.jsxs)(se.ZP.Item,{children:[l.username,l.fullName?"(".concat(l.fullName,")"):l.email?"(".concat(l.email,")"):""]})}})})},children:p.t("batchDisable","Batch disable")}),O.filter(function(b){return b.status!==ee.J0.normal}).length>0&&(0,n.jsx)(ge.Z,{onClick:function(){he.Z.confirm({title:p.t("enableConfirm","Are you sure you want to enable the following users?"),icon:(0,n.jsx)(ke.Z,{}),onOk:function(){return(0,V.Z)((0,f.Z)().mark(function l(){var Z,F;return(0,f.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return A.next=2,Kn(O.filter(function(_){return _.status!==ee.J0.normal}));case 2:ie([]),(Z=y.current)===null||Z===void 0||(F=Z.reloadAndRest)===null||F===void 0||F.call(Z);case 4:case"end":return A.stop()}},l)}))()},content:(0,n.jsx)(se.ZP,{dataSource:O.filter(function(h){return h.status!==ee.J0.normal}),rowKey:"id",renderItem:function(l){return(0,n.jsxs)(se.ZP.Item,{children:[l.username,l.fullName?"(".concat(l.fullName,")"):l.email?"(".concat(l.email,")"):""]})}})})},children:p.t("batchEnable","Batch enable")})]}),(0,n.jsx)(In,{title:p.t(I?"form.title.userUpdate":"form.title.userCreate",I?"Modify user":"Add user"),onSubmit:function(){var b=(0,V.Z)((0,f.Z)().mark(function h(l){var Z;return(0,f.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,(I?Vn:Gn)(l);case 2:return Z=N.sent,Z&&(v(!1),H(void 0),y.current&&y.current.reload()),N.abrupt("return",Z);case 5:case"end":return N.stop()}},h)}));return function(h){return b.apply(this,arguments)}}(),onCancel:function(){v(!1),M||H(void 0)},modalVisible:s,values:I,parentIntl:p}),(0,n.jsx)(Ke.Z,{width:800,open:M,onClose:function(){H(void 0),B(!1)},closable:!1,children:M&&(I==null?void 0:I.username)&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(Ne.ZP,{column:2,title:p.t("detail.title","User Details"),request:(0,V.Z)((0,f.Z)().mark(function b(){return(0,f.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",{data:I||{}});case 1:case"end":return l.stop()}},b)})),params:{id:I==null?void 0:I.id},extra:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("a",{onClick:function(){z(!0),K("apps")},style:{flex:"unset"},hidden:U,children:p.t("button.grant","Grant")},"grant"),(0,n.jsx)("a",{onClick:(0,V.Z)((0,f.Z)().mark(function b(){var h,l,Z,F,N,A;return(0,f.Z)().wrap(function(Ee){for(;;)switch(Ee.prev=Ee.next){case 0:return h=I.createTime,l=I.loginTime,Z=I.extendedData,F=I.updateTime,N=(0,le.Z)(I,Un),Ee.next=3,Vn((0,S.Z)((0,S.Z)({},N),{},{apps:we.map(function(Te){return{id:Te.id,roleId:Te.roleId}})}));case 3:A=Ee.sent,A&&z(!1);case 5:case"end":return Ee.stop()}},b)})),style:{flex:"unset"},hidden:!U,children:p.t("button.save","Save")},"save")]}),columns:un}),(0,n.jsx)(He.Z,{activeKey:L,onChange:function(h){K(h)},items:[{label:p.t("detail.sessions.title","Sessions"),key:"sessions",children:(0,n.jsx)(tn.ZP,{actionRef:W,toolBarRender:!1,request:function(h){return Xe((0,S.Z)((0,S.Z)({},h),{},{userId:I.id}))},columns:On,rowKey:"id",search:!1})},{label:p.t("detail.apps.title","App"),key:"apps",children:(0,n.jsx)(ln,{apps:we,onChange:fe,granting:U,parentIntl:p})}]})]})})]})},Qn=Yn}}]);
