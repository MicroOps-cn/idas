(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[532],{50317:function(Xe){Xe.exports={SearchInput:"SearchInput___PEFkt",ProxyUrlInput:"ProxyUrlInput___3liOo"}},55356:function(Xe,Se,e){"use strict";e.r(Se),e.d(Se,{default:function(){return Pr}});var R=e(2824),j=e(39428),u=e(11849),ir=e(34792),G=e(48086),H=e(3182),ke=e(34442),v=e(67294),qe=e(21010),ee=e(44728),xe=e(93400),ur=e(90949),je=e(91220),he=e(60674),or=e(2844),w=e(14300),re=e(88293),_e=e(69610),Be=e(54941),er=e(56188),Pe=function(){function E(){(0,_e.Z)(this,E),this.generator=void 0,this.generator=new er.C(0,1,{workerIdBits:5,datacenterIdBits:5,sequenceBits:12})}return(0,Be.Z)(E,null,[{key:"generate",value:function(){return this.getInstance().generator.nextId().toString()}},{key:"getInstance",value:function(){return this.instance?this.instance:(this.instance=new E,this.instance)}}]),E}();Pe.instance=void 0;var ye=function(){return Pe.generate()},ce=e(62448),c=e(5966),rr=e(24739),tr=e(90672),Ee=e(64317),ar=e(61674),Q=e(7717),ve=e(57663),U=e(71577),te=e(86582),se=e(66456),ge=e(78587),be=e(47673),le=e(28166),ie=e(43358),C=e(66074),Ze=e(77883),me=e(49747),z=e(32059),ue=e(93224),pe=e(9715),Ie=e(63202),Ne=e(80454),De=e(96486),Ke=e.n(De),Ce=e(64140),$e=e(42762),nr=e(82061),sr=e(51042),Fe=e(63434),We=e(31649),we=e(50317),ze=e.n(we),r=e(85893),Ge=["title","editable","children","dataIndex","record","handleSave","options","inputType"],Me=["className","style"],He=(0,Ce.W6)(function(){return(0,r.jsx)($e.Z,{style:{cursor:"grab",color:"#999"}})}),Te=v.createContext(null),Je=(0,Ce.W8)(function(E){var a=Ie.Z.useForm(),t=(0,R.Z)(a,1),o=t[0];return(0,r.jsx)(Ie.Z,{form:o,component:!1,children:(0,r.jsx)(Te.Provider,{value:o,children:(0,r.jsx)("tr",(0,u.Z)({className:"editable-row"},E))})})}),oe=(0,Ce.JN)(function(E){return(0,r.jsx)("tbody",(0,u.Z)({},E))}),M=["GET","POST","PUT","PATCH","DELETE","OPTIONS","HEAD"].map(function(E){return{value:E,label:E}}),Oe=function E(a){if((0,De.isArray)(a)){var t=(0,je.Z)(a),o;try{for(t.s();!(o=t.n()).done;){var p=o.value;if(!E(p))return!1}}catch(s){t.e(s)}finally{t.f()}return!0}else if((0,De.isString)(a))return!Boolean(a.trim());return!Boolean(a)},ae=function(a){var t=a.title,o=a.editable,p=a.children,s=a.dataIndex,g=a.record,l=a.handleSave,K=a.options,B=a.inputType,I=(0,ue.Z)(a,Ge),A=(0,v.useState)(!1),T=(0,R.Z)(A,2),b=T[0],h=T[1],Z=(0,v.useRef)(null),$=(0,v.useContext)(Te);(0,v.useEffect)(function(){b&&Z.current.focus()},[b]);var J=function(){h(!b),$.setFieldsValue((0,z.Z)({},s,g[s]))},O=function(){var F=(0,H.Z)((0,j.Z)().mark(function m(){var N;return(0,j.Z)().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return W.prev=0,W.next=3,$.validateFields();case 3:N=W.sent,J(),l((0,u.Z)((0,u.Z)({},g),N)),W.next=11;break;case 8:W.prev=8,W.t0=W.catch(0),console.error("Save failed:",W.t0);case 11:case"end":return W.stop()}},m,null,[[0,8]])}));return function(){return F.apply(this,arguments)}}(),L=function(){switch(B){case"number":return(0,r.jsx)(me.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O});case"select":return(0,r.jsx)(C.Z,{ref:Z,size:"small",onBlur:O,options:K});default:return(0,r.jsx)(le.Z,{ref:Z,size:"small",onPressEnter:O,onBlur:O})}}(),Y=p;return o&&(Y=b?(0,r.jsx)(Ie.Z.Item,{className:ze().ProxyUrlInput,style:{margin:0},name:s,rules:[{required:!0,message:""}],children:L}):(0,r.jsx)("div",{className:"editable-cell-value-wrap",style:{paddingRight:24},onClick:J,children:Oe(p)?(0,r.jsx)(r.Fragment,{children:"\xA0"}):p})),(0,r.jsx)("td",(0,u.Z)((0,u.Z)({},I),{},{children:Y}))},Qe=function(a){var t=a.parentIntl,o=a.dataSource,p=a.setDataSource,s=(0,v.useState)(240),g=(0,R.Z)(s,2),l=g[0],K=g[1],B=o.domain,I=o.urls,A=o.upstream,T=o.insecureSkipVerify,b=o.transparentServerName,h=(0,v.useState)(0),Z=(0,R.Z)(h,2),$=Z[0],J=Z[1],O=(0,v.useState)(),L=(0,R.Z)(O,2),Y=L[0],F=L[1],m=(0,v.useMemo)(function(){return new xe.f("proxy",t)},[t]);(0,v.useEffect)(function(){var f=function(){window.innerHeight>890?K(window.innerHeight-690):K(200)};f(),window.addEventListener("resize",f)},[]),(0,v.useEffect)(function(){var f="",d=(0,je.Z)(I),i;try{for(d.s();!(i=d.n()).done;){var n=i.value;(!n.name||!n.name.trim())&&(f=m.t("name.required","name cannot be empty!")),(!n.method||!n.method.trim())&&(f=m.t("method.required","method cannot be empty!")),(!n.url||!n.url.trim())&&(f=m.t("url.required","URL cannot be empty!"))}}catch(S){d.e(S)}finally{d.f()}F(f)},[m,I]);var N=function(d){var i=d.oldIndex,n=d.newIndex;if(i!==n){var S=(0,Ne.q)(I.slice(),i,n).filter(function(x){return!!x});p((0,u.Z)((0,u.Z)({},o),{},{urls:S}))}},y=function(d){return(0,r.jsx)(oe,(0,u.Z)({useDragHandle:!0,disableAutoscroll:!0,helperClass:"row-dragging",onSortEnd:N},d))},W=function(d){var i=d.className,n=d.style,S=(0,ue.Z)(d,Me),x=I.findIndex(function(D){return D.id===S["data-row-key"]});return(0,r.jsx)(Je,(0,u.Z)({index:x},S))},Ye=function(d){p(function(i){var n,S=(n=i==null?void 0:i.urls.map(function(x){return x.id===d.id?d:x}))!==null&&n!==void 0?n:[];return(0,u.Z)((0,u.Z)({},i),{},{urls:S})})},fe=[{dataIndex:"sort",width:30,className:"drag-visible",render:function(){return(0,r.jsx)(He,{})}},{width:150,title:m.t("name.title","Name"),dataIndex:"name",inputType:"text",editable:!0},{title:m.t("method.title","Method"),dataIndex:"method",inputType:"select",width:100,options:M,editable:!0},{title:m.t("url.title","URL"),dataIndex:"url",inputType:"text",editable:!0},{width:30,render:function(d,i){return[(0,r.jsx)("a",{onClick:(0,H.Z)((0,j.Z)().mark(function n(){return(0,j.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:p(function(D){return(0,u.Z)((0,u.Z)({},D),{},{urls:D.urls.filter(function(X){return X.id!==i.id})})});case 1:case"end":return x.stop()}},n)})),children:(0,r.jsx)(nr.Z,{})},"delete")]}}],Le=fe.map(function(f){return f.editable?(0,u.Z)((0,u.Z)({},f),{},{onCell:function(i){return{record:i,editable:f.editable,dataIndex:f.dataIndex,inputType:f.inputType,options:f.options,title:f.title,handleSave:Ye}}}):f});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{name:["proxy","domain"],label:m.t("domain.label","Domain"),colProps:{span:12},initialValue:B,rules:[{required:!0,message:m.t("domain.required","domain cannot be empty!")}]}),(0,r.jsx)(c.Z,{name:["proxy","upstream"],label:m.t("upstream.label","Upstream"),colProps:{span:12},initialValue:A,tooltip:(0,r.jsxs)(r.Fragment,{children:[m.t("upstream.example","Example"),":",(0,r.jsx)("br",{}),(0,r.jsx)("li",{children:"abc.com"}),(0,r.jsx)("li",{children:"http://abc.com:80"}),(0,r.jsx)("li",{children:"http://1.2.3.4"}),(0,r.jsx)("li",{children:"https://abc.com"})]}),rules:[{required:!0,message:m.t("upstream.required","upstream cannot be empty!")}]}),(0,r.jsx)(Fe.Z,{name:["proxy","insecureSkipVerify"],label:m.t("insecureSkipVerify.label","Skip TLS Verify"),colProps:{span:12},initialValue:T,tooltip:m.t("insecureSkipVerify.describe","When requesting back-end servers, the certificate verification is ignored (insecure).")}),(0,r.jsx)(Fe.Z,{name:["proxy","transparentServerName"],label:m.t("transparentServerName.label","Transparent Server Name"),colProps:{span:12},initialValue:b,tooltip:m.t("transparentServerName.describe","When requesting the backend, the domain name requested by the client will be transparently transmitted.")}),(0,r.jsxs)(We.Z,{colProps:{span:24},label:m.t("url.label","URL"),children:[(0,r.jsx)(ge.Z,{pagination:!1,dataSource:I,columns:Le,scroll:{y:l},rowKey:"id",size:"small",components:{body:{wrapper:y,row:W,cell:ae}}}),(0,r.jsx)(U.Z,{onClick:function(){p((0,u.Z)((0,u.Z)({},o),{},{urls:[].concat((0,te.Z)(I),[{name:"",id:ye(),method:"*",url:""}])})),J($+1)},type:"dashed",block:!0,children:(0,r.jsx)(sr.Z,{})}),(0,r.jsx)("div",{style:{color:"red"},children:Y})]})]})},Ue=Qe,lr=e(18106),Ae=e(58500),vr=e(49111),V=e(19650),dr=e(77576),mr=e(12028),Mr=e(13062),pr=e(71230),Tr=e(63185),cr=e(9676),fr=e(86504),hr=function(a){var t=a.role,o=a.setRole,p=a.activeKey,s=a.setActiveKey,g=(0,v.useRef)(null),l=(0,v.useState)(!1),K=(0,R.Z)(l,2),B=K[0],I=K[1];return(0,v.useEffect)(function(){if(p===t.id&&!t.name&&I(!0),p===t.id&&B){var A;(A=g.current)===null||A===void 0||A.focus({cursor:"all"})}},[B,p,t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(le.Z,{hidden:!(B&&t.id===p),style:{width:80,padding:0},ref:g,onKeyDown:function(T){T.key=="Enter"&&(o({id:t.id,name:T.currentTarget.value}),I(!1))},onBlur:function(T){o({id:t.id,name:T.target.value}),I(!1)},autoFocus:!0,defaultValue:t.name?t.name:"New Role"}),(0,r.jsxs)("div",{hidden:B&&t.id===p,style:{width:80,overflow:"hidden",textShadow:"0 0 0 aliceblue"},title:t.name,onDoubleClick:function(){s(t.id),I(!0)},children:[(0,r.jsx)(fr.Z,{style:{color:"orange"},hidden:!t.isDefault}),t.name]})]})},yr=function(a){var t=a.urls,o=t===void 0?[]:t,p=a.value,s=p===void 0?[]:p,g=a.onChange,l=(0,v.useState)(),K=(0,R.Z)(l,2),B=K[0],I=K[1],A={add:function(){var h="new-role-".concat(ye());I(h),g==null||g([].concat((0,te.Z)(s),[{name:"",id:h}]))},remove:function(h){Ke().isString(h)?g==null||g(s.filter(function(Z){return Z.id!=h})):G.default.warning("system error: ".concat(h," is not string"))}},T=function(){var b=(0,H.Z)((0,j.Z)().mark(function h(Z){return(0,j.Z)().wrap(function(J){for(;;)switch(J.prev=J.next){case 0:return J.next=2,g==null?void 0:g(s.map(function(O){return Z.id==O.id?(0,u.Z)((0,u.Z)({},O),Z):O}));case 2:case"end":return J.stop()}},h)}));return function(Z){return b.apply(this,arguments)}}();return(0,r.jsx)(Ae.Z,{type:"editable-card",tabPosition:"top",style:{height:350},activeKey:B,onChange:I,onEdit:function(h,Z){A[Z](h)},children:s.map(function(b){return(0,r.jsx)(Ae.Z.TabPane,{tab:(0,r.jsx)(hr,{role:b,setRole:T,activeKey:B,setActiveKey:I}),tabKey:b.id,children:(0,r.jsxs)(V.Z,{direction:"vertical",children:[(0,r.jsxs)("div",{style:{display:o.length===0?"none":"unset"},children:[(0,r.jsx)("div",{style:{paddingBottom:7},children:"Permission"}),(0,r.jsx)(cr.Z.Group,{onChange:function(Z){T((0,u.Z)((0,u.Z)({},b),{},{urls:Z}))},defaultValue:b.urls,children:o.map(function(h){return(0,r.jsx)(pr.Z,{children:(0,r.jsx)(cr.Z,{value:h.id,children:h.name})},h.id)})})]}),(0,r.jsxs)("div",{style:{padding:10},children:["\u9ED8\u8BA4:",(0,r.jsx)(mr.Z,{checked:b.isDefault,onChange:function(Z){g==null||g(s.map(function($){return b.id==$.id?(0,u.Z)((0,u.Z)({},$),{},{isDefault:Z}):Z?(0,u.Z)((0,u.Z)({},$),{},{isDefault:!Z}):$}))}})]})]})},b.id)})})},gr=function(a){var t=a.values,o=a.onSubmit,p=a.parentIntl,s=a.loading,g=a.disabled,l=new xe.f("form",p),K=(0,v.useState)([]),B=(0,R.Z)(K,2),I=B[0],A=B[1],T=(0,v.useRef)(),b=(0,v.useState)([]),h=(0,R.Z)(b,2),Z=h[0],$=h[1],J=(0,v.useState)([]),O=(0,R.Z)(J,2),L=O[0],Y=O[1],F=(0,v.useState)({domain:"",upstream:"",urls:[{id:ye(),method:"*",name:"default",url:"/"}],insecureSkipVerify:!1,transparentServerName:!0}),m=(0,R.Z)(F,2),N=m[0],y=m[1],W=(0,v.useState)(0),Ye=(0,R.Z)(W,2),fe=Ye[0],Le=Ye[1];(0,v.useEffect)(function(){var d,i,n,S,x,D,X;Le(0),Y((d=t==null||(i=t.roles)===null||i===void 0?void 0:i.map(function(k){var ne;return{id:k.id,urls:(ne=k.urls)!==null&&ne!==void 0?ne:[],name:k.name,isDefault:k.isDefault}}))!==null&&d!==void 0?d:[]),$((n=t==null?void 0:t.users)!==null&&n!==void 0?n:[]),y((0,u.Z)((0,u.Z)({domain:"",upstream:"",transparentServerName:!0,insecureSkipVerify:!1},(S=t==null?void 0:t.proxy)!==null&&S!==void 0?S:{}),{},{urls:(x=t==null||(D=t.proxy)===null||D===void 0?void 0:D.urls)!==null&&x!==void 0?x:[{id:ye(),method:"*",name:"default",url:"/"}]})),A((X=t==null?void 0:t.grantType)!==null&&X!==void 0?X:[])},[t]);var f=function(i){return(i??[]).includes(w.qJ.proxy)};return(0,r.jsxs)(ce.L,{stepsProps:{size:"small"},formProps:{preserve:!1,disabled:g,loading:s},onCurrentChange:function(){var d=(0,H.Z)((0,j.Z)().mark(function i(n){var S;return(0,j.Z)().wrap(function(D){for(;;)switch(D.prev=D.next){case 0:n==1&&!f((S=T.current)===null||S===void 0?void 0:S.getFieldValue("grantType"))?Le(n+(fe===0?1:-1)):Le(n);case 1:case"end":return D.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),current:fe,onFinish:function(){var d=(0,H.Z)((0,j.Z)().mark(function i(n){var S,x,D,X,k,ne,Re,de,Ve,q;return(0,j.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return console.log(n),S=w.FQ.manual,x=n.grantMode,D=n.grantType,X=n.status,k=N.domain,ne=N.upstream,Re=N.urls,de=N.transparentServerName,Ve=N.insecureSkipVerify,q=Re.map(function(_){var br=_.id,Ir=_.method,Dr=_.name,Cr=_.url;return{id:br,method:Ir,name:Dr,url:Cr}}),P.abrupt("return",o((0,u.Z)((0,u.Z)({},n),{},{users:Z.map(function(_){return{id:_.id,roleId:_.roleId}}),status:X!==w.w$.unknown?X:w.w$.normal,roles:L.map(function(_){return f(D)?_:(0,u.Z)((0,u.Z)({},_),{},{urls:void 0})}),grantMode:x??S,grantType:D??[w.qJ.none],proxy:f(D)?{domain:k,upstream:ne,urls:q,insecureSkipVerify:Ve,transparentServerName:de}:void 0})));case 6:case"end":return P.stop()}},i)}));return function(i){return d.apply(this,arguments)}}(),children:[(0,r.jsxs)(ce.L.StepForm,{initialValues:t,formRef:T,layout:"vertical",style:{maxWidth:650},grid:!0,title:l.t("basicConfig.title","Basic"),onFinish:(0,H.Z)((0,j.Z)().mark(function d(){return(0,j.Z)().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!(t&&!t.id)){n.next=3;break}return G.default.error(l.t("app-id.empty","System error, application ID is empty")),n.abrupt("return",!1);case 3:return n.abrupt("return",!0);case 4:case"end":return n.stop()}},d)})),children:[(0,r.jsx)(c.Z,{hidden:!0,name:"id"}),(0,r.jsx)(or.HZ,{colProps:{span:8,sm:8,xs:14},label:l.t("avatar.label","Avatar"),name:"avatar"}),(0,r.jsxs)(rr.UW,{grid:!0,colProps:{span:16,xs:14},children:[(0,r.jsx)(c.Z,{name:"name",label:l.t("name.label","Name"),width:"md",rules:[{required:!0,message:l.t("name.required","Please input app name!")},{pattern:/^[-_A-Za-z0-9]+$/,message:l.t("name.invalid","App name format error!")}],disabled:!!(t!=null&&t.name)}),(0,r.jsx)(c.Z,{name:"displayName",label:l.t("displayName.label","Display Name"),width:"md"})]}),(0,r.jsx)(tr.Z,{colProps:{span:24,sm:24,xs:14},name:"description",label:l.t("description.label","Description")}),(0,r.jsx)(c.Z,{name:"url",colProps:{span:24,sm:24,xs:14},label:l.t("url.label","URL")}),(0,r.jsx)(Ee.Z,{colProps:{span:12,sm:12,xs:14},name:"grantType",label:l.t("grantType.label","Grant Type"),width:"md",mode:"tags",options:(0,re.MM)(w.qJ,p,"grantType.value"),fieldProps:{onChange:A}}),(0,r.jsx)(Ee.Z,{colProps:{span:12,sm:12,xs:14},name:"grantMode",label:l.t("grantMode.label","Grant Mode"),width:"md",tooltip:l.t("grantMode.tooltip","Automatic authorization is only supported when using OAuth2.0 and RADIUS protocols, otherwise manual authorization is only possible."),options:(0,re.MM)(w.FQ,p,"grantMode.value"),rules:[{required:!0,message:l.t("grantMode.required","Please select Grant Mode!")}]})]}),(0,r.jsx)(ce.L.StepForm,{initialValues:{},layout:"vertical",grid:!0,title:l.t("proxy.title","Proxy"),onFinish:function(){var d=(0,H.Z)((0,j.Z)().mark(function i(n){var S,x,D,X,k,ne,Re,de,Ve,q;return(0,j.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:x=(S=n.proxy)!==null&&S!==void 0?S:{},D=x.domain,X=x.upstream,k=x.transparentServerName,ne=x.insecureSkipVerify,y((0,u.Z)((0,u.Z)({},N),{},{domain:D,upstream:X,transparentServerName:k,insecureSkipVerify:ne})),Re=N.urls,de=(0,je.Z)(Re),P.prev=4,de.s();case 6:if((Ve=de.n()).done){P.next=19;break}if(q=Ve.value,!(!q.name||!q.name.trim())){P.next=11;break}return G.default.error(l.t("name.required","name cannot be empty!")),P.abrupt("return",!1);case 11:if(!(!q.method||!q.method.trim())){P.next=14;break}return G.default.error(l.t("proxy.method.required","method cannot be empty!")),P.abrupt("return",!1);case 14:if(!(!q.url||!q.url.trim())){P.next=17;break}return G.default.error(l.t("proxy.url.required","URL cannot be empty!")),P.abrupt("return",!1);case 17:P.next=6;break;case 19:P.next=24;break;case 21:P.prev=21,P.t0=P.catch(4),de.e(P.t0);case 24:return P.prev=24,de.f(),P.finish(24);case 27:return P.abrupt("return",!0);case 28:case"end":return P.stop()}},i,null,[[4,21,24,27]])}));return function(i){return d.apply(this,arguments)}}(),children:fe===1&&(0,r.jsx)(Ue,{dataSource:N,setDataSource:y,parentIntl:l})}),(0,r.jsx)(ce.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("role.title","Role"),children:fe===2&&(0,r.jsx)(ar.Z,{name:"rules",rules:[{validator:function(){if(L.length>0){if(L.filter(function(n){return n.isDefault}).length!=1)return Promise.reject(new Error("No default role specified!"));var i=L.map(function(n){return n.name});if(i.some(function(n,S){return i.includes(n,S+1)}))return Promise.reject(new Error("Contains duplicate role names!"));if(i.some(function(n){return!Boolean(n)}))return Promise.reject(new Error("Contains empty role names!"))}return Promise.resolve()}}],children:(0,r.jsx)(yr,{value:L,urls:f(I)?N.urls:[],onChange:Y})})}),(0,r.jsx)(ce.L.StepForm,{initialValues:{},layout:"vertical",title:l.t("user.title","User"),children:fe===3&&(0,r.jsx)("div",{style:{height:"calc( 100vh - 400px )"},children:(0,r.jsx)(Q.ZP,{users:Z,roles:L,onChange:$,granting:!0,parentIntl:p})})})]})},Zr=gr,Sr=function(){var E=(0,H.Z)((0,j.Z)().mark(function a(t){var o;return(0,j.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return o=G.default.loading("Adding ..."),s.prev=1,s.next=4,(0,ee.ri)((0,u.Z)({},t));case 4:return o(),G.default.success("Added successfully"),s.abrupt("return",!0);case 9:return s.prev=9,s.t0=s.catch(1),o(),G.default.error("Adding failed, please try again!"),s.abrupt("return",!1);case 14:case"end":return s.stop()}},a,null,[[1,9]])}));return function(t){return E.apply(this,arguments)}}(),xr=function(){var E=(0,H.Z)((0,j.Z)().mark(function a(t){var o;return(0,j.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(o=G.default.loading("Configuring"),s.prev=1,!t.id){s.next=10;break}return s.next=5,(0,ee.KT)({id:t.id},{id:t.id,name:t.name,status:t.status,description:t.description,grantType:t.grantType,grantMode:t.grantMode,avatar:t.avatar,roles:t.roles,users:t.users,proxy:t.proxy,url:t.url,displayName:t.displayName});case 5:return o(),G.default.success("update is successful"),s.abrupt("return",!0);case 10:return G.default.success("update failed, system error"),s.abrupt("return",!1);case 12:s.next=19;break;case 14:return s.prev=14,s.t0=s.catch(1),o(),G.default.error("Configuration failed, please try again!"),s.abrupt("return",!1);case 19:case"end":return s.stop()}},a,null,[[1,14]])}));return function(t){return E.apply(this,arguments)}}(),jr=function(a){var t=a.match.params.aid,o=a.history,p=new xe.f("pages.apps",(0,qe.YB)()),s=(0,v.useState)(),g=(0,R.Z)(s,2),l=g[0],K=g[1],B=(0,v.useState)(!1),I=(0,R.Z)(B,2),A=I[0],T=I[1],b=(0,v.useState)(!1),h=(0,R.Z)(b,2),Z=h[0],$=h[1],J=function(){var O=(0,H.Z)((0,j.Z)().mark(function L(Y){var F,m;return(0,j.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.prev=0,T(!0),y.next=4,(0,ee.BN)({id:Y});case 4:return F=y.sent,F.data&&(m=F.data,K(m)),T(!1),y.abrupt("return",F);case 10:return y.prev=10,y.t0=y.catch(0),$(!0),y.t0.handled||console.error("failed to get app info: ".concat(y.t0)),y.abrupt("return",{success:!1});case 15:case"end":return y.stop()}},L,null,[[0,10]])}));return function(Y){return O.apply(this,arguments)}}();return(0,v.useEffect)(function(){t?J(t):K({})},[t]),(0,r.jsx)(ur.ZP,{children:l?(0,r.jsx)(Zr,{onSubmit:function(){var O=(0,H.Z)((0,j.Z)().mark(function L(Y){var F,m;return(0,j.Z)().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.next=2,(l!=null&&l.id?xr:Sr)(Y);case 2:return F=y.sent,F&&o.push("/apps/".concat((m=l==null?void 0:l.id)!==null&&m!==void 0?m:"")),y.abrupt("return",F);case 5:case"end":return y.stop()}},L)}));return function(L){return O.apply(this,arguments)}}(),values:l!=null&&l.id?l:void 0,parentIntl:p,loading:A,disabled:Z}):null})},Pr=jr},7717:function(Xe,Se,e){"use strict";e.d(Se,{DV:function(){return Ee}});var R=e(48736),j=e(27049),u=e(71748),ir=e(90860),G=e(47673),H=e(28166),ke=e(39428),v=e(86582),qe=e(3182),ee=e(2824),xe=e(93224),ur=e(43358),je=e(66074),he=e(11849),or=e(54421),w=e(38272),re=e(67294),_e=e(58533),Be=e(2844),er=e(10861),Pe=e(93400),ye=e(50317),ce=e.n(ye),c=e(85893),rr=["type","loading"],tr=function(Q){var ve=Q.users,U=Q.onChange,te=Q.roles,se=Q.loading,ge=Q.granting,be=Q.parentIntl,le=new Pe.f("users",be);return(0,c.jsx)(w.ZP,{dataSource:ve,size:"small",loading:se,renderItem:function(C){var Ze,me;return(0,c.jsxs)(w.ZP.Item,{actions:U&&ge?[(0,c.jsx)("a",{onClick:function(){U(ve.filter(function(ue){return ue.id!=C.id}))},children:le.t("userList.delete","Delete")},"grant")]:[],children:[(0,c.jsx)(w.ZP.Item.Meta,{avatar:(0,c.jsx)(Be.ZP,{src:"".concat(C.avatar)}),title:C.fullName?C.fullName:C.username,description:C.email}),U&&ge&&te.length>0?(0,c.jsx)(je.Z,{onSelect:function(ue){U(ve.map(function(pe){return pe.id==C.id?(0,he.Z)((0,he.Z)({},pe),{},{roleId:ue}):pe}))},defaultValue:C&&C.roleId?C.roleId:(Ze=te.find(function(z){return z.isDefault}))===null||Ze===void 0?void 0:Ze.id,options:te.map(function(z){return{key:z.id,value:z.id,label:z.name}})}):(0,c.jsx)("div",{children:C&&C.role?C.role:(me=te.find(function(z){return z.isDefault}))===null||me===void 0?void 0:me.name})]},C.id)}})},Ee=function(Q){var ve=Q.type,U=ve===void 0?"vertical":ve,te=Q.loading,se=(0,xe.Z)(Q,rr),ge=se.roles,be=se.onChange,le=se.users,ie=se.granting,C=se.parentIntl,Ze=new Pe.f("grant",C),me=(0,re.useState)(!0),z=(0,ee.Z)(me,2),ue=z[0],pe=z[1],Ie=(0,re.useState)(0),Ne=(0,ee.Z)(Ie,2),De=Ne[0],Ke=Ne[1],Ce=(0,re.useState)(),$e=(0,ee.Z)(Ce,2),nr=$e[0],sr=$e[1],Fe=(0,re.useState)([]),We=(0,ee.Z)(Fe,2),we=We[0],ze=We[1],r=(0,re.useState)(!1),Ge=(0,ee.Z)(r,2),Me=Ge[0],He=Ge[1],Te=function(){var oe=(0,qe.Z)((0,ke.Z)().mark(function M(Oe){var ae,Qe,Ue,lr,Ae;return(0,ke.Z)().wrap(function(V){for(;;)switch(V.prev=V.next){case 0:return V.prev=0,He(!0),V.next=4,(0,er.Rf)((0,he.Z)({current:De+1,pageSize:20,keywords:nr},Oe));case 4:ae=V.sent,ae&&ae.data?(Qe=ae.data,Ue=ae.current,lr=ae.pageSize,Ae=ae.total,ze(function(dr){return[].concat((0,v.Z)(dr),(0,v.Z)(Qe))}),Ke(Ue),Ae<Ue*lr&&pe(!1)):pe(!1),V.next=11;break;case 8:V.prev=8,V.t0=V.catch(0),V.t0.handled||console.error("failed to get user list: ".concat(V.t0));case 11:return V.prev=11,He(!1),V.finish(11);case 14:case"end":return V.stop()}},M,null,[[0,8,11,14]])}));return function(Oe){return oe.apply(this,arguments)}}(),Je=function(M){ze([]),sr(M),Ke(1),Te({keywords:M,current:1})};return(0,re.useEffect)(function(){Je()},[]),(0,c.jsxs)("div",{style:{height:"100%",width:"100%"},children:[ie&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{style:{height:U==="vertical"?"calc(100% / 2)":"100%",display:ie?"block":"none",width:U==="vertical"?"100%":"calc((100% - 32px) / 2)",float:U==="horizontal"?"left":"unset"},children:[(0,c.jsx)(H.Z.Search,{className:ce().SearchInput,onSearch:function(M){Me||Je(M)},loading:Me}),(0,c.jsx)("div",{id:"scrollableDiv",style:{height:"calc( 100% - 32px )",overflow:"auto",padding:"0 16px",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,c.jsx)(_e.Z,{dataLength:we.length,next:Te,hasMore:ue,loader:(0,c.jsx)(ir.Z,{avatar:!0,paragraph:{rows:1},active:!0}),endMessage:(0,c.jsx)(j.Z,{plain:!0,children:"End"}),scrollableTarget:"scrollableDiv",children:(0,c.jsx)(w.ZP,{dataSource:we.filter(function(oe){return!le.map(function(M){return M.id}).includes(oe.id)}),size:"small",loading:Me,renderItem:function(M){return(0,c.jsx)(w.ZP.Item,{actions:[(0,c.jsx)("a",{onClick:function(){be([].concat((0,v.Z)(le),[(0,he.Z)((0,he.Z)({},M),{},{role:""})]))},children:Ze.t("userList.grant","Grant")},"grant")],children:(0,c.jsx)(w.ZP.Item.Meta,{avatar:(0,c.jsx)(Be.ZP,{src:"".concat(M.avatar)}),title:M.fullName?M.fullName:M.username,description:M.email})},M.id)}})})})]}),(0,c.jsx)(j.Z,{type:U==="vertical"?"horizontal":"vertical",style:{height:U==="vertical"?"unset":"100%",margin:U==="vertical"?"10px 0":"0 10px",float:U==="horizontal"?"left":"unset",display:ie?"":"none"}})]}),(0,c.jsx)("div",{id:"scrollableDiv",style:{height:U!=="vertical"||!ie?"100%":"calc((100% - 42px) / 2)",width:U==="horizontal"&&ie?"calc((100% - 32px) / 2)":"100%",overflow:"auto",padding:"0 16px",float:U==="horizontal"?"left":"unset",border:"1px solid rgba(140, 140, 140, 0.35)"},children:(0,c.jsx)(tr,{parentIntl:C,users:le,granting:ie,roles:ge,loading:te,onChange:be})})]})};Se.ZP=Ee}}]);
