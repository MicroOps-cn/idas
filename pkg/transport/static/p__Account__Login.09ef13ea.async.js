(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[258],{33055:function(G){G.exports={container:"container___37JKF",loginTypeTabs:"loginTypeTabs___18ST8",lang:"lang___ODW_o",content:"content___3akJJ",oauthIcon:"oauthIcon___1nA12",oauthButton:"oauthButton___1yw-w",oauthIconButton:"oauthIconButton___3nCaL"}},68836:function(G,O,a){"use strict";a.r(O),a.d(O,{default:function(){return Xe}});var U=a(18106),H=a(58500),k=a(49111),z=a(19650),g=a(48736),S=a(27049),w=a(34792),h=a(48086),j=a(91896),s=a(39428),d=a(3182),m=a(2824),e=a(11849),Me=a(86582),we=a(93224),dn=a(17462),F=a(76772),fn=a(34442),Ie=a(50963),Ce=a(94184),Ne=a.n(Ce),Be=a(96486),b=a(67294),E=a(21010),ye=a(73727),ze=a(45953),$e=a(29791),$=a(14300),te=a(89652),ce=a(88293),se=a(93400),re=a(72709),Le=a(89366),de=a(2603),Ee=a(64302),De=a(29985),Re=a(56401),D=a(5966),Ve=a(16434),Je=a(63434),mn=a(57663),We=a(71577),vn=a(13254),Oe=a(14277),Ue=a(84059),He=a(79090),Ke=a(21349),n=a(85893),Qe=function(X){var Z=X.parentIntl,B=Z===void 0?new se.f("user.settings.security",(0,E.YB)()):Z,x=X.token,C=new se.f("mfa",B),R=(0,b.useState)(),V=(0,m.Z)(R,2),f=V[0],K=V[1],oe=(0,b.useState)(!1),A=(0,m.Z)(oe,2),T=A[0],Q=A[1],_=function(){var P=(0,d.Z)((0,s.Z)().mark(function u(J){return(0,s.Z)().wrap(function(Y){for(;;)switch(Y.prev=Y.next){case 0:K(void 0),Q(!0),(0,te.HN)({token:J}).then(function(ee){K(ee.data)}).finally(function(){Q(!1)});case 3:case"end":return Y.stop()}},u)}));return function(J){return P.apply(this,arguments)}}();return(0,b.useEffect)(function(){x&&_(x)},[x]),(0,n.jsxs)(Ke.Z,{children:[(0,n.jsx)("span",{children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:C.t("code-description","Please obtain two consecutive one-time passwords after scanning and adding MFA and enter them into the input box below."),type:"info",showIcon:!0})}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{width:220,height:140},children:f!=null&&f.secret?(0,n.jsx)(Ue.Qd,{style:{marginLeft:"40px"},value:f==null?void 0:f.secret}):(0,n.jsx)(Oe.Z,{description:"",style:{width:200,height:128},image:T?(0,n.jsx)(He.Z,{}):void 0})}),(0,n.jsx)("div",{style:{display:"grid",width:"100%"},children:(0,n.jsx)(We.Z,{onClick:function(){x&&_(x)},type:"link",children:C.t("refresh","Refresh")})})]}),(0,n.jsxs)("div",{style:{marginLeft:"50px"},children:[(0,n.jsx)(D.Z,{hidden:!0,width:"sm",name:"token",fieldProps:{value:f==null?void 0:f.token}}),(0,n.jsx)(D.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"firstCode",label:C.t("first-code","First code")}),(0,n.jsx)(D.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"secondCode",label:C.t("second-code","Second code")})]})]})]})},Ye=a(33055),M=a.n(Ye),ke=["children","allows","loginType","hidden"],q=function(Z){var B=Z.content,x=Z.hidden;return x?null:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:B,type:"error",showIcon:!0})},I=function(Z){var B=Z.children,x=Z.allows,C=Z.loginType,R=Z.hidden,V=(0,we.Z)(Z,ke),f=new Set([].concat((0,Me.Z)(x),[x.map(function(K){return $.Bz[K]})]));return f.has(C)?(0,n.jsx)("span",(0,e.Z)((0,e.Z)({hidden:R},V),{},{children:B})):(0,n.jsx)(n.Fragment,{})},Fe=function(Z){var B,x,C,R,V=Z.location.query,f=V.redirect_uri,K=V.redirect,oe=(0,b.useState)({success:!0}),A=(0,m.Z)(oe,2),T=A[0],Q=A[1],_=(0,b.useState)("normal"),P=(0,m.Z)(_,2),u=P[0],J=P[1],fe=(0,b.useState)(),Y=(0,m.Z)(fe,2),ee=Y[0],me=Y[1],ve=(0,E.tT)("@@initialState"),W=ve.initialState,Ae=ve.setInitialState,r=new se.f("pages.login",(0,E.YB)()),Te=(0,Ie.cI)(),Pe=(0,m.Z)(Te,1),y=Pe[0],he=["normal","email","sms"],Ge=["mfa_totp","mfa_email","mfa_sms"],qe=(0,b.useState)(he.map(function(i){return $.Bz[i]})),ge=(0,m.Z)(qe,2),L=ge[0],pe=ge[1],_e=(0,b.useState)([]),xe=(0,m.Z)(_e,2),je=xe[0],en=xe[1],nn=function(o){(0,Be.isNumber)(o)?J($.Bz[o]):J(o)},an=function(){var i=(0,d.Z)((0,s.Z)().mark(function o(){var l,c;return(0,s.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,W==null||(l=W.fetchUserInfo)===null||l===void 0?void 0:l.call(W);case 2:if(c=t.sent,!c){t.next=6;break}return t.next=6,Ae(function(ae){return(0,e.Z)((0,e.Z)({},ae),{},{currentUser:c})});case 6:case"end":return t.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),tn=(0,b.useState)(!1),Ze=(0,m.Z)(tn,2),sn=Ze[0],be=Ze[1],rn=function(){var i=(0,d.Z)((0,s.Z)().mark(function o(l){var c,N,t,ae,le,ue;return(0,s.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return c=(0,j.Z)({},l),v.prev=1,v.next=4,(0,te.n$)((0,e.Z)((0,e.Z)({},c),{},{type:u,token:ee}),{skipErrorHandler:!0});case 4:if(t=v.sent,!((N=t.data)!==null&&N!==void 0&&N.nextMethod&&t.data.nextMethod.length>0)){v.next=12;break}pe(t.data.nextMethod),nn(t.data.nextMethod[0]),be(!0),me(t.data.token),v.next=25;break;case 12:if(!t.success){v.next=24;break}return ae=r.t("success","Login succeeded!"),h.default.success(ae),v.next=17,an();case 17:if(!f){v.next=20;break}return window.location.href=f,v.abrupt("return");case 20:return E.m8.push(K||"/"),v.abrupt("return");case 24:t.errorCode==="E0004"?(h.default.warning(r.t("".concat((le=t.errorCode)!==null&&le!==void 0?le:"normal",".errorMessage"),t.errorMessage)),E.m8.push("/account/resetPassword?username=".concat(c.username))):t.errorCode&&["E0002","E0005","E0006"].includes(t.errorCode)&&h.default.warning(r.t("".concat((ue=t.errorCode)!==null&&ue!==void 0?ue:"normal",".errorMessage"),t.errorMessage));case 25:Q(t),v.next=31;break;case 28:v.prev=28,v.t0=v.catch(1),Q({success:!1});case 31:case"end":return v.stop()}},o,null,[[1,28]])}));return function(l){return i.apply(this,arguments)}}(),ne=T.success,on=T.errorMessage,ie=T.errorCode,ln=(0,b.useState)((0,ce.MM)($.Bz,r,"loginType",function(i){return he.includes(i)})),Se=(0,m.Z)(ln,2),un=Se[0],cn=Se[1],p=(B=W==null?void 0:W.globalConfig)!==null&&B!==void 0?B:null;return(0,b.useEffect)(function(){if(p){for(var i=0;i<p.loginType.length;i++){var o=p.loginType[i];if(o.autoRedirect){var l=(0,re.cN)("/api/v1/user/oauth/".concat(o.id));f&&(l="".concat(l,"?redirect_uri=").concat(encodeURIComponent(f))),window.location.href=l;return}}pe(p.loginType.map(function(c){return c.type}).filter(function(c){return c!==$.Bz.oauth2&&c!==void 0})),en(p.loginType.filter(function(c){return c.type===$.Bz.oauth2}))}},[p]),(0,b.useEffect)(function(){cn((0,ce.MM)($.Bz,r,"loginType",function(i,o){return L.includes(i)||L.includes(o)})),L.length>0?L.includes(u)||J($.Bz[L[0]]):be(!0)},[L]),(0,n.jsxs)("div",{className:M().container,children:[(0,n.jsx)("div",{className:M().lang,"data-lang":!0,children:E.pD&&(0,n.jsx)(E.pD,{})}),(0,n.jsx)("div",{className:M().content,children:(0,n.jsx)("div",{className:"login-container",children:(0,n.jsxs)(Re.U,{logo:(x=p==null?void 0:p.logo)!==null&&x!==void 0?x:(0,re.Ak)("logo.svg"),title:(C=p==null?void 0:p.title)!==null&&C!==void 0?C:"IDAS",subTitle:(R=p==null?void 0:p.subTitle)!==null&&R!==void 0?R:"Identity authentication service",initialValues:{autoLogin:!0},form:y,actions:je.length>0?(0,n.jsxs)("div",{className:"ant-pro-form-login-page-other",children:[(0,n.jsx)("div",{children:(0,n.jsx)(S.Z,{plain:!0,children:r.t("loginWith","Login with")})},"loginWith"),(0,n.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:(0,n.jsx)(z.Z,{align:"center",size:24,children:je.map(function(i){return(0,n.jsx)("div",{className:Ne()(M().oauthIconButton),title:r.t("signInWith","Sign in with {name}","",{name:i.name}),onClick:function(){var l=(0,re.cN)("/api/v1/user/oauth/".concat(i.id));f&&(l="".concat(l,"?redirect_uri=").concat(encodeURIComponent(f))),window.location.href=l},children:(0,n.jsx)("img",{src:i.icon,className:M().oauthIcon})},i.name)})},"loginMethod")})]}):void 0,submitter:L.length>0?void 0:!1,onFinish:function(){var i=(0,d.Z)((0,s.Z)().mark(function o(l){return(0,s.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,rn(l);case 2:case"end":return N.stop()}},o)}));return function(o){return i.apply(this,arguments)}}(),children:[(0,n.jsx)(H.Z,{activeKey:u,onChange:function(o){J(o),Q({success:!0})},className:M().loginTypeTabs,items:un,centered:!0}),(0,n.jsxs)(I,{hidden:sn,loginType:u,allows:["normal"].concat(Ge),children:[(0,n.jsx)(q,{hidden:ne,content:r.t("".concat(ie??"normal",".errorMessage"),on)}),(0,n.jsx)(D.Z,{name:"username",fieldProps:{size:"large",prefix:(0,n.jsx)(Le.Z,{className:M().prefixIcon}),autoFocus:!0},placeholder:r.t("username.placeholder","Please enter a username"),rules:[{required:!0,message:r.t("username.required","Please enter a username!")}]}),(0,n.jsx)(D.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,n.jsx)(de.Z,{className:M().prefixIcon})},placeholder:r.t("password.placeholder","Please input a password"),rules:[{required:!0,message:r.t("password.required","Please input a password!")}]})]}),(0,n.jsx)(I,{loginType:u,allows:["mfa_totp"],children:(0,n.jsx)(q,{hidden:ne,content:r.t("totp.errorMessage","verification code error")})}),(0,n.jsxs)(I,{loginType:u,allows:["email","mfa_email"],children:[(0,n.jsx)(q,{hidden:ne,content:r.t("email.errorMessage","Email verification code error")}),(0,n.jsx)(D.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(Ee.Z,{className:M().prefixIcon})},name:"email",placeholder:r.t("email.placeholder","Please enter your email"),rules:[{required:!0,message:r.t("email.required","Please enter your email!")}]})]}),(0,n.jsxs)(I,{loginType:u,allows:["sms","mfa_sms"],children:[(0,n.jsx)(q,{hidden:ne,content:r.t("sms.errorMessage","SMS verification code error")}),(0,n.jsx)(D.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(De.Z,{className:M().prefixIcon})},name:"phone",placeholder:r.t("phoneNumber.placeholder","Please enter your phone number"),rules:[{required:!0,message:r.t("phoneNumber.required","Please enter your phone number!")},{pattern:/^1\d{10}$/,message:r.t("phoneNumber.invalid","Mobile phone number format error!")}]})]}),(0,n.jsx)(I,{loginType:u,allows:["sms","mfa_sms","mfa_email","email","mfa_totp"],children:(0,n.jsx)(Ve.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(de.Z,{className:M().prefixIcon})},captchaProps:{size:"large",hidden:u==="mfa_totp"},placeholder:r.t("captcha.placeholder","Please enter the verification code"),captchaTextRender:function(o,l){return o?"".concat(l," ").concat(r.t("getCaptchaSecondText","Get verification code")):r.t("phone.getVerificationCode","Get verification code")},name:"code",rules:[{required:!0,message:r.t("captcha.required","Please enter the verification code!")}],onGetCaptcha:(0,d.Z)((0,s.Z)().mark(function i(){var o,l,c;return(0,s.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l={type:u},t.t0=u,t.next=t.t0==="mfa_email"?4:t.t0==="email"?6:t.t0==="mfa_sms"?9:t.t0==="sms"?11:13;break;case 4:y.validateFields(["username"]),l.username=y.getFieldValue("username");case 6:return y.validateFields(["email"]),l.email=y.getFieldValue("email"),t.abrupt("break",14);case 9:y.validateFields(["username"]),l.username=y.getFieldValue("username");case 11:y.validateFields(["phone"]),l.phone=y.getFieldValue("phone");case 13:return t.abrupt("break",14);case 14:return t.next=16,(0,te.Do)(l,{intl:r});case 16:if(c=t.sent,c.success){t.next=19;break}return t.abrupt("return");case 19:me((o=c.data)===null||o===void 0?void 0:o.token),h.default.success(r.t("captcha.sent","Verification code sent successfully."));case 21:case"end":return t.stop()}},i)}))})}),(0,n.jsx)(I,{loginType:u,allows:["enable_mfa_email","enable_mfa_sms","enable_mfa_totp"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("mfa.errorMessage","Because your user is set to enable multiple factor authentication (MFA), you need to enable at least one MFA authentication method."),type:"info",showIcon:!0})}),(0,n.jsx)(I,{loginType:u,allows:["enable_mfa_sms"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("enableMfa.smsMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(I,{loginType:u,allows:["enable_mfa_email"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(F.Z,{style:{marginBottom:24},message:r.t("enableMfa.emailMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(I,{style:{width:550,display:"block",transform:"translate(-75px)"},loginType:u,allows:["enable_mfa_totp"],children:(0,n.jsx)(Qe,{token:ee})}),(0,n.jsxs)("div",{style:{marginBottom:10,display:L.length>0?"block":"none"},children:[(0,n.jsx)(Je.Z,{noStyle:!0,name:"autoLogin",children:r.t("rememberMe","Automatic login")}),(0,n.jsx)(I,{loginType:u,allows:["normal"],children:(0,n.jsx)(ye.rU,{style:{float:"right"},to:ze.A,children:r.t("forgotPassword","Forgot password")})})]})]})})}),(0,n.jsx)($e.Z,{})]})},Xe=Fe},14300:function(G,O,a){"use strict";a.d(O,{FI:function(){return U},Bz:function(){return z},w$:function(){return S},qJ:function(){return w},FQ:function(){return h},J0:function(){return s}});var U;(function(e){e[e.unsafe=0]="unsafe",e[e.general=1]="general",e[e.safe=2]="safe",e[e.very_safe=3]="very_safe"})(U||(U={}));var H;(function(e){e[e.client_credentials=3]="client_credentials",e[e.refresh_token=0]="refresh_token",e[e.authorization_code=1]="authorization_code",e[e.password=2]="password"})(H||(H={}));var k;(function(e){e[e.default=0]="default",e[e.code=1]="code",e[e.token=2]="token"})(k||(k={}));var z;(function(e){e[e.mfa_email=2]="mfa_email",e[e.mfa_sms=3]="mfa_sms",e[e.email=4]="email",e[e.enable_mfa_email=11]="enable_mfa_email",e[e.enable_mfa_sms=12]="enable_mfa_sms",e[e.normal=0]="normal",e[e.mfa_totp=1]="mfa_totp",e[e.sms=5]="sms",e[e.oauth2=6]="oauth2",e[e.enable_mfa_totp=10]="enable_mfa_totp"})(z||(z={}));var g;(function(e){e[e.token_signature=3]="token_signature",e[e.basic=0]="basic",e[e.signature=1]="signature",e[e.token=2]="token"})(g||(g={}));var S;(function(e){e[e.unknown=0]="unknown",e[e.normal=1]="normal",e[e.disable=2]="disable"})(S||(S={}));var w;(function(e){e[e.none=0]="none",e[e.authorization_code=1]="authorization_code",e[e.implicit=2]="implicit",e[e.password=4]="password",e[e.client_credentials=8]="client_credentials",e[e.proxy=16]="proxy",e[e.oidc=32]="oidc",e[e.radius=64]="radius"})(w||(w={}));var h;(function(e){e[e.manual=0]="manual",e[e.full=1]="full"})(h||(h={}));var j;(function(e){e[e.user=0]="user",e[e.system=1]="system"})(j||(j={}));var s;(function(e){e[e.user_inactive=2]="user_inactive",e[e.password_expired=4]="password_expired",e[e.normal=0]="normal",e[e.disabled=1]="disabled"})(s||(s={}));var d;(function(e){e[e.dateRange=12]="dateRange",e[e.textarea=2]="textarea",e[e.digit=3]="digit",e[e.select=8]="select",e[e.timeRange=10]="timeRange",e[e.digitRange=4]="digitRange",e[e.radio=6]="radio",e[e.switch=7]="switch",e[e.dateTime=13]="dateTime",e[e.dateTimeRange=14]="dateTimeRange",e[e.text=0]="text",e[e.checkbox=5]="checkbox",e[e.multiSelect=9]="multiSelect",e[e.date=11]="date"})(d||(d={}));var m;(function(e){e[e.enabled=2]="enabled",e[e.all=0]="all",e[e.disabled=1]="disabled"})(m||(m={}))},88293:function(G,O,a){"use strict";a.d(O,{MM:function(){return U},fs:function(){return H},GG:function(){return k}});var U=function(g,S,w,h){var j=[];for(var s in g)if(Object.prototype.propertyIsEnumerable.call(g,s)&&isNaN(Number(s))){var d=g[s];if(h&&!h(s,d))continue;j.push({label:S.formatMessage({id:"".concat(w,".").concat(s),defaultMessage:s}),key:s,value:d})}return j},H=function(g,S,w,h){var j=new Map;for(var s in g)if(Object.prototype.hasOwnProperty.call(g,s)&&isNaN(Number(s))){var d=g[s];if(h&&!h(s,d))continue;j.set(d,S.formatMessage({id:"".concat(w,".").concat(s),defaultMessage:s}))}return j},k=function(g,S,w,h){var j={};for(var s in g)if(Object.prototype.hasOwnProperty.call(g,s)&&!isNaN(Number(s))){var d,m=g[s];j[s]={text:S.formatMessage({id:"".concat(w,".").concat(m),defaultMessage:m}),status:(d=h[m])!==null&&d!==void 0?d:"Default"}}return j}}}]);
