(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[244],{16894:function(de,Y,t){"use strict";var re=t(4582);Y.ZP=re.Z},24275:function(de,Y,t){"use strict";t.r(Y),t.d(Y,{default:function(){return xe}});var re=t(57338),ce=t(273),Ye=t(54421),te=t(38272),He=t(71194),M=t(34883),Ue=t(57663),ne=t(71577),We=t(62350),fe=t(24565),ke=t(48736),pe=t(27049),g=t(11849),R=t(2824),l=t(39428),Ve=t(34792),b=t(48086),y=t(3182),me=t(30381),he=t.n(me),S=t(67294),ve=t(21010),ae=t(93224),I=t(72709),Ze=["id"],ge=null;function ye(d,n){return z.apply(this,arguments)}function z(){return z=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"GET",params:(0,g.Z)({},n)},s||{})));case 1:case"end":return r.stop()}},d)})),z.apply(this,arguments)}function Se(d,n){return B.apply(this,arguments)}function B(){return B=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"POST",headers:{"Content-Type":"application/json"},data:n},s||{})));case 1:case"end":return r.stop()}},d)})),B.apply(this,arguments)}function Ce(d,n){return G.apply(this,arguments)}function G(){return G=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/roles",(0,g.Z)({method:"DELETE",headers:{"Content-Type":"application/json"},data:n},s||{})));case 1:case"end":return r.stop()}},d)})),G.apply(this,arguments)}function we(d,n,s){return N.apply(this,arguments)}function N(){return N=(0,y.Z)((0,l.Z)().mark(function d(n,s,u){var r,e;return(0,l.Z)().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return r=n.id,e=(0,ae.Z)(n,Ze),P.abrupt("return",(0,I.WY)("/api/v1/roles/".concat(r),(0,g.Z)({method:"PUT",headers:{"Content-Type":"application/json"},params:(0,g.Z)({},e),data:s},u||{})));case 2:case"end":return P.stop()}},d)})),N.apply(this,arguments)}function Ke(d,n){return J.apply(this,arguments)}function J(){return J=_asyncToGenerator(_regeneratorRuntime().mark(function d(n,s){var u,r;return _regeneratorRuntime().wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return u=n.id,r=_objectWithoutProperties(n,ge),C.abrupt("return",request("/api/v1/roles/".concat(u),_objectSpread({method:"DELETE",params:_objectSpread({},r)},s||{})));case 2:case"end":return C.stop()}},d)})),J.apply(this,arguments)}var se=t(93400),je=t(51042),le=t(57119),Re=t(55997),be=t(43037),Pe=t(85224),Te=t(16894),Me=t(32157),Ee=t(17);function De(d,n){return Q.apply(this,arguments)}function Q(){return Q=(0,y.Z)((0,l.Z)().mark(function d(n,s){return(0,l.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",(0,I.WY)("/api/v1/permissions",(0,g.Z)({method:"GET",params:(0,g.Z)({},n)},s||{})));case 1:case"end":return r.stop()}},d)})),Q.apply(this,arguments)}var X=t(62448),q=t(5966),a=t(85893),Ie=["parentIntl"],Oe=function(n){var s=n.parentIntl,u=(0,ae.Z)(n,Ie),r=new se.f("form",s),e=(0,S.useState)(!1),C=(0,R.Z)(e,2),P=C[0],H=C[1],p=u.values,O=u.modalVisible,U=u.onSubmit,w=u.onCancel,D=(0,S.useState)([]),W=(0,R.Z)(D,2),k=W[0],T=W[1],V=(0,S.useState)([]),K=(0,R.Z)(V,2),A=K[0],$=K[1],_=(0,S.useState)(500),m=(0,R.Z)(_,2),ee=m[0],F=m[1],Z=(0,S.useState)(0),h=(0,R.Z)(Z,2),o=h[0],c=h[1];(0,S.useEffect)(function(){var i=function(){window.innerHeight>640?F(window.innerHeight-440):F(200)};i(),window.addEventListener("resize",i)},[]),(0,S.useEffect)(function(){O&&(c(0),$(p!=null&&p.permission?p.permission.map(function(i){return i.id}):[]),H(!0),De({pageSize:3e3}).then(function(i){i.success&&i.data&&T(i.data)}).finally(function(){H(!1)}))},[p,O]);var j=function i(f,L){if(f===void 0)return[];var x=[],v=f;return v.forEach(function(ue,E){if(ue.parentId===L){var oe=i(v,ue.id);oe.length>0?x.push({key:v[E].id,title:v[E].description?v[E].description:v[E].name,children:oe}):x.push({key:v[E].id,title:v[E].description?v[E].description:v[E].name})}}),x};return(0,a.jsxs)(X.L,{stepsProps:{size:"small"},current:o,onCurrentChange:c,formProps:{preserve:!1},stepsFormRender:function(f,L){return(0,a.jsx)(M.Z,{width:640,confirmLoading:P,bodyStyle:{padding:"32px 40px 48px"},destroyOnClose:!0,title:r.t(p?"title.roleUpdate":"title.roleCreate",p?"Modify role":"Add role"),style:{maxHeight:"calc(100vh - 200px)"},open:O,footer:L,onCancel:function(){M.Z.confirm({title:r.t("cancel?","Cancel editing?"),icon:(0,a.jsx)(le.Z,{}),onOk:function(){w()},maskClosable:!0})},children:f})},onFinish:function(){var i=(0,y.Z)((0,l.Z)().mark(function f(L){return(0,l.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.abrupt("return",U((0,g.Z)((0,g.Z)({},L),{},{permission:A})));case 1:case"end":return v.stop()}},f)}));return function(f){return i.apply(this,arguments)}}(),children:[(0,a.jsxs)(X.L.StepForm,{initialValues:p,labelCol:{span:8},wrapperCol:{span:14},layout:"horizontal",title:r.t("basicConfig","Basic information"),children:[(0,a.jsx)(q.Z,{hidden:!0,name:"id"}),(0,a.jsx)(q.Z,{name:"name",label:r.t("name.label","Name"),width:"md",rules:[{required:!0,message:r.t("name.required","Please input role name!")}]}),(0,a.jsx)(q.Z,{name:"description",label:r.t("description.label","Description"),width:"md"})]}),(0,a.jsx)(X.L.StepForm,{initialValues:{},title:r.t("permission.title","Permission"),children:(0,a.jsx)(Ee.Z,{checkable:!0,height:ee,defaultExpandAll:!0,checkedKeys:A,onCheck:function(f){$(f)},treeData:j(k,"")})})]})},Ae=Oe,$e=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=b.default.loading("Adding ..."),e.prev=1,delete s.id,e.next=5,Se(s);case 5:return u(),b.default.success("Added successfully"),e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(1),u(),b.default.error("Adding failed, please try again!"),e.abrupt("return",!1);case 15:case"end":return e.stop()}},n,null,[[1,10]])}));return function(s){return d.apply(this,arguments)}}(),Fe=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=b.default.loading("Configuring"),e.prev=1,!s.id){e.next=10;break}return e.next=5,we({id:s.id},s);case 5:return u(),b.default.success("update is successful"),e.abrupt("return",!0);case 10:return b.default.success("update failed, system error"),e.abrupt("return",!1);case 12:e.next=19;break;case 14:return e.prev=14,e.t0=e.catch(1),u(),b.default.error("Configuration failed, please try again!"),e.abrupt("return",!1);case 19:case"end":return e.stop()}},n,null,[[1,14]])}));return function(s){return d.apply(this,arguments)}}(),ie=function(){var d=(0,y.Z)((0,l.Z)().mark(function n(s){var u;return(0,l.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(u=b.default.loading("Deleting ..."),s){e.next=3;break}return e.abrupt("return",!0);case 3:return e.prev=3,e.next=6,Ce(s.map(function(C){return{id:C.id}}));case 6:return u(),b.default.success("Deleted successfully and will refresh soon"),e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(3),u(),b.default.error("Delete failed, please try again: ".concat(e.t0)),e.abrupt("return",!1);case 16:case"end":return e.stop()}},n,null,[[3,11]])}));return function(s){return d.apply(this,arguments)}}(),Le=function(){var n=(0,S.useState)(!1),s=(0,R.Z)(n,2),u=s[0],r=s[1],e=(0,S.useState)(!1),C=(0,R.Z)(e,2),P=C[0],H=C[1],p=(0,S.useRef)(),O=(0,S.useState)(),U=(0,R.Z)(O,2),w=U[0],D=U[1],W=(0,S.useState)([]),k=(0,R.Z)(W,2),T=k[0],V=k[1],K=(0,S.useState)(),A=(0,R.Z)(K,2),$=A[0],_=A[1],m=new se.f("pages.roles",(0,ve.YB)()),ee=function(){var Z=(0,y.Z)((0,l.Z)().mark(function h(o){var c;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return c=(0,g.Z)({},o),$&&(c=(0,g.Z)({keywords:$},c)),i.abrupt("return",ye(c));case 3:case"end":return i.stop()}},h)}));return function(o){return Z.apply(this,arguments)}}(),F=[{title:m.t("title.name","Role Name"),dataIndex:"name"},{title:m.t("title.describe","Describe"),dataIndex:"describe"},{title:m.t("title.createTime","Create Time"),dataIndex:"create_time",render:function(h,o){return he()(o.createTime).locale(m.locale).format("YYYY-MM-DD HH:mm:ss")}},{title:m.t("title.operate","Operate"),dataIndex:"option",valueType:"option",render:function(h,o){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{onClick:function(){r(!0),D(o)},children:m.t("button.change","Change")},"change"),(0,a.jsx)(pe.Z,{type:"vertical"}),(0,a.jsx)(fe.Z,{title:m.t("delete.popconfirm","Are you sure you want to delete the role named: {name}?",void 0,{name:o.name}),onConfirm:(0,y.Z)((0,l.Z)().mark(function c(){var j;return(0,l.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,ie([o]);case 2:if(!f.sent){f.next=4;break}(j=p.current)===null||j===void 0||j.reload();case 4:case"end":return f.stop()}},c)})),children:(0,a.jsx)("a",{children:m.t("button.delete","Delete")})},"delete")]})}}];return(0,a.jsxs)(be.Oc,{children:[(0,a.jsx)(Te.ZP,{actionRef:p,rowKey:"id",search:!1,toolbar:{search:!0,onSearch:function(h){if(_(h),p.current){var o,c;(o=(c=p.current).setPageInfo)===null||o===void 0||o.call(c,(0,g.Z)((0,g.Z)({},p.current.pageInfo),{},{current:1})),p.current.reload()}},actions:[(0,a.jsxs)(ne.Z,{type:"primary",onClick:function(){r(!0)},children:[(0,a.jsx)(je.Z,{}),m.t("button.create","Create")]},"create")]},request:ee,columns:F,tableAlertRender:!1,rowSelection:{onChange:function(h,o){V(o)}}}),(T==null?void 0:T.length)>0&&(0,a.jsx)(Pe.Z,{extra:(0,a.jsxs)("div",{children:[m.t("chosen","Chosen")," ",(0,a.jsx)("a",{style:{fontWeight:600},children:T.length})," ",m.t("item","Items")]}),children:(0,a.jsx)(ne.Z,{danger:!0,onClick:function(){M.Z.confirm({title:m.t("delete.confirm","Are you sure you want to delete the following roles?            "),icon:(0,a.jsx)(le.Z,{}),onOk:function(){return(0,y.Z)((0,l.Z)().mark(function o(){var c,j;return(0,l.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,ie(T);case 2:V([]),(c=p.current)===null||c===void 0||(j=c.reloadAndRest)===null||j===void 0||j.call(c);case 4:case"end":return f.stop()}},o)}))()},content:(0,a.jsx)(te.ZP,{dataSource:T,rowKey:"id",renderItem:function(o){return(0,a.jsx)(te.ZP.Item,{children:o.name})}})})},children:m.t("button.batchDeletion","Batch deletion")})}),(0,a.jsx)(Ae,{onSubmit:function(){var Z=(0,y.Z)((0,l.Z)().mark(function h(o){var c;return(0,l.Z)().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,(w?Fe:$e)(o);case 2:return c=i.sent,c&&(r(!1),D(void 0),p.current&&p.current.reload()),i.abrupt("return",c);case 5:case"end":return i.stop()}},h)}));return function(h){return Z.apply(this,arguments)}}(),onCancel:function(){r(!1),P||D(void 0)},modalVisible:u,values:w,parentIntl:m}),(0,a.jsx)(ce.Z,{width:600,open:P,onClose:function(){D(void 0),H(!1)},closable:!1,children:P&&(w==null?void 0:w.id)&&(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(Re.ZP,{column:2,title:m.t("detail.title","Role Details"),request:(0,y.Z)((0,l.Z)().mark(function Z(){return(0,l.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",{data:w||{}});case 1:case"end":return o.stop()}},Z)})),params:{id:w==null?void 0:w.id},columns:F})})})]})},xe=Le}}]);
