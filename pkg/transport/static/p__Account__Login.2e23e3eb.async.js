(self.webpackChunkidas_ui=self.webpackChunkidas_ui||[]).push([[258],{33055:function(X){X.exports={container:"container___37JKF",lang:"lang___ODW_o",content:"content___3akJJ",oauthIcon:"oauthIcon___1nA12",oauthButton:"oauthButton___1yw-w",icon:"icon___1ArHE"}},57197:function(X,W,a){"use strict";a.r(W),a.d(W,{default:function(){return Ue}});var J=a(57663),k=a(71577),H=a(18106),L=a(58500),v=a(34792),p=a(48086),j=a(91896),u=a(39428),f=a(3182),s=a(2824),c=a(11849),B=a(86582),e=a(93224),an=a(17462),O=a(76772),tn=a(34442),be=a(50963),we=a(96486),x=a(67294),C=a(21010),Se=a(73727),Me=a(60923),Ie=a(45953),Ne=a(29791),E=a(14300),A=a(72709);function Be($){return ne.apply(this,arguments)}function ne(){return ne=(0,f.Z)((0,u.Z)().mark(function $(g){return(0,u.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.abrupt("return",(0,A.WY)("/api/v1/global/loginType",(0,c.Z)({method:"GET"},g||{})));case 1:case"end":return d.stop()}},$)})),ne.apply(this,arguments)}var ae=a(89652),ue=a(88293),te=a(93400),Ce=a(89366),ce=a(2603),ye=a(64302),ze=a(29985),Le=a(29464),V=a(5966),Ee=a(16434),$e=a(63434),sn=a(13254),ke=a(14277),Ve=a(84059),De=a(79090),Re=a(21349),n=a(85893),We=function($){var g=$.parentIntl,y=g===void 0?new te.f("user.settings.security",(0,C.YB)()):g,d=$.token,I=new te.f("mfa",y),U=(0,x.useState)(),D=(0,s.Z)(U,2),l=D[0],z=D[1],se=(0,x.useState)(!1),Y=(0,s.Z)(se,2),G=Y[0],K=Y[1],Q=function(){var R=(0,f.Z)((0,u.Z)().mark(function T(r){return(0,u.Z)().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:z(void 0),K(!0),(0,ae.HN)({token:r}).then(function(w){z(w.data)}).finally(function(){K(!1)});case 3:case"end":return F.stop()}},T)}));return function(r){return R.apply(this,arguments)}}();return(0,x.useEffect)(function(){d&&Q(d)},[d]),(0,n.jsxs)(Re.Z,{children:[(0,n.jsx)("span",{children:(0,n.jsx)(O.Z,{style:{marginBottom:24},message:I.t("code-description","Please obtain two consecutive one-time passwords after scanning and adding MFA and enter them into the input box below."),type:"info",showIcon:!0})}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{style:{width:220,height:140},children:l!=null&&l.secret?(0,n.jsx)(Ve.Qd,{style:{marginLeft:"40px"},value:l==null?void 0:l.secret}):(0,n.jsx)(ke.Z,{description:"",style:{width:200,height:128},image:G?(0,n.jsx)(De.Z,{}):void 0})}),(0,n.jsx)("div",{style:{display:"grid",width:"100%"},children:(0,n.jsx)(k.Z,{onClick:function(){d&&Q(d)},type:"link",children:I.t("refresh","Refresh")})})]}),(0,n.jsxs)("div",{style:{marginLeft:"50px"},children:[(0,n.jsx)(V.Z,{hidden:!0,width:"sm",name:"token",fieldProps:{value:l==null?void 0:l.token}}),(0,n.jsx)(V.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"firstCode",label:I.t("first-code","First code")}),(0,n.jsx)(V.Z,{rules:[{pattern:/[0-9]{6}/,required:!0}],width:"sm",name:"secondCode",label:I.t("second-code","Second code")})]})]})]})},Je=a(33055),b=a.n(Je),He=["children","allows","loginType","hidden"],P=function(g){var y=g.content,d=g.hidden;return d?null:(0,n.jsx)(O.Z,{style:{marginBottom:24},message:y,type:"error",showIcon:!0})},M=function(g){var y=g.children,d=g.allows,I=g.loginType,U=g.hidden,D=(0,e.Z)(g,He),l=new Set([].concat((0,B.Z)(d),[d.map(function(z){return E.Bz[z]})]));return l.has(I)?(0,n.jsx)("span",(0,c.Z)((0,c.Z)({hidden:U},D),{},{children:y})):(0,n.jsx)(n.Fragment,{})},Oe=function(){var g=(0,x.useState)({success:!0}),y=(0,s.Z)(g,2),d=y[0],I=y[1],U=(0,x.useState)("normal"),D=(0,s.Z)(U,2),l=D[0],z=D[1],se=(0,x.useState)(),Y=(0,s.Z)(se,2),G=Y[0],K=Y[1],Q=(0,C.tT)("@@initialState"),R=Q.initialState,T=Q.setInitialState,r=new te.f("pages.login",(0,C.YB)()),de=(0,be.cI)(),F=(0,s.Z)(de,1),w=F[0],me=["normal","email","sms"],Ye=["mfa_totp","mfa_email","mfa_sms"],Ke=(0,x.useState)(me.map(function(i){return E.Bz[i]})),fe=(0,s.Z)(Ke,2),S=fe[0],he=fe[1],Qe=(0,x.useState)([]),ve=(0,s.Z)(Qe,2),q=ve[0],Fe=ve[1],Xe=function(o){(0,we.isNumber)(o)?z(E.Bz[o]):z(o)},Ae=function(){var i=(0,f.Z)((0,u.Z)().mark(function o(){var h,Z;return(0,u.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,R==null||(h=R.fetchUserInfo)===null||h===void 0?void 0:h.call(R);case 2:if(Z=t.sent,!Z){t.next=6;break}return t.next=6,T(function(ee){return(0,c.Z)((0,c.Z)({},ee),{},{currentUser:Z})});case 6:case"end":return t.stop()}},o)}));return function(){return i.apply(this,arguments)}}(),Pe=(0,x.useState)(!1),ge=(0,s.Z)(Pe,2),Ge=ge[0],pe=ge[1],Te=function(){var i=(0,f.Z)((0,u.Z)().mark(function o(h){var Z,N,t,ee,Ze,ie,je,oe,le;return(0,u.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return Z=(0,j.Z)({},h),m.prev=1,m.next=4,(0,ae.n$)((0,c.Z)((0,c.Z)({},Z),{},{type:l,token:G}),{skipErrorHandler:!0});case 4:if(t=m.sent,!((N=t.data)!==null&&N!==void 0&&N.nextMethod&&t.data.nextMethod.length>0)){m.next=12;break}he(t.data.nextMethod),Xe(t.data.nextMethod[0]),pe(!0),K(t.data.token),m.next=29;break;case 12:if(!t.success){m.next=28;break}return ee=r.t("success","Login succeeded!"),p.default.success(ee),m.next=17,Ae();case 17:if(C.m8){m.next=19;break}return m.abrupt("return");case 19:if(Ze=C.m8.location.query,ie=Ze,je=ie.redirect,oe=ie.redirect_uri,!oe){m.next=24;break}return window.location.href=oe,m.abrupt("return");case 24:return C.m8.push(je||"/"),m.abrupt("return");case 28:t.errorCode==="E0004"&&(p.default.warning(r.t("".concat((le=t.errorCode)!==null&&le!==void 0?le:"normal",".errorMessage"),t.errorMessage)),C.m8.push("/account/resetPassword?username=".concat(Z.username)));case 29:I(t),m.next=35;break;case 32:m.prev=32,m.t0=m.catch(1),I({success:!1});case 35:case"end":return m.stop()}},o,null,[[1,32]])}));return function(h){return i.apply(this,arguments)}}(),_=d.success,qe=d.errorMessage,re=d.errorCode,_e=(0,x.useState)((0,ue.MM)(E.Bz,r,"loginType",function(i){return me.includes(i)})),xe=(0,s.Z)(_e,2),en=xe[0],nn=xe[1];return(0,x.useEffect)(function(){Be().then(function(i){i.data&&(he(i.data.map(function(o){return o.type}).filter(function(o){return o!==E.Bz.oauth2&&o!==void 0})),Fe(i.data.filter(function(o){return o.type===E.Bz.oauth2})))})},[]),console.log(q),(0,x.useEffect)(function(){console.log(S),nn((0,ue.MM)(E.Bz,r,"loginType",function(i,o){return S.includes(i)||S.includes(o)})),S.length>0?S.includes(l)||z(E.Bz[S[0]]):pe(!0)},[S]),(0,n.jsxs)("div",{className:b().container,children:[(0,n.jsx)("div",{className:b().lang,"data-lang":!0,children:C.pD&&(0,n.jsx)(C.pD,{})}),(0,n.jsx)("div",{className:b().content,children:(0,n.jsxs)(Le.U,{logo:(0,n.jsx)("img",{alt:"logo",src:window.publicPath+"logo.svg"}),title:Me.Z.title,subTitle:(0,n.jsx)(n.Fragment,{children:" "}),initialValues:{autoLogin:!0},form:w,actions:S.length>0&&q.length>0?[(0,n.jsx)("span",{children:r.t("loginWith","Login with")},"loginWith")].concat((0,B.Z)(q.map(function(i){return(0,n.jsx)("a",{onClick:function(){console.log((0,A.cN)("/api/v1/user/oauth/".concat(i.id))),window.location.replace((0,A.cN)("/api/v1/user/oauth/".concat(i.id)))},children:(0,n.jsx)("img",{src:i.icon,className:b().oauthIcon})},i.name)}))):void 0,submitter:S.length>0?void 0:!1,onFinish:function(){var i=(0,f.Z)((0,u.Z)().mark(function o(h){return(0,u.Z)().wrap(function(N){for(;;)switch(N.prev=N.next){case 0:return N.next=2,Te(h);case 2:case"end":return N.stop()}},o)}));return function(o){return i.apply(this,arguments)}}(),children:[(0,n.jsx)(L.Z,{activeKey:l,onChange:function(o){z(o),I({success:!0})},items:en,centered:!0}),(0,n.jsxs)(M,{hidden:Ge,loginType:l,allows:["normal"].concat(Ye),children:[(0,n.jsx)(P,{hidden:_,content:r.t("".concat(re??"normal",".errorMessage"),qe)}),(0,n.jsx)(V.Z,{name:"username",fieldProps:{size:"large",prefix:(0,n.jsx)(Ce.Z,{className:b().prefixIcon})},placeholder:r.t("username.placeholder","Please enter a username"),rules:[{required:!0,message:r.t("username.required","Please enter a username!")}]}),(0,n.jsx)(V.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,n.jsx)(ce.Z,{className:b().prefixIcon})},placeholder:r.t("password.placeholder","Please input a password"),rules:[{required:!0,message:r.t("password.required","Please input a password!")}]})]}),(0,n.jsx)(M,{loginType:l,allows:["mfa_totp"],children:(0,n.jsx)(P,{hidden:_,content:r.t("totp.errorMessage","verification code error")})}),(0,n.jsxs)(M,{loginType:l,allows:["email","mfa_email"],children:[(0,n.jsx)(P,{hidden:_,content:r.t("email.errorMessage","Email verification code error")}),(0,n.jsx)(V.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(ye.Z,{className:b().prefixIcon})},name:"email",placeholder:r.t("email.placeholder","Please enter your email"),rules:[{required:!0,message:r.t("email.required","Please enter your email!")}]})]}),(0,n.jsxs)(M,{loginType:l,allows:["sms","mfa_sms"],children:[(0,n.jsx)(P,{hidden:_,content:r.t("sms.errorMessage","SMS verification code error")}),(0,n.jsx)(V.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(ze.Z,{className:b().prefixIcon})},name:"phone",placeholder:r.t("phoneNumber.placeholder","Please enter your phone number"),rules:[{required:!0,message:r.t("phoneNumber.required","Please enter your phone number!")},{pattern:/^1\d{10}$/,message:r.t("phoneNumber.invalid","Mobile phone number format error!")}]})]}),(0,n.jsx)(M,{loginType:l,allows:["sms","mfa_sms","mfa_email","email","mfa_totp"],children:(0,n.jsx)(Ee.Z,{fieldProps:{size:"large",prefix:(0,n.jsx)(ce.Z,{className:b().prefixIcon})},captchaProps:{size:"large",hidden:l==="mfa_totp"},placeholder:r.t("captcha.placeholder","Please enter the verification code"),captchaTextRender:function(o,h){return o?"".concat(h," ").concat(r.t("getCaptchaSecondText","Get verification code")):r.t("phone.getVerificationCode","Get verification code")},name:"code",rules:[{required:!0,message:r.t("captcha.required","Please enter the verification code!")}],onGetCaptcha:(0,f.Z)((0,u.Z)().mark(function i(){var o,h,Z;return(0,u.Z)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:h={type:l},t.t0=l,t.next=t.t0==="mfa_email"?4:t.t0==="email"?6:t.t0==="mfa_sms"?9:t.t0==="sms"?11:13;break;case 4:w.validateFields(["username"]),h.username=w.getFieldValue("username");case 6:return w.validateFields(["email"]),h.email=w.getFieldValue("email"),t.abrupt("break",14);case 9:w.validateFields(["username"]),h.username=w.getFieldValue("username");case 11:w.validateFields(["phone"]),h.phone=w.getFieldValue("phone");case 13:return t.abrupt("break",14);case 14:return t.next=16,(0,ae.Do)(h,{intl:r});case 16:if(Z=t.sent,Z.success){t.next=19;break}return t.abrupt("return");case 19:K((o=Z.data)===null||o===void 0?void 0:o.token),p.default.success(r.t("captcha.sent","Verification code sent successfully."));case 21:case"end":return t.stop()}},i)}))})}),(0,n.jsx)(M,{loginType:l,allows:["enable_mfa_email","enable_mfa_sms","enable_mfa_totp"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(O.Z,{style:{marginBottom:24},message:r.t("mfa.errorMessage","Because your user is set to enable multiple factor authentication (MFA), you need to enable at least one MFA authentication method."),type:"info",showIcon:!0})}),(0,n.jsx)(M,{loginType:l,allows:["enable_mfa_sms"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(O.Z,{style:{marginBottom:24},message:r.t("enableMfa.smsMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(M,{loginType:l,allows:["enable_mfa_email"],style:{width:550,display:"block",transform:"translate(-75px)"},children:(0,n.jsx)(O.Z,{style:{marginBottom:24},message:r.t("enableMfa.emailMessage","Click Login to automatically enable email as the second authentication factor."),type:"info",showIcon:!0})}),(0,n.jsx)(M,{style:{width:550,display:"block",transform:"translate(-75px)"},loginType:l,allows:["enable_mfa_totp"],children:(0,n.jsx)(We,{token:G})}),(0,n.jsxs)("div",{style:{marginBottom:10,display:S.length>0?"block":"none"},children:[(0,n.jsx)($e.Z,{noStyle:!0,name:"autoLogin",children:r.t("rememberMe","Automatic login")}),(0,n.jsx)(M,{loginType:l,allows:["normal"],children:(0,n.jsx)(Se.rU,{style:{float:"right"},to:Ie.A,children:r.t("forgotPassword","Forgot password")})})]}),(0,n.jsx)("div",{hidden:S.length!==0,children:q.map(function(i){return(0,n.jsx)(k.Z,{className:b().oauthButton,icon:(0,n.jsx)("span",{children:(0,n.jsx)("img",{src:i.icon,className:b().oauthIcon})},i.name),onClick:function(){window.location.replace((0,A.cN)("/api/v1/user/oauth/".concat(i.id)))},children:r.t("signInWith","Sign in with {name}","",{name:i.name})},i.name)})})]})}),(0,n.jsx)(Ne.Z,{})]})},Ue=Oe},14300:function(X,W,a){"use strict";a.d(W,{FI:function(){return J},Bz:function(){return L},w$:function(){return p},qJ:function(){return j},FQ:function(){return u},J0:function(){return s}});var J;(function(e){e[e.unsafe=0]="unsafe",e[e.general=1]="general",e[e.safe=2]="safe",e[e.very_safe=3]="very_safe"})(J||(J={}));var k;(function(e){e[e.refresh_token=0]="refresh_token",e[e.authorization_code=1]="authorization_code",e[e.password=2]="password",e[e.client_credentials=3]="client_credentials"})(k||(k={}));var H;(function(e){e[e.default=0]="default",e[e.code=1]="code",e[e.token=2]="token"})(H||(H={}));var L;(function(e){e[e.oauth2=6]="oauth2",e[e.enable_mfa_sms=12]="enable_mfa_sms",e[e.normal=0]="normal",e[e.mfa_totp=1]="mfa_totp",e[e.mfa_email=2]="mfa_email",e[e.mfa_sms=3]="mfa_sms",e[e.email=4]="email",e[e.sms=5]="sms",e[e.enable_mfa_totp=10]="enable_mfa_totp",e[e.enable_mfa_email=11]="enable_mfa_email"})(L||(L={}));var v;(function(e){e[e.token_signature=3]="token_signature",e[e.basic=0]="basic",e[e.signature=1]="signature",e[e.token=2]="token"})(v||(v={}));var p;(function(e){e[e.unknown=0]="unknown",e[e.normal=1]="normal",e[e.disable=2]="disable"})(p||(p={}));var j;(function(e){e[e.client_credentials=8]="client_credentials",e[e.proxy=16]="proxy",e[e.oidc=32]="oidc",e[e.none=0]="none",e[e.authorization_code=1]="authorization_code",e[e.implicit=2]="implicit",e[e.password=4]="password"})(j||(j={}));var u;(function(e){e[e.manual=0]="manual",e[e.full=1]="full"})(u||(u={}));var f;(function(e){e[e.system=1]="system",e[e.user=0]="user"})(f||(f={}));var s;(function(e){e[e.disabled=1]="disabled",e[e.user_inactive=2]="user_inactive",e[e.password_expired=4]="password_expired",e[e.normal=0]="normal"})(s||(s={}));var c;(function(e){e[e.text=0]="text",e[e.digitRange=4]="digitRange",e[e.select=8]="select",e[e.dateTimeRange=14]="dateTimeRange",e[e.radio=6]="radio",e[e.multiSelect=9]="multiSelect",e[e.date=11]="date",e[e.dateRange=12]="dateRange",e[e.textarea=2]="textarea",e[e.timeRange=10]="timeRange",e[e.dateTime=13]="dateTime",e[e.digit=3]="digit",e[e.checkbox=5]="checkbox",e[e.switch=7]="switch"})(c||(c={}));var B;(function(e){e[e.all=0]="all",e[e.disabled=1]="disabled",e[e.enabled=2]="enabled"})(B||(B={}))},88293:function(X,W,a){"use strict";a.d(W,{MM:function(){return J},fs:function(){return k},GG:function(){return H}});var J=function(v,p,j,u){var f=[];for(var s in v)if(Object.prototype.propertyIsEnumerable.call(v,s)&&isNaN(Number(s))){var c=v[s];if(u&&!u(s,c))continue;f.push({label:p.formatMessage({id:"".concat(j,".").concat(s),defaultMessage:s}),key:s,value:c})}return f},k=function(v,p,j,u){var f=new Map;for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s)&&isNaN(Number(s))){var c=v[s];if(u&&!u(s,c))continue;f.set(c,p.formatMessage({id:"".concat(j,".").concat(s),defaultMessage:s}))}return f},H=function(v,p,j,u){var f={};for(var s in v)if(Object.prototype.hasOwnProperty.call(v,s)&&!isNaN(Number(s))){var c,B=v[s];f[s]={text:p.formatMessage({id:"".concat(j,".").concat(B),defaultMessage:B}),status:(c=u[B])!==null&&c!==void 0?c:"Default"}}return f}}}]);
